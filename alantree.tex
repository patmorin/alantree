\documentclass[lotsofwhite]{patmorin}
\usepackage{pat}
\usepackage{graphicx}

\DeclareMathOperator{\exponential}{exponential}
\DeclareMathOperator{\binomial}{binomial}
\DeclareMathOperator{\erlang}{Erlang}

\title{\MakeUppercase{Notes on Growing a Tree in a Graph}}
\author{\ }

\begin{document}
\maketitle

\begin{abstract}
We study the height of a spanning tree $T$ of a graph $G$ obtained by
starting with a single vertex of $G$ and repeatedly selecting, uniformly
at random, an edge of $G$ with exactly one endpoint in $T$ and adding
this edge to $T$.
\end{abstract}

\tableofcontents
\newpage

\section{Introduction}

We consider the following process for growing a spanning tree,
$T$, of a graph $G$ starting at some vertex $s\in V(G)$.  Intially,
$T=(s,\emptyset)$ is the single vertex tree containing only $s$. We then
repeatedly select, uniformly at random, an edge from $E(G)$ that has one
endpoint in $V(T)$ and one endpoint not in $V(T)$ and we add this edge
to $T$.  For an $n$-vertex connected graph $G$, the tree $T$ spans $G$
after $n-1$ iterations.  We call this Process~A.  We are interested in the
height of the (random) spanning tree generated by Process~A.

It turns out that there are several equivalent views of Process~A.
A slower version, called Process~B is obtained by repeatedly selecting
a uniformly random edge of $G$ and adding it to $T$ if and only if
exactly one endpoint of the edge is in $T$.  The number of iterations
of Process~B required before $T$ spans $G$ is now variable, but the
distribution of the resulting spanning tree is the same as Process~A.
(We can think of Process~B as implementing the edge selection of Process~A
using rejection sampling.)

Consider the following, which we call Process~E (for exponential).
On each edge of $G$ we attach an $\exponential(1)$ timer.  When the
timer on an edge $vw$ rings the timer is immediately reset and, if
exactly one of $v$ or $w$ is in $T$, then the edge $vw$ is added to $T$.
We say that Process~E is \emph{complete} once $T$ spans $G$.  Note that,
by the memorylessness of exponential random variables, at any point in
time, each edge is equally likely to be the next edge whose timer rings.
Thus, Process~E produces spanning trees with the same distribution as
those produced by Process~B, and hence also Process~A.

Also, by the memorylessness of exponential random variables, Process~E
is equivalent to selecting an exponential(1) edge weight for each edge
of $G$ and then computing the shortest (or rather, lightest) path
tree rooted at $s$.  We call this latter process \emph{Process~FP}
(for first-passage percolation).  That this process is equivalent to
Process~A can be seen by adding vertices to the shortest path tree rooted
at $s$ in increasing order of the weight of their lightest path to $s$.
At each step in this process, the memoryless property ensures that each
edge adjacent ot exactly one vertex of $T$ is equally likely to be the
next edge added to $T$.  

Since these processes produce the same distribution of spanning trees,
in the remainder, $T$ will refer to a spanning tree produced by Process~A,
Process~B, Process~E, or Process~FP, whichever is convenient.  Since our
Process~A refers to an unweighted graph and Process~FP refers to weighted
graph, we will use the convention that the \emph{length} of a path $P$ is
the number of edges in the path and the \emph{weight}, $W(P)$ of a path
is the sum of the weights on the edges in the path. The \emph{height},
$h(T)$, of $T$ is the length of the longest root-to-leaf path in $T$.
The weight of the heaviest root-to-leaf path in $T$ is called the
\emph{first-passage percolation time} and will play an important role
in our results.

In this paper we show that the height of $T$ depends (obviously)
on the diameter, $D$, of $G$ and (less obviously) on the maximum degree,
$\Delta$ of $G$.  We prove the following results (all of which hold
with probability $1-o_n(1)$:

\begin{itemize}
  \item For any $n$-vertex graph $G$, $h(T)\in O(\Delta(D+\log n))$.
  For $D>\log n$, this is tight; for every $\Delta\ge 2$ and every $D \ge
  \log\Delta$, there exists a graph of diameter $D$ and maximum degree
  $\Delta$ such that the expected height of $T$ is $\Omega(\Delta D)$.

  \item For any $n$-vertex $d$-degenerate graph $G$,\footnote{The concepts
  of degeneracy, Euler genus, thickness, and treewidth are defined in
  \secref{degeneracy-discussion}.} $h(T)\in O(\sqrt{d\Delta}(D+\log n))$.
  The class of $O(1)$-degenerate graphs is enormous and includes every
  minor-closed graph family.  This upper bound is tight, even for
  planar graphs ($d=5$), graphs of thickenss $t$ ($d=5t$), and graphs
  of treewidth $k$ ($d=k$).

  \item For any $n$-vertex graph $G$ of Euler genus $g$,
  $h(T)\in O(\sqrt{\Delta}(D+\log n))$, provided that $g <
  C\Delta^{1/2}D/\log\Delta$.

  \item On the $d$-dimensional grid of side-length $k$ (which has
  $n=(k+1)^d$ vertices), $h(T)\in O(D)=O(dk)$. This holds for any $d\ge
  1$ and any $k\ge 1$.  In particular, it implies this result for the
  hypercube ($k=1$ and $d=\log_2 n$), the 2-dimensional grid ($d=2$
  and $k=\sqrt{n}$) and everything in between.
\end{itemize}

A few of our results make use of, and generalize, results on first-passage
percolation with exponential edge weights (Process~FP).  In particular,
we make use of a result of Fill and Pemantle that shows that the
first-passage percolation time on the hypercube is $O(1)$.
We note also that, when the starting graph, $G$, is the complete graph
on $n$ vertices, then the spanning-tree $T$ we obtain is a \emph{random
recursive tree} \cite{X}.  Devroye \cite{devroye} and Pittel \cite{pittle}
have shown that the expected height of the tree in this case is
$(e+o_n(1))\ln n$.

The remainder of this paper is organized as follows:
\Secref{inequalities} presents some basic facts about sums of
independent exponential random variables that we use throughout.
\Secref{upper-bounds} presents our upper bounds on $h(T)$.
\Secref{lower-bounds} presents families of graphs that match our upper
bounds.

\section{Inequalities for Sums of Exponentials}
\seclabel{inequalities}

Recall that an $\exponential(\lambda)$ random variable, $X$, has the
distribution defined by
\[
   \Pr\{X>x\} = e^{-\lambda x} 
\]
and mean $\E[X] = \int_0^{\infty} \Pr\{X>x\}\,\mathrm{d}x = 1/\lambda$.  
We make extensive use of the fact that exponential random variables are
\emph{memoryless}:
\[
    \Pr\{X > t+x\mid X>t\} = \frac{\Pr\{X> t+x\}}{\Pr\{X > t\}}
           = \frac{e^{-\lambda(t+x)}}{e^{-\lambda t}} = e^{-\lambda x} = \Pr\{X > x\} \enspace .
\]
We will also often take the minimum of $k$ independent $\exponential(\lambda)$ random variables and use the fact that this is distributed like an
$\exponential(\lambda k)$ random variable:
\[
   \Pr\{\min\{X_1,\ldots,X_k\} > x\} 
      = (\Pr\{X_1 > x\})^{k}
      = e^{-k\lambda x} \sim \exponential(\lambda k) \enspace .
\]
We will make use of two inequalities for sums of exponential random
variables, both of which can be obtained using Chernoff's bounding
method.  If $Z_1,\ldots,Z_k$ are independent $\exponential(\lambda)$
random variables (so that they each have mean $\mu=1/\lambda$), then
for all $d>1$,
\begin{equation}
    \Pr\left\{\sum_{i=1}^k Z_i \le \mu k/d\right\} \le \exp(-k(\ln d -1 + 1/d)) \le \left(\frac{e}{d}\right)^k  \eqlabel{head-bound}
\end{equation}
and for all $t>1$, 
\begin{equation}
    \Pr\left\{\sum_{i=1}^k Z_i \ge \mu k t\right\} \le \exp (k-kt/2) \enspace . \eqlabel{tail-bound}
\end{equation}

The distribution of the sum of $k$ independent $\exponential(\lambda)$
random variables has a name, it is called the $\erlang(k,\lambda)$
distribution, i.e.,
\[
    \erlang(k,\lambda) \sim \sum_{i=1}^k X_k \enspace ,
\]
where $X_1,\ldots,X_k$ are independent $\exponential(\lambda)$ random variables.
If $Y_1,\ldots,Y_d$ are $\erlang(2,1)$ random variables, then
\begin{equation}
    \E[\min\{Y_1,\ldots,Y_d\}] = \left(\frac{2\pi+o_d(1)}{d}\right)^{1/2}  \enspace . \eqlabel{erlang-two}
\end{equation}
(This is a special case of a more general result that will be discussed below.)
If $Z_1,\ldots,Z_d$ are $\erlang(3,1)$ random variables, then
\begin{equation}
    \E[\min\{Z_1,\ldots,Z_d\}] = \left(\frac{C_d}{d}\right)^{1/3}  \eqlabel{erlang-three} \enspace ,
\end{equation}
where $C_d =  6^{1/3}\Gamma (1/3) / 3 + o_d(1)$.  The following is a brief justifcation of \eqref{erlang-three}: If $M$ is the minimum of $d$ independent $\erlang(3,1)$ random 
variables, then $Md^{1/3}$ tends in distribution to a random variable 
$Z$: $\Pr\{Z>z\} = \exp(-z^3/6)$, and $\E[Z]= \int_0^\infty \exp(-z^3/6)\,
\mathrm{d}z = 6^{1/3}\Gamma (1/3) / 3$. 

Finally, in one special case we will have random variables
$Q_1,\ldots,Q_\delta$ where each $Q_i=X_i+Y_i$ with $X_i\sim\exponential(1)$
and $Z_i\sim\exponential(d)$ with all $X_i$ and $Y_i$ independent.  We will need the following generalization of
\eqref{erlang-two}:
\begin{equation}
   \E[\min\{Q_1,\ldots,Q_d\}] = \left(\frac{2\pi+o(1)}{\delta d}\right)^{1/2}
     \enspace .
     \eqlabel{weird-one}
\end{equation}
Luc can justify this.



\section{Upper Bounds}
\seclabel{upper-bounds}

In this section, we prove our upper bounds. All of them are based on
the following meta-Theorem:

\begin{lem}\lemlabel{meta-theorem}
   Let $G$ be an $n$-vertex graph, $s\in V(G)$, $a\ge 1$, $0\le p<1$, $c>0$, 
   $L=\ceil{ceaK}$, and $T$ be the tree produced by running Process~FP
   on $G$ starting at $s$.  If 
   \begin{enumerate}
      \item the probability that the first-passage percolation time is greater than $K$ is at most $p$; and

      \item the number of simple paths in $G$ that begin at $s$ and have
        length $L$ is at most $a^L$;
   \end{enumerate}
   then $h(T) \le L$ with probability at least $1-p-c^{-ceaK}$.
\end{lem}

\begin{proof}
   If $h(T)> L$, then at least one of the following two events occurred:
   \begin{enumerate}
     \item $T$ contains a root-to-leaf path of weight greater than $K$.
     \item $G$ contains a path starting at $s$ of length $L$ whose weight 
        is less than $K$.
   \end{enumerate}
   By assumption, the probability of the first event is at most $p$.  
   The weight of a single path of length $L$ is the sum of $L$ $\exponential(1)$
   random variables so, by \eqref{head-bound} and the union bound over
   all $a^L$ paths, the probability of the second event is at most
   \[
       a^L \left(\frac{eK}{L} \right)^L \le \left(\frac{1}{c}\right)^{ceaK}
       \enspace . \qedhere
   \]
\end{proof}

\lemref{meta-theorem} says that we can attack our problem from two
sides. We need upper bounds on the first-passage percolation time as well
as upper bounds on the number of paths of length $L$ originating at $s$.
Generally speaking, if we can improve either of these upper bounds,
we obtain an improved bound on $h(T)$.

We begin with a universal upper bound on first-passage percolation time.

\begin{lem}\lemlabel{percolation}
  Let $G$ be an $n$-vertex graph of diameter $D$ and let $T$ be the
  tree obtained by running Process~FP on $G$.  Then, with probability
  at least $1-1/n$, the weight of the heaviest root-to-leaf path in $T$
  is at most $((4\ln n)/D+2)D$.
\end{lem}

\begin{proof}
  Let $v$ be a vertex of $G$ such that there exists a path
  $P=v_0,\ldots,v_k$ with $k$ edges in $G$ from $s=v_0$ to $v=v_k$.
  Let $e_i=v_{i-1}v_i$ be the $i$th edge on this path.

  In Process~FP, each edge $e_i$ is assigned an exponential weight $X_i$.
  The path from $s$ to $v$ in $T$ does not have weight greater than
  $W(P)=\sum_{i=1}^k X_i$.
  \begin{align*}
      \Pr\left\{W(P)\ge \left(\frac{4\ln n}{k}+2\right)k\right\} 
        & \le \Pr\left\{Z_1+\cdots Z_k\ge \left(\frac{4\ln n}{k}+2\right)k\right\} \\ 
        & \le \exp\left(k - \left(\frac{4\ln n}{k}+2\right)k/2\right) 
            & \text{(using \eqref{tail-bound})} \\
      & = 1/n^2 \enspace .
  \end{align*}
  For each $v\in V(G)$, let $W(v)$ denote the weight of the path, in
  $T$, from $s$ to $v$, and define $W^*=\max\{W(v):v\in V(G)\}$  as the
  weight of the heaviest root-to-leaf path in $T$.  For each vertex $v$,
  $G$ contains a path from $s$ to $v$ of length at most $D$. Therefore,
  by the discussion above and the union bond,
  \[
      \Pr\{W^*> ((4\ln n/D)+2)D\} 
          \le \sum_{v\in V(G)}\Pr\{W(v) \ge ((4\ln n/D)+2)D\}     
       \le 1/n \enspace . \qedhere
  \]
\end{proof}

\subsection{Graphs of Bounded Maximum Degree}

\begin{thm}\thmlabel{alantree-upper-bound}
  Let $G$ be an $n$-vertex graph with diameter $D$ and maximum degree $\Delta$
  and let $T$ be the tree obtained by running Process~FP starting at
  any vertex $s\in V(G)$.  Then, with probability at least $1-O(1/n)$,
  $h(T)\le 2e\Delta D(4\ln n/D)+2)$.
\end{thm}

\begin{proof}
  This is an application of \lemref{meta-theorem} with $a=\Delta$, $p=1/n$,
  $K=(4\ln n/D)+2)D$ and $c=2$.
  \begin{enumerate}
     \item By \lemref{percolation}, the weight of the heaviest
       root-to-leaf path in $T$ is upper bounded by $K=D(4\ln n/D)+2)$ 
       with probability
       at least $1-1/n$.
     \item Since $G$ has maximum degree $\Delta$, the number of paths
       that begin at $s$ and have length $L$ is at most $\Delta^L=a^L$.
  \end{enumerate}
  \lemref{meta-theorem} states that $h(T)\le ceaK = 2e\Delta D(4\ln n/D)+2)$ with probability at least $1-1/n-c^{-ceaK}\ge 1-1/n-1/n^2$.
\end{proof}

Note that $n$-vertex graphs of maximum degree $\Delta$ have diameter
$D>\log_\Delta n$, so \thmref{alantree-upper-bound} is asymptotically
tight for graphs of constant maximum degree:

\begin{cor}
  Let $G$ be an $n$-vertex graph with diameter $D$ and maximum degree
  $\Delta\in O(1)$ and let $T$ be the tree obtained by running Process~FP
  starting at any vertex $s\in V(G)$.  Then, with probability at least
  $1-O(1/n)$, $h(T)\in O(D)$.
\end{cor}

\subsection{Grids and Hypercubes}

The \emph{$d$-cube} is the graph having vertex set $\{0,1\}^d$ in
which two vertices are adjacent if and only if they differ in exactly
one coordinate.  Every vertex in the $d$-cube has degree $d$ and the
$d$-cube has diameter $D=d$.  The $d$-cube is an interesting example
in which the path count is high, but this is counteracted by a low
first-passage percolation time.

\begin{thm}\thmlabel{alantree-upper-bound-hypercube}
  Let $n=2^d$, let $G$ be the $d$-cube and let $T$ be the tree obtained
  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
  with probability at least $1-o_n(1)$, $h(T)\in O(d)$.
\end{thm}

\begin{proof}
  Fill and Pemantle \cite{fill.pemantle:percolation} show that the weight of
  the heaviest root-to-leaf path in $T$ (the first-passage percolation
  time) for the hypercube is at most 14.05 with probability $1-o_n(1)$.
  Every vertex of the hypercube has degree $d$, so the number of paths
  of length $L$ starting at $s$ is less than $d^L$.  The result then follows
  by applying \lemref{meta-theorem} with $p=o_n(1)$, $c=2$, $K=14.05$,
  and $a=d$.
\end{proof}

The \emph{$(d,k)$-grid} is the graph with vertex set $\{0,\ldots,k\}^d$
and an edge between two vertices if and only if the (Euclidean or
$\ell_1$) distance between them is 1.  The $(d,k)$-grid has $n=(k+1)^d$
vertices, diameter $D=kd$, and maximum degree at most $\Delta=2d$. Note
that the $d$-cube is a special case; it is the $(d,1)$-grid.

\thmref{dk-grid-foxtrot}, in \appref{dk-grid-foxtrot}, shows that
the first-passage percolation time in the $(d,k)$-grid is $O(k)$ with
probability $1-o_n(1)$.  Applying \lemref{meta-theorem} with 
the first-passage percolation bound in \thmref{dk-grid-foxtrot} yields
the following:

\begin{cor}
  Let $n=(k+1)^d$, let $G$ be the $(d,k)$-cube and let $T$ be the tree obtained
  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
  with probability at least $1-o_n(1)$, the height of $T$ is $O(dk)$.
\end{cor}



\subsection{Degenerate Graphs}

A graph $G$ is $d$-degenerate if every induced subgraph of $G$ has
a vertex of maximum degree $d$.  The following lemma shows that, for
large $L$, $d$-degenerate graphs have considerably less that $\Delta^L$
walks of length $L$.

\begin{lem}\lemlabel{few-walks}
   Let $G$ be an $n$-vertex $d$-degenerate graph with maximum degree
   $\Delta$.  Then the number of walks in $G$ of length $L$ is at most
   $2n2^{L}(d\Delta)^{L/2}$.  In particular, if $L > D\log\Delta$, then
   the number of walks in $G$ of length $L$ is at most $(cd\Delta)^{L/2}$
   for some constant $c$.
\end{lem}

\begin{proof}
   Order the vertices of $G$ $v_1,\ldots,v_n$ so that $v_i$ has at most
   $d$ edges in the subgraph induced by $v_i,\ldots,v_n$ (this ordering
   is obtained by repeatedly removing a vertex of degree at most $d$).

   Let $W=v_{i_0},\ldots,v_{i_L}$ be any walk of length $L$ in $G$ and
   let $k$ denote the number of indices $\ell$ such that $i_{\ell-1}
   < i_{\ell}$.  
   If $k\ge L/2$ then we can specify $W$ in the following way:
   \begin{enumerate}
     \item We first specify the starting vertex $v_{i_0}$.  There $n$
       ways to do this.
     \item Next we specify whether $i_{\ell-1} < i_{\ell}$ for each
       $\ell\in\{1,\ldots,L\}$.  There are $2^L$ ways to do this.
     \item Next, we specify each edge of $W$.  For each
       $\ell\in\{1,\ldots,L-1\}$, if $i_{\ell} < i_{\ell+1}$,
       then there are at most $d$ ways to do this, otherwise there are at most $\Delta$
       ways to do this.
      Therefore, the total number of ways to specify all edges of the walk
      is at most  
      \[   d^k\Delta^{L-k} \le (d\Delta)^{L/2}  \enspace ,\]
      since $d\le \Delta$ and $k\ge L/2$.
   \end{enumerate}
   Therefore, the total number of walks of length $L$ for which $k\ge
   L/2$ is at most $n2^L(d\Delta)^{L/2}$ and the total number of walks
   of length $L$ is at most twice this: $2n2^L(d\Delta)^{L/2}$.

   The second part of the theorem comes from the fact that $D\ge
   \log_\Delta n$ so, when $L>D\log\Delta=\log n$,
   \[ (32d\Delta)^{L/2} \ge 2n2^L \enspace . \qedhere \]
\end{proof}

\begin{thm}\thmlabel{alantree-upper-bound-degenerate}
  Let $G$ be an $n$-vertex $d$-degenerate graph with diameter $D$ and
  maximum degree $\Delta$ and let $T$ be the tree obtained
  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
  with probability at least $1-O(1/n)$, $h(T)\in O(\sqrt{d\Delta}(D+\log n))$.
\end{thm}

\begin{proof}
  The proof is an application of \lemref{meta-theorem} with
  $a=(cd\Delta)^{1/2}$, $p=1/n$, $K=O(D+\log n)$ and $c=2$. This bound
  on $a$ is justified by \lemref{few-walks}.
\end{proof}


\subsubsection{Remarks}
\seclabel{degeneracy-discussion}

Note that \thmref{alantree-upper-bound-degenerate} actually implies
\thmref{alantree-upper-bound}, since all graphs of maximum degree $\Delta$
are $\Delta$-degenerate so $\sqrt{d\Delta}\le \Delta$ in all cases.
However, \thmref{alantree-upper-bound-degenerate} covers many special
graph classes:

\begin{itemize}
  \item Planar graphs are 5-degenerate. (This is a consequence of Euler's
    formula and the fact that planarity is preserved under taking subgraphs).
  
  \item The \emph{thickness} of a graph is the minimum number of planar
    graphs into which the edges of $G$ can be partitioned. Graphs of
    thickness $t$ are $5t$-denegenerate.  (This follows from definitions
    and the $5$-degeneracy of each individual planar graph in the
    partition.)

  \item The \emph{Euler genus} of a graph is the minimum Euler genus of
    a surface on which the graph can be drawn without crossing edges.  Graphs of
    Euler genus $g$ are $O(\sqrt{g})$-degenerate.

  \item A \emph{tree decomposition} of a graph $G$ is a tree $T'$ whose
  vertex set $B$ is a collection of subsets of $V(G)$ called \emph{bags}
  with the following properties:
  \begin{enumerate}
    \item For each edge $vw$ of $G$, there is at least one bag $b\in B$
      with $\{v,w\}\subseteq B$.
    \item For each a vertex $v$ of $G$, the subgraph of $T'$ induced by
      the set of bags that contain $v$ is connected.
  \end{enumerate}
  The \emph{width} of a tree-decomposition is one less than the size
  of its largest bag.  The treewidth of $G$ is the width of the minimum
  width tree decomposition of $G$.
  Graphs of treewidth $k$ are $k$-degenerate. (This is a consequence
  of the fact that $k$-trees are edge-maximal graphs of treewidth $k$.)
\end{itemize} 

Therefore, \thmref{alantree-upper-bound-degenerate} implies that,
when the relevant parameter, $g$, $t$ or $k$, is constant, $h(T)\in
O(\sqrt{\Delta}(D+\log n))$ with high probability.  


%In the next section,
%we show that these results are asymptotically tight, at least when  $D\in
%\Omega(\log n)$.

\subsection{Graphs of Bounded Genus}

\thmref{alantree-upper-bound} implies that, when $G$ has Euler genus
$g$, $h(T)\in O(g^{1/4}\Delta^{1/2}(D+\log n))$.
Here we show that the dependence on the genus $g$ can be reduced when
the diameter, $D$, is large compared to the genus.  Specifically, the
following theorem gives an improved bound when $D\in\omega(g^{3/4}\log
\Delta)$.

\begin{lem}\lemlabel{few-paths-genus}
   Let $G$ be a simple $n$-vertex graph of Euler genus $g$, diameter
   $D$, and maximum degree $\Delta$. Then the number of simple paths
   in $G$ of length $L$ is at most $2n2^{L}6^{L/2-3g}\Delta^{L/2+3g}$.
   In particular, if $L>D\log\Delta$, then the number of simple paths
   in $G$ is at most $(c\Delta)^{L/2+3g}$ for some constant $c$.
\end{lem}

\begin{proof}
   The following proof makes use some basic notions related to graphs
   on surfaces; see Mohar and Thomassen \cite{mohar.thomassen:graphs} for basic
   definitions and results.
   Since $G$ has Euler genus $g$, it has a 2-cell embedding in a surface
   of Euler genus $g$.  Euler's formula then states that 
   \begin{equation}
      e = n+f-2+g \enspace ,  \eqlabel{euler}
   \end{equation}
   where $n$ and $e$ are the numbers of vertices and edges of
   $G$ and $f$ is the number of faces in the embedding of $G$.  
   Every edge is on the boundary of at most 2 faces of the embedding
   and, since $G$ is simple, 
   every face is
   bounded by at least 3 edges.  Therefore, $f \le 2e/3$, so \eqref{euler}
   becomes
   \[
       e\le 3n-6+3g \enspace .
   \]
   Therefore, the average degree of an $n$-vertex Euler genus $g$ graph
   is at most $6+(6g-12)/n$.  In particular, if $n \ge 6g$, then $g$
   has average degree less than 7, so $G$ contains a vertex of degree
   at most $6$.
  
   When we remove a vertex from $G$ we obtain a graph whose Euler genus is
   not more than that of $G$.  Therefore, by repeatedly removing a degree
   6 vertex, we can order the vertices of $G$ as $v_1,\ldots,v_n$ so that,
   for each $i\in\{1,\ldots,n-6g\}$, $v_i$ has at most 6 neighbours among
   $v_{i+1},\ldots,v_n$.  We call $v_{n-6g+1},\ldots,v_n$ \emph{annoying
   vertices} and edges between them are \emph{annoying edges}.

   Let $P=v_{i_0},\ldots,v_{i_L}$ be any simple path of length $L$
   in $G$.  An edge $v_{i_\ell}v_{i_{\ell+1}}$ in $P$ is \emph{bad}
   if it is annoying or if $i_{\ell}>i_{\ell+1}$. If an edge of $P$
   is not bad, then it is \emph{good}.  Let $k$ denote the number of
   good edges in $P$.

   If $k\ge n/2-3g$ then we can specify $P$ in the following way:
   \begin{enumerate}
     \item We first specify the starting vertex $v_{i_1}$.  There $n$
       ways to do this.
     \item Next we specify whether each edge of $P$ is good or bad.
       There are $2^L$ ways to do this.
     \item Next, we specify each edge of $P$.  For each good edge,
       there are at most 6 ways to do this. For each bad edge there are 
       at most $\Delta$ ways to do this.
      Therefore, the total number of ways to specify the edges of $P$ is at most
      \[   6^k\Delta^{L-k} \le 6^{L/2-3g}\Delta^{L/2+3g}  \enspace ,\]
      since $k\ge L/2-3g$ and $\Delta\ge 6$.
   \end{enumerate}
   Therefore, the total number of simple paths of length $L$ for which
   $k\ge L/2-3g$ is at most $n2^L6^{L/2-3g}\Delta^{L/2+3g}$.  Any simple
   path uses most $6g$ annoying edges.  Therefore, for any simple path
   $P$ of length $L$, either $P$ or its reverse has $k\ge L/2-3g$.
   Thus, the total number of simple paths of length $L$ is at most
   $2n2^L6^{L/2-3g}\Delta^{L/2+3g}$ as required.
\end{proof}


\begin{thm}\thmlabel{alantree-upper-bound-genus}
  Let $G$ be an $n$-vertex Euler-genus $g$ graph with diameter $D$,
  maximum degree $\Delta$ and let $T$ be the tree obtained by running
  Process~FP starting at any vertex $s\in V(G)$.  There exists a constant
  $C$ such that, if $g\ln\Delta \le C\Delta^{1/2}D$ then,
  with probability at least $1-o_n(1)$,
  $h(T)\in O(\sqrt{\Delta}(D+\log n))$.
\end{thm}

\begin{proof}
  The proof is an application of \lemref{meta-theorem}.  Notice that,
  for $L\ge 3g\ln\Delta$, the number of simple paths in $G$ of length
  $L$ is at most
  \[
     (c\Delta)^{L/2+3g} 
        = \left((c\Delta)^{1/2+3g/L}\right)^L
        \le \left((c\Delta)^{1/2+1/\ln\Delta}\right)^L
        \le \left((e\Delta)^{1/2}\right)^L
        = (ce\Delta)^{L/2} \enspace .
  \]
  Therefore, we apply \lemref{meta-theorem} with $a=(ce\Delta)^{1/2}$,
  $p=1/n$, $K\in O(D+\log n)$, and $c=2$.  Then,
  \[
      L=\ceil{2eaK} \in \Omega(\Delta^{1/2}D) \enspace .
  \]
  Therefore, with a sufficiently large $C$, the condition $g\ln\Delta \le C\Delta^{1/2}D$ implies that $L\ge 3\ln\Delta$, which justifies the choice of $a$.
\end{proof}


\section{Lower Bounds}
\seclabel{lower-bounds}

Next, we describe a series of lower bound constructions that match the
upper bounds obtained in the previous section.  In particular, these
constructions show that the dependence on $\Delta$ in the upper bounds
in the previous section can not be asymptotically reduced.

%It is natural to ask if one can eliminate or reduce the dependence on
%$\Delta$ in the results of the previous section.  Intuitively, high degree
%should produce spanning trees of lower height.  However, the example
%of a sequence of $D/2$ $(\Delta-1)$-cliques joined in sequence (see
%\figref{clique-path}) shows that Process~A may produce spanning trees
%of diameter $\Omega(D\ln\Delta)$.  Therefore the dependence on $\Delta$
%can not be eliminated entirely; there is at least a logarithmic dependence
%on $\Delta$.
%
%\begin{figure}
%  \begin{center}
%    \includegraphics{figs/clique-path}
%  \end{center}
%  \caption{A sequence of $D/2$ $(\Delta-1)$-cliques gives a graph $G$
%   with diameter $D$ and maximum degree $\Delta$ for which Process~A
%   produces a spannning tree of height $\Omega(D\log\Delta)$.}
%  \figlabel{clique-path}
%\end{figure}
%
%Next we show that, in fact, a linear dependence on $\Delta$ is necessary
%for general graphs: For any $\Delta$ and any $D\in\Omega(\log\Delta)$,
%we can construct a graph $G=G_{D,\Delta}$ of diameter $D$ and
%maximum degree $\Delta$ for which Process~A produces a spanning
%tree of diameter $\Omega(\Delta D)$.  Thus, the upper-bound of
%\thmref{alantree-upper-bound} is asymptotically tight.
%We construct
%We also construct examples of graphs of thickness
%$\Theta(d)$ and graphs of treewidth $\Theta(d)$ for which the tree
%$T$ has height $\Omega(\sqrt{\Delta d}D)$, thereby showing that the
%upper bound in \thmref{alantree-upper-bound-degenerate} for $d$-degenerate
%graphs is tight for these families of graphs.

\subsection{Lower Bounds for General Graphs}

The graph $G$ is obtained by gluing together two graphs $H$ and $I$.
The graph $H$ has high diameter and high connectivity.  The graph $I$
has low connectivity and low diameter.  By joining them we obtain a graph
of low diameter (because of $I$) but for which Process~A is more likely
to find paths in $H$ (because of its high connectivity).  We begin by
defining and studying $H$ and $I$ independently.


\subsection{The Ladder Graph $H$}

Fix some integers $L,\delta\in\N$ to be described later and some
constant $a>1$, also described later.  Refer to
\figref{h}.  The vertices of $H$ are partitioned in to $L$ groups
$V_1,\ldots,V_L$, each of size $\delta$. The edge set of $H$ is
\[
   E(H) = \bigcup_{i=1}^{L-1} \{vw : v\in V_{i},\, w\in V_{i+1}\} \enspace .
\]
\begin{figure}
  \begin{center}
    \includegraphics{figs/h} 
  \end{center}
  \caption{The graph $H$.}
  \figlabel{h}
\end{figure}

First we show that $H$, under the models of Process~E and Process~FP
has very low-weight paths between its vertices.
Assign an independent $\exponential(1)$ weight to each edge of $H$.
Let $d_H(v,w)$ denote the weight of the minimum weight path from $v$
to $w$ in the resulting weighted graph.

\begin{lem}\lemlabel{lightning}
   For any vertex $v\in V_i$ and any vertex $w\in V_j$, $j>i$,
   \[
       \Pr\{d_H(v,w) > t(j-i-1)/\delta + r) \} \le
       \begin{cases}
           \exp(-r) & \text{if $j-i=1$} \\
           \exp((1-t/2)(j-i-1)) + \exp(-r) & \text{otherwise.}
       \end{cases}
   \]
\end{lem}

\begin{proof}
   Consider the following greedy algorithm for finding a path from $v$
   to $w$: The path starts at $v$ (which is in $V_i$).  When the path
   has reached some vertex $x\in V_{k}$, for $k<j-1$, the algorithm
   extends the path by taking the minimum-weight edge joining $x$ to some
   vertex in $V_{k+1}$.  When the algorithm reaches some $x\in V_{j-1}$,
   it takes the edge $xw$.

   Let $m=j-i$.  Each of the first $m-1$ edges in the resulting path
   has a weight that is the minimum of $\delta$ $\exponential(1)$
   random variables.  Thus, the weight of these edges is the sum of
   $m-1$ $\exponential(\delta)$ random variables $X_1,\ldots,X_{m-1}$.
   By \eqref{tail-bound},
   \begin{equation}
     \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta \right\} \le 
        \exp((1-t/2)(m-1)) \enspace .  \eqlabel{part-i}
   \end{equation}
   The last edge in this path has a weight $X_m$ that is an
   $\exponential(1)$ random variable.  From the definition
   of the exponential distribution,
   \begin{equation}
      \Pr\{X_m > r\} = \exp(-r) \enspace . \eqlabel{part-ii}
   \end{equation}
   We complete the proof with the union bound:
   \begin{align*}
      \Pr\{d_H(v,w) > t(m-1)/\delta + r\} &
        = \Pr\left\{\sum_{\ell=1}^m X_m > t(m-1)/\delta + r\right\} \\
        & \le \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta\right\}
          + \Pr\{X_m>r\} \\
        & \le \exp((1-t/2)(m-1)) + \exp(-r) \enspace . \qedhere
   \end{align*}
\end{proof}

Note that the proof of \lemref{lightning} actually studies the length of
the greedy path from $v$ to $w$; call this $d_H^{\mathrm{greedy}}(v,w)$.
For a fixed $k$, $\Pr\{d_H^{\mathrm{greedy}}(v,w) > k\}$ is clearly
maximized for $v\in V_1$ and $w\in V_L$. Therefore, by taking
$r=aL/(e^2\delta)$ and $t=a/e^2$ (so that $tL/\delta+r = 2aL/(e^2\delta)$)
we obtain the following special case of \lemref{lightning}:

\begin{cor}\corlabel{lightning}
  For any $i$ and $j$ and any $v\in V_i$, $w\in V_j$, 
  \[
    \Pr\{d_H(v,w) > 2aL/(e^2\delta)\} 
        \le \exp((1-a/(2e^2))L) + \exp(-aL/(e^2\delta)) \enspace . 
  \]
\end{cor}

\subsection{The Subdivided Tree $I$}

Next, we consider a graph $I$ that is obtained by starting with a complete
binary tree having $L$ leaves and then subdividing each edge incident
to a leaf $\lceil aL/\delta\rceil-1$ times so that each leaf-incident
edge becomes a path of length $\lceil aL/\delta\rceil$.  Note that $I$
has height $\lceil aL/\delta\rceil+\lceil\log_2 L\rceil$.

Assign independent $\exponential(1)$ edge weights to each edge of $I$
and, for two leaves $v$ and $w$, let $d_I(v,w)$ denote the weight of
the unique path from $v$ to $w$.

\begin{lem}\lemlabel{slow-train}
   $\Pr\{d_I(v,w) \le 2aL/(e^2\delta)\} \le \exp(-2aL/\delta)$
\end{lem}

\begin{proof}
  The path from $v$ to $w$ in $I$ contains at least $2\lceil
  aL/\delta\rceil$ edges.  Therefore, the weight of this path is
  lower-bounded by the sum of $2\lceil aL/\delta\rceil$ independent
  $\exponential(1)$ random variables.  The lemma then follows by applying
  \eqref{head-bound} to this sum.
\end{proof}


\subsection{Putting it Together}

The lower-bound graph $G$ is now constructed by taking a tree $I$ with
$L$ leaves and a graph $H$ with $L$ groups $V_1,\ldots,V_L$ each of size
$\delta=\lfloor(\Delta-1)/2\rfloor$.  Next, we consider the leaves of
$I$ in the order they are encountered in a depth first-traversal of $I$
and, for each $i\in\{1,\ldots,L\}$ we identify the $i$th leaf of $I$
with some vertex in $V_i$.  See \figref{g}.

\begin{figure}
  \begin{center}
    \includegraphics{figs/g}
  \end{center}
  \caption{The lower bound graph $G$. Dotted segments denote subdivided edges (path of length $\lceil aL/\delta\rceil$).}
  \figlabel{g}
\end{figure}

Note that the graph $G$ has maximum degree $\Delta\le 2\delta+1$.
Furthermore, every vertex of $G$ is either in $I$, or adjacent to a
vertex in $I$.  Therefore, $G$ has diameter
\[
    D = 2+2(\ln L + aL/\delta) = O(L/\Delta) \enspace ,
\]
for $L\in\Omega(\Delta\ln\Delta)$.

Note that the graph $G$ has three parameters $a$, $L$, and $\Delta$,
so we will call this graph $G(a,L,\Delta)$.
%\[
%   D\in O((\ln\delta + \ln\ln L)\ln L + L/\delta) = O(L/\Delta)
%\]
%for $L\in\Omega(\Delta\ln\Delta\ln\ln\Delta)$.  That is, for any
%$\Delta$ and any $D\in\Omega(\ln\Delta\ln\ln\Delta)$ we can construct
%a graph $G$ with diameter $D$ and maximum degree $\Delta$.
%
\begin{thm}\thmlabel{alantree-lower-bound}
  For every $\Delta\ge 3$ and every $L\in\Omega(\Delta\ln\Delta)$, there
  exists a constant $a$ such that If we run Process~A on $G(a,L,\delta)$
  starting at some vertex $s\in V_1$, then with probability at least
  $1-o_L(1)$, the resulting spanning tree contains a path of length at
  least $L-1$.
\end{thm}

\begin{proof}
  In the Process~FP view, we assign each edge of $G$ an $\exponential(1)$
  edge weight and compute a shortest path tree $T$ rooted at $s$ in
  the resulting weighted graph.  Consider the path $P$ in $T$ from $s$
  to an arbitrary vertex $t$ in $V_L$.  If $P$ uses no edges of $T$,
  then it has at least $L-1$ edges.  If $P$ does use some edge of $T$,
  then this implies that there are two leaves $v$ and $w$ of $I$ such
  that $d_H(v,w) \ge d_I(v,w)$.

  Using \corref{lightning} and \lemref{slow-train}, we have
  \begin{align*}
     \Pr\{d_H(v,w) \ge d_I(v,w)\}
       & \le \binom{L}{2}\left(\Pr\{d_H(v,w) > 2aL/\delta\} + \Pr\{d_I(v,w) < 2aL/\delta\}\right)  \\
       & \le \binom{L}{2}\left(\exp((1-a/2e^2)L) 
                + \exp(-aL/(e^2\delta)) 
                + \exp(-2aL/\delta)
              \right)
  \end{align*}
  For large $L$, this probability tends to zero when $a\ge \max\{4e^2, 3e^2\delta\ln L/L\}$.  Such a constant $a$ exists for any $L\in\Omega(\Delta\log\Delta)$.
\end{proof}

\subsection{Lower Bounds for Degenerate Graphs}

Next we show that the construction given above can be adapted to graphs
of low degeneracy.

\begin{thm}\thmlabel{alantree-lower-bound-planar}
  For every $\Delta\ge 3$ and every $L\in\Omega(\sqrt{\Delta}\ln\Delta)$,
  there exists a planar graph $G$ with maximum degree $\Delta$, diameter
  $O(L/\sqrt{\Delta})$ and having a vertex $s$ such that, if we run
  Process~A on $G$ starting at $s$, then with probability at least
  $1-o_L(1)$, the resulting spanning tree contains a path of length at
  least $2L-1$.
\end{thm}

\begin{proof}
  The graph $G$ is very similar to $G(a, L,\delta)$ except that the ladder
  graph $H$ is replaced with the planar graph shown in \figref{planar-h}.
  The tree, $I$ attached to $H$ is the same as before, but it's bottom
  edges are only subdivided $aL/\sqrt{\delta}$ times.  The resulting
  graph is planar, has diameter $D\in\Theta(L/\sqrt{\delta})$ and maximum
  degree $\Delta\in O(\delta)$.

  \begin{figure}
    \begin{center}
      \includegraphics{figs/planar-h}
    \end{center}
    \caption{The graph $H$ in the proof of \thmref{alantree-lower-bound-planar}.}
    \figlabel{planar-h}
  \end{figure}
 
  In this graph, one can go from any vertex in $V_i$ to some vertex in 
  $V_{i+1}$ by taking a path
  whose weight is the minimum of $\delta$ $\erlang(2,1)$ random
  variables.  The expected length of this path is therefore at most
  $\ell=c(L-1)/\sqrt{\delta}$ for some constant $c$. Therefore, there is
  a path from any vertex in $V_1$ to some vertex in $V_L$ whose weight is
  the sum of independent random variables $X_1,\ldots,X_{L-1}$, where each
  $X_i$ is distributed like the minimum of $\delta$ $\erlang(2,1)$ random
  variables. Any standard trick for concentrating sums of independent
  random variables then shows that the probability that the weight of
  this path exceeds $2\ell$ is $o_L(1)$.

  As in the proof of \thmref{alantree-lower-bound}, this implies
  that the only way in which a path of length at least $2L-1$ does not
  appear in $T$ is if $I$ contains a path from one leaf to another whose
  weight is less than $2\ell$.  As in the proof of \lemref{slow-train},
  \eqref{tail-bound} shows that, when $a$ is chosen sufficiently large,
  the probability this is occurs is $o_L(1)$.
\end{proof}


\begin{thm}\thmlabel{alantree-lower-bound-degenerate}
  For every $\Delta\ge 3$, $d\le \Delta$ and every
  $L\in\Omega(\sqrt{d\Delta}\ln\Delta)$, there exists a $d$-degenerate
  graph $G$ with maximum degree $\Delta$, diameter $O(L/\sqrt{d\Delta})$
  and having a vertex $s$ such that, if we run Process~A on $G$ starting
  at $s$, then with probability at least $1-o_L(1)$, the resulting
  spanning tree contains a path of length at least $2L-1$. Furthermore,
  the graph $G$ has thickness at most $d$ and treewidth at most $3d+1$.
\end{thm}

\begin{proof}
  Again, the graph $G$ is very similar to $G(a, L,\delta)$ except that
  the ladder graph $H$ is replaced with a sequence of $2L-1$ groups
  of vertices, $V_{1},V_{1}',V_2,V_2',\ldots,V_{L-1},V_{L-1}',V_L$.
  See \figref{degenerate-h}.  Each consecutive pair in this sequence
  forms a complete bipartite graph.  Each $V_i$ has $\delta$ vertices
  and each $V_i'$ has $d$ vertices.  The tree portion, $I$, of $G$ is
  as before except that the edges incident to leaves are now subdivided
  $aL/\sqrt{d\delta}$ times.  The resulting graph, $G$, has diameter
  $D=O(L/\sqrt{d\delta})$, and maximum degree $\Delta = 2\delta+1$.

  \begin{figure}
    \begin{center}
       \includegraphics{figs/degenerate-h}
    \end{center}
    \caption{The $d$-degenerate graph $H$ used in the proof of
       \thmref{alantree-lower-bound-degenerate}. In this example, $\delta=7$
        and $d=3$.}
    \figlabel{degenerate-h}
  \end{figure}

  The graph $G$ is $d$-degenerate because the vertices of degree greater
  than $d$ form an independent set. Therefore, every induced subgraph
  of $G$ is either an independent set (so has a vertex of degree 0)
  or contains a vertex of degree at most $d$.

  To see that $G$ has thickness $d$, assign each vertex of each
  $V_{i'}$ to one of $d$ color classes, so that each $v\in V_i'$ is
  assigned a distinct colour.   Now partition the edges incident to
  these vertices amond $d$ subgraphs depending on the color of the
  vertex they are assigned to.  Edges not incident to these vertices
  can be assigned to any subgraph.  With this partition of edges, each
  subgraph becomes a subgraph of the planar graph used in the proof of
  \thmref{alantree-lower-bound-planar}.

  To see that $G$ has treewidth $3d+1$, we show a tree decomposition
  of $G$ with bags of maximum size $3d+2$.  For convenience, we will
  define $V_0=V_{L+1}=\emptyset$.

  We begin with a tree $T'$ of bags that has the same shape as $I$ and,
  for each vertex $v$ of $I$, let $B_v$ denote the bag corresponding
  to $v$.
  \begin{enumerate}
    \item Assign each vertex of $v$ of $I$ to $B_v$ and the (up to 2)
      children of $B_v$ in $T'$.

    \item Let $v_1,\ldots,v_L$ be the
     leaves of $I$ ordered so that each $v_i\in V_i$. In the leaf bag
     $B_{v_i}$ of $T'$ we add all vertices in
     $V_{i-1}'$ and $V_{i'}$.

     Now each vertex in $V_{i'}$ appears in $B_{v_i}$ and $B_{v_{i+1}}$
     so we add all the elements of $V_i'$ to each of the $B_v$ the path
     from $v_i$ to $v_{i+1}$ in $I$.

    \item  Finally, to each $B_{v_i}$ we attach $\delta-1$ bags as leaves
     of $T'$ and in each bag we place all the vertices in $V_i'$,
     $V_{i+1}'$, and a distinct vertex of $V_i\setminus\{v_i\}$. We
     call each such bag $B_v$, where $v$ is the unique vertex of
     $V_i\setminus\{v_i\}$ contained in the bag.
  \end{enumerate}

  No bag contains more than $3d+2$ vertices: For each vertex $v$ of
  $I$, $B_v$ contains at most two vertices from $I$ ($v$ and $v$'s
  parent) and possibly all of $V_{i-1}'$, $V_i'$ and $V_{i+1}'$ for
  some $i\in\{1,\ldots,L\}$).  For each $v\in V_i\setminus\{v_i\}$,
  $B_v$ contains at most $2d+1$ vertices; $v$ and the vertices in
  $V_{i-1}'\cup V_{i}'$.

  For each edge $vw$ of $G$, there is some bag that contains both $v$
  and $w$: If $vw$ is an edge of $T$ with $v$ a child of $w$ then $B_v$
  contains both $v$ and $w$. Otherwise, $v\in V_i$ and $w\in V_{i-1}'$
  or $w\in V_{i}'$, in which case $v$ and $w$ appear in $B_v$.

  Finally, for each vertex $v$ of $G$, the subgraph of $T'$ induced by
  bags containing $v$ is connected: For a vertex $v\in I$ this subgraph
  is either an edge or a single vertex.  For a vertex $v\in V_i$ this
  subgraph is a single vertex.  For a vertex $v\in V_{i'}$ this subgraph
  is a path joining two vertices of $T'$.

  Therefore, $T'$ is a tree-decomposition of $G$ with whose largest bag
  has size $3d+2$.  Therefore $G$ has treewidth at most $3d+1$.

  As before, all that remains is to show that with probability
  $1-o_L(1)$, there is a path from $s\in V_1$ to some vertex $v\in
  V_{L}$ whose weight is at most $cL/\sqrt{d\delta}$.  Again, we
  find this path with a greedy algorithm.  To move from some vertex
  $v\in V_i'$ to $V_{i+1}'$, we consider $\delta d$ paths from $v$ to a
  vertex in $V_{i+1}$ to a vertex in $V_{i+1}'$ and take the lightest one.
  The weight of the second edge of each such path is the minimum of
  $d$ independent $\exponential(1)$ random variables, so it is an
  $\exponential(d)$ random variable.  The first edge of each such
  path is an $\exponential(1)$ random variable.  Thus, the weight of the
  path we choose is distributed like $\min\{Z_i:i\in\{1,\ldots,\delta\}\}$,
  where each $Z_i=X_i+Y_i$ with $X_i\sim
  \exponential(1)$ and $Y_i\sim\exponential(\delta)$ and all variables
  independent.

  A fairly simple calculation, done somewhere else (?) shows that
  \[
      \E[\min\{Z_i:i\in\{1,\ldots,\delta\}\}] \le c/\sqrt{d\delta} \enspace .
  \]
  Therefore, the expected weight of the path found by the greedy algorithm
  is at most $cL/\sqrt{d\delta}$.  The weight of this path is the sum
  of $L$ independent (and reasonable) random variables so the probability
  that it exceeds $c'L/\sqrt{d\delta}$ for some sufficiently large constant
  $c'$ is $o_L(1)$.
\end{proof}

 

%\section{Some Fluff}
%
%This is just a place to try out a few arguments.  First, let's look at high dimensional grids:
%
%\subsection{Grids in Higher Dimensions}
%\label{sec:grids_old}
%
%The $d$-dimensional $(n+1)\times\cdots (n+1)$ grid is the is the graph
%whose vertex set is $\{0,\ldots,n\}^d$ and in which two vertices are
%adjacent if their Euclidean distance is exactly 1.
%
%The grid has diameter $D=dn$ and maximum degree $\Delta=2d$.  For
%$d=O(1)$, \thmref{alantree-upper-bound} gives an asymptotically tight bound of
%$O(n)$ on the height of the spanning tree, but for non-constant $d$,
%gives an upper bound of $O(d^2n) = O(dD)$, which is not obviously tight.
%Here, we argue that, at least for a very large range of $d$, the height
%of the spanning tree is only $O(dn)=O(D)$.
%
%\begin{lem}\lemlabel{grid}
%  If $G$ is a $d$-dimensional $(n+1)\times\cdots\times(n+1)$  grid with
%  $d\in o(n/\log n)$ then, with probability at least $1-O(n^{-ad})$, the
%  lightest path from $(n,\ldots,n)$ to $(0,\ldots,0)$ has weight $O(n)$.
%\end{lem}
%
%\begin{proof}
%Consider the \emph{greedy path} that repeatedly chooses the minimum weight edge
%that reduces a vertex coordinate.  This greedy path will reach $(0,\ldots,0)$ after exactly $dn$ steps.  Let  
%\[
%    r=dn-\sqrt{ad^3n\ln n}
%\]
%Let $\mathcal{E}_r$ denote the event that any coordinate becomes $0$
%during the first $r$ steps.
%We claim that
%\[
%    \Pr\{\mathcal{E}_r\} \le \exp(-\Omega(ad\log n)) \enspace .
%\]
%Indeed, until some coordinate reaches zero, each of the $d$ coordinates
%is equally likely to be reduced.  Therefore, after $r$ steps, the
%number of times the $i$th coordinate has been reduced is dominated by
%a $\binomial(r, 1/d)$ random variable, $B_i$, that has mean 
%\[
%    \mu=r/d = n - \sqrt{adn\ln n} \enspace .
%\]
%Therefore, 
%\begin{align*}
%    \Pr\{B_i \ge n\} 
%       & = \Pr\{B_i \ge (n/\mu)\mu\} \\
%       & = \Pr\left\{B_i \ge 
%           \left(1+\Theta\left(\sqrt{\frac{ad\log n}{n}}\right)\mu\right)\right\} \\
%       & \le \exp(-\Theta(ad\log n)) \\
%       & = n^{-\Theta(ad)} 
%\end{align*}
%where the last inequality is an application of the simplified Chernoff bound
%$\Pr\{X>(1+\epsilon)\mu\} \le \exp(-\epsilon^2\mu/3)$. 
%
%Let $\mathcal{E}$ be the event: $\max\{B_i:i\in\{1,\ldots,d\}\} \ge n$.  Then the union bound gives:
%\[
%    \Pr\{\mathcal{E}_r\}
%    = \Pr\{\max\{B_i:i\in\{1,\ldots,d\}\} \ge n\} 
%    \le d n^{-\Theta(ad)} = n^{-\Theta(ad)} \enspace .
%\]
%Let $X_i$ be the weight of the $i$th edge in the resulting path.
%Then, conditional on $\overline{\mathcal{E}}_r$, $X_1,\ldots,X_r$ are
%independent $\exponential(d)$ random variables. By \eqref{tail-bound},
%\[
%   \Pr\left\{\sum_{i=1}^r X_i > tn\,\Bigg{|}\, \overline{\mathcal{E}}_r\right\}  
%        \le \exp((1-t/2)n) \enspace .
%\]
%On the other hand, for $i>r$, $X_i$ is dominated by an $\exponential(1)$
%random variable, so
%\[
%   \Pr\left\{\sum_{i=r+1}^{dn} X_i > n \right\}  
%      \le \exp\left(-\Theta(n)\right) \enspace .
%\]
%Therefore the probability that the greedy path (and hence the lightest path) has weight more than $2tn$ is at most 
%\[
%    \Pr\{\mathcal{E}_r\} + \exp((1-t/2)n) + \exp(-\Theta(n)) = n^{-\Omega(ad)} \enspace ,
%\]
%for $d\in o(n/\log n)$ and $t\ge 3$. 
%\end{proof}
%
%For the general case, in which we want to bound the lightest path from
%$(0,\ldots,0)$ to $(x_1,\ldots,x_d)$, we can appeal to the view in which
%each edge has an exponential timer that keeps resetting itself when it
%rings and we pretend we're in an infinite grid, but we ignore any ring
%that would take us outside of $[0,x_1]\times\cdots\times[0,x_d]$. We run
%this process until we hear $nd-r$ rings, at which point have crossed
%edges for every coordinate at least $nd-o(n/d)$ times, so we're within
%distance distance $o(n)$ from the destination vertex.  
%
%\subsection{Slightly simplified argument for grids in higher dimensions}
%\newcommand{\prob}[1]
%{\Pr\left\{ #1\right\}}
%
%In this section we provide a slightly simpler proof for grids in higher dimensions (so we re-prove everything in Section~\ref{sec:grids_old}).
%
%We consider the $d$-dimensional grid with vertex set
%$\{0,1,\dots,n-1\}^d$, which has $n^d$ vertices.
%Define $\lambda = 2 + 3 d \ln n / n$.
%The main lemma is:
%\begin{lem}\label{lem:gridcovertime}
%With probability at least $1-1/n$,
%Process FP is completed by time $\lambda n$.
%\end{lem}
%
%An immediate corollary is that the height of our randomly grown spanning tree is bounded by maximum degree times $\lambda n$, which is $O(dn + d^2 \ln n)$.
%Since $dn$ is an obvious lower bound, this is tight whenever $d = O( n/\ln n)$.
%
%\begin{proof}[Proof of Lemma~\ref{lem:gridcovertime}]
%Suppose we orient each edge decreasingly:
%if $uv$ is an edge, and $v$ is closer to origin than $u$,
%then we orient the edge from $u$ to $v$.
%For any given vertex $v$, we prove that with probability at least $1-n^{-d-1}$, there is a directed path of weight $\lambda n$ to the origin. Union bound over all vertices completes the proof.
%
%We consider the greedy algorithm for building this path: start from $v$; in each step, among all out-going edges, choose an edge with minimum weight and move along that.
%Note that, if the current vertex has $k$ positive coordinates, then the out-degree is $k$, and the expected weight of next edge is $1/k$,
%and this edge is equally likely to be any of the $k$ outgoing edges.
%
%We now take an alternative viewpoint:
%suppose there are $d$ independent exponential clocks with rate 1, one for each coordinate.
%We build the greedy path as follows:
%we start from $v$;
%whenever the $i$-th clock rings, if the $i$-th coordinate is positive, decrease this coordinate by 1, and reset the clock.
%Note that the time it takes to reach the origin, is precisely the weight of the greedy path.
%This is easy to see, e.g.\ by induction:
%suppose we are at a vertex with $k$ positive coordinates.
%Then, we may just focus on the corresponding $k$ clocks.
%The expected time to hear a ring is $1/k$, and this ring is equally likely to come from any of the $k$ clocks.
%Whenever we make a step, by memoryless property of exponential distribution, we can think that all clocks are reset.
%
%In this clock-based viewpoint, as soon as all clocks have rung at least $n$ times, we have arrived at the origin.
%Consider the first clock.
%The time it takes for this clock to ring $n$ times is
%$X_1+\dots+X_n$,
%where $X_i$ are i.i.d.\ exponentials with rate 1.
%So, applying union bound over all clocks, it suffices to have
%$$d \prob{X_1+\dots+X_n > \lambda n} < n^{-d-1}.$$
%This holds for our choice of $\lambda=2+3d \ln n/n$ (e.g.\ it follows from \eqref{tail-bound}).
%\end{proof}
%
%\subsection{The Hypercube}
%
%Recall that the $d$-dimensional hypercube is the graph on vertex set
%$\{0,1\}^d$ and in which two vertices are adjacent if their Hamming
%distance is 1.
%
%Fill and Pemantle show that on the hypercube, first-passage percolation is complete in $O(1)$ time.  Here we do the same with a somewhat different argument.
%
%\begin{lem}\lemlabel{hypercube}
%Let $G$ be the $d$-dimensional hypercube with indepedenent $\exponential(1)$ edge weights.  Then the lightest path from $s=(0,\ldots,0)$ to $t=(1,\ldots,1)$ has expected weight $O(1)$.
%\end{lem}
%
%\begin{proof}
%Fix some constant $0<\alpha<1$ that will be discussed later.
%We construct a path from $s$ to $t$ as follows:  The first
%$q=\alpha d$ steps of this path make a greedy choice, taking the
%lightest edge that reduces the distance to $t$.  During the $i$th step,
%$i\in\{0,\ldots,q-1\}$, the weight of the edge crossed is the minimum of
%$d-i$ $\exponential(1)$ random variables, so it is an $\exponential(d-i)$
%random variable $X_i$. The expected cost of this part of the path is
%\[
%   \E\left[\sum_{i=0}^{q-1} X_i\right] = 
%   \sum_{i=0}^{q-1} E[X_i] = 
%   \sum_{i=0}^{q-1} 1/(d-i) = H_d-H_q \le \int_q^d x^{-1}\,\mathrm{d}x = \ln(1/\alpha)  \enspace .
%\]
%
%The second part of the path is constructed in a sequence of rounds,
%each consisting of three steps---one step back and two steps forward.
%For each $\ell\in\{0,\ldots,d\}$, let $L_\ell$ be the set of vertices
%having distance $\ell$ from $t$ (so $|L_\ell|={d\choose \ell}$).  Suppose
%that, at the start of a round, the algorithm is at vertex $v\in L_k$.
%Consider the set, $P$, of all paths $v,x,y,z$ with $x\in L_{k+1}$, $y\in
%L_{k}\setminus\{v\}$, and $z\in\{L_{k-1}\}$. The number of paths in
%$P$ is $r=(d-k)k^2$; the paths in $P$ are edge-disjoint; and the weight
%of each path in $P$ is the sum of three independent $\exponential(1)$
%random variables, i.e., it is a $\erlang(3,1)$ random variable.
%
%This means that the lightest path in $P$ has a weight, $Z_k$, that is
%the minimum of $r$ independent $\erlang(3,1)$ random variables.  We know
%that $\E[Z_k]=Cr^{-1/3}$, where $C = C_r = 6^{1/3}\Gamma(1/3)/3 + o_r(1)$.%
%\footnote{If $M$ is the minimum of $r$ independent $\erlang(3,1)$ random
%variables, then $Mr^{1/3}$ tends in distribution to a random variable
%$Z$: $\Pr\{Z>z\} = \exp(-z^3/6)$, and $\E[Z]= \int_0^\infty \exp(-z^3/6)\,
%\mathrm{d}z = C$.}
%Therefore,
%\[
%    \E[Z_k] = Cr^{-1/3} = C((d-k)k^2)^{-1/3} \le C(\alpha dk^2)^{-1/3} \enspace .
%\]
%The expected weight of the second part of the path is therefore
%\begin{align*}
% \E\left[\sum_{k=1}^{d-q} Z_k\right] 
%    & = \sum_{k=1}^{d-q} \E[Z_k] \\
%    & \le C(\alpha d)^{-1/3}\sum_{k=1}^{(1-\alpha)d} k^{-2/3} \\
%    & \le C(\alpha d)^{-1/3}\left(1+\int_1^{(1-\alpha)d} x^{-2/3}\,\mathrm{d}x\right) \\
%    & \le 3C(\alpha d)^{-1/3}((1-\alpha)d)^{1/3} \\
%    & = 3C(\alpha /(1-\alpha))^{1/3} \enspace .
%\end{align*}
%Thus, the total expected length of the resulting path is
%\[
%    \ln(1/\alpha) + 3C(\alpha /(1-\alpha))^{1/3} \enspace . \qedhere
%\]
%\end{proof}
%
%Minimizing the final expression in the proof of \lemref{hypercube}
%gives an upper bound of approximately $4.8$ on the expected weight of
%the resulting path.  This is better than Fill and Pemantle's $2(\ln
%4+2\sqrt{3})+3\approx 7.02$, but does not come close to Martinsson's
%tight bound of $\ln(1+\sqrt{2})\approx 0.881$.
%
%To prove an upper bound on the weight of the heaviest root to leaf path,
%we first need a concentration result on the weight, $W$, of the path from
%$(0,\ldots,0)$ to $(1,\ldots,1)$ of the form $\Pr\{W > C\} = o(2^{-d})$.
%We can do this by showing that the quantities $\sum_{i=1}^q X_i$ and
%$\sum_{k=1}^{d-q} Z_k$ are concentrated around their expected values.
%The first sum is easy---all the terms are independent, so we can apply
%our favourite concentration inequality.  The second sum requires a
%little more care, since the $Z_k$'s are not independent. However, $Z_i$
%is independent of $Z_j$ if $|j-i| > 1$. Thus, we can apply concentration
%inequalities separately to $\sum_{i=1}^{\lfloor q/2\rfloor} Z_{2i}$
%and $\sum_{i=1}^{\lceil q/2\rceil} Z_{2i-1}$.
%
%To see what the $(0,\ldots,0)$ to $(1,\ldots,1)$ case is
%sufficient, consider the following algorithm for finding a path from
%$s=(0,\ldots,0)$ to $v=(b_1,\ldots,b_d)$.  The algorithm starts with a
%set $L=\{1,\ldots,d\}$ and performs $\alpha d$ greedy steps.  When the
%algorithm is at a vertex $u=(u_1,\ldots,u_d)$, it chooses the lightest
%edge that leaves $u$ across a coordinate $i\in L$.  If this edge
%
%XXXXX finish here
%
%\subsection{The Whole Enchilada}
%
%Next we present a theorem that covers the case of the $d$-dimensional
%grid with $n^d$ vertices for any $n$ and any $d$.  As a special case,
%we obtain the hypercube when $n=2$ and $d\to\infty$.   The argument is a generalization of the argument for the hypercube sketched above.
%
%\begin{lem}
%   Let $G$ be the $d$-dimensional grid on vertex set $\{0,\ldots,n\}^d$
%   with independent $\exponential(1)$ edge weights. Then, with
%   probability $1-o(n^{-d})$, $G$ contains a path from $s=(0,\ldots,0)$
%   to $t=(n-1,\ldots,n-1)$ of weight $O(n)$.
%\end{lem}
%
%\begin{proof}
%   For two vertices
%   $v$ and $w$, let $\|vw\|_H$ denote the Hamming distance between $v$ and $w$,
%   i.e., the number of coordinates at which $v$ and $w$ differ.
%   Let $\|vw\|_1$ denote the $L_1$ distance between $v$ and $w$, i.e., $\|vw\|_1=\sum_{i=1}^d |v_i-w_i|$.  Observe
%   that 
%   \begin{equation}
%      \|vw\|_H \ge \|vw\|_1/n \enspace . \eqlabel{hamming-l1}
%   \end{equation}
%
%   We construct the path starting at $s$.  When the path has reached a
%   vertex $v$, it is extended in one of two ways:
%   \begin{enumerate}
%      \item If $\|vt\|_H > \alpha d$, then the path proceeds along the
%      lightest edge incident to $v$ that leads to a vertex that is closer
%      to $t$.  
%
%      \item Otherwise, the path will cross three edges, one that moves
%      further from $t$ and two that move closer to $t$.  For each
%      $\ell\in\{0,\ldots,nd\}$, let $L_\ell$ be the set of vertices
%      having distance $\ell$ from $t$.
%      Consider the set, $P$, of all paths $v,x,y,z$ with
%      $x\in L_{k+1}$, $y\in L_{k}\setminus\{v\}$, and $z\in\{L_{k-1}\}$.
%      The path then proceeds along the lightest path in $P$.
%   \end{enumerate}
%   Since both types of extensions reduce the distance to $t$ by one,
%   this algorithm reaches $t$ after exactly $nd$ iterations.
%
%   In the first case, this algorithm takes a step across an edge whose
%   weight is the minimum of at least $\alpha d$ $\exponential(1)$
%   random variables, so the weight of each such step is dominated by an
%   $\exponential(\alpha d)$ random variable.
%
%   In the second case, this algorithm considers a whole set $P$
%   of edge-disjoint paths.  The weight of each path in $P$ is
%   the sum of three $\exponential(1)$ random variables, so it is a
%   $\erlang(3,1)$ random variable.  Since the paths are edge disjoint,
%   these $\erlang(3,1)$ variables are independent, so the weight of
%   this path is the minimum of $|P|$ independent $\erlang(3,1)$ random
%   variables and has expected value $C|P|^{-1/3}$, where $C = C_{|P|} =
%   6^{1/3}\Gamma(1/3)/3 + o_{|P|}(1)$.%
%   \footnote{If $M$ is the minimum of $r$ independent $\erlang(3,1)$
%   random variables, then $Mr^{1/3}$ tends in distribution to a random
%   variable $Z$: $\Pr\{Z>z\} = \exp(-z^3/6)$, and $\E[Z]= \int_0^\infty
%   \exp(-z^3/6)\, \mathrm{d}z = C$.}
%   To prove our result,
%   we now need a lower-bound on $|P|$.
%
%   To make a path in $P$ we have $d-\|vt\|_H> (1-\alpha)d$ choices for
%   the first edge, $\|v,t\|_H$ choices for the second edge and at least
%   $\|vt\|_H$ choices for the third edge. So
%   \[
%     |P| \ge (1-\alpha)d\|vt\|_H^2 
%         \ge (1-\alpha)d(\|vt\|_1/n)^2 
%     \enspace ,
%   \]
%   where the second inequality is an application of \eqref{hamming-l1}.
%
%   We can now pull everything together. The algorithm proceeds in $nd$
%   rounds, numbered $0,\ldots,nd-1$.  During the $i$th round, the weight
%   of edges crossed is either dominated by an $\exponential(\alpha d)$
%   random variable, $X_i$, or by a random variable $Z_i$ that is the
%   minimum of $(1-\alpha)d((nd-i)/n)^2$ independent $\erlang(3,1)$
%   random variables.  That is, the total weight of the resulting path
%   is dominated by 
%   \[
%      \sum_{i=0}^{nd-1} (X_i + Z_i)
%   \]
%   The sum of $X_i$'s has expected value $n/\alpha$ and the sum of the $Z_i$'s
%   has expected value:
%   \begin{align*}
%       \sum_{i=0}^{nd-1} \E[Z_i] 
%       & = \sum_{i=0}^{nd-1} C((1-\alpha)d(nd-i)/n^2)^{-1/3} \\
%       & = C\left(\frac{(1-\alpha)d}{n^2}\right)^{-1/3}\sum_{i=0}^{nd-1} (nd-i)^{-2/3} \\
%       & = C\left(\frac{(1-\alpha)d}{n^2}\right)^{-1/3}\sum_{i=1}^{nd} i^{-2/3} \\
%       & = C\left(\frac{(1-\alpha)d}{n^2}\right)^{-1/3}(nd)^{1/3} \\
%       & = Cn(1-\alpha)^{-1/3} \enspace .
%   \end{align*}
%   And we get the concentration result using \eqref{tail-bound} and
%   G\'abor's concentration result for the sum of $Z_i$'s.
%\end{proof}


\section*{Acknowledgements}

Some of this research took place at the Workshop on Random Geometric
Graphs and Their Applications to Complex Networks, at the Banff
International Research Station, November 6--11, 2016.  More of this
research took place at the Rio Workshop on Geometry and Graphs, at IMPA,
February 12--18, 2017.  We are grateful to the workshop organizers and
other participants for providing stimulating working environments.

\bibliographystyle{plain}
\bibliography{alantree}

\appendix
\section{First-Passage Percolation-Time Bounds}

In this appendix, we prove (in some cases reprove) some results on
first-passage percolation time.
TODO:Talk about why

These results are all for grid graphs.  The \emph{$(d,k)$-grid} with
vertex set $\{0,\ldots,k\}^d$ and an edge between two vertices if
and only if the (Euclidean or $\ell_1$) distance between them is 1.
For two grid vertices $u=(u_1,\ldots,u_d)$ and $w=(w_1,\ldots,w_d)$
we define the \emph{$\ell_1$ distance} between them as
\[
   \|uw\|_1 = \sum_{i=1}^d |u_i-w_i|
\]
and we define the \emph{Hamming distance} between them as
\[
   \|uw\|_H = \sum_{i=1}^d [u_i\neq w_i] \enspace ,
\]
where $[\cdot]$ denotes the \emph{indicator function} whose value is 0
or 1 depending on whether its argument is false or true, respectively.

\subsection{The Grid with Moderate Dimensions}

First we use a greedy approach to show that, when the dimension $d$
is small compared to $k$, a greedy strategy works to find short paths.

\begin{thm}\thmlabel{dk-grid-moderate}
   Let $n=k^d$, for some $d\in O(k/\log k)$, let $G$ be the $(d,k)$-grid
   and let $T$ be the tree obtained by running Process~FP starting at
   any vertex $s\in V(G)$.  Then, with probability at least $1-o_k(1)$,
   the heaviest root-to-leaf path in $T$ has weight $O(k)$.
\end{thm}

\begin{proof}
   Consider the following \emph{greedy algorithm} to find a light path
   from $s$ to some vertex $v$:  Starting at $s$, repeatedly
   move across the lightest edge that reduces the distance to $v$.

   We analyze this greedy algorithm using the Process~E view. Without
   loss of generality, assume that every coordinate of $v$ is greater
   than or equal every coordinate of $s$.  When the algorithm is at some
   vertex $v$, imagine that there are $d$ independent $\exponential(1)$
   timers $X_1,\ldots,X_d$. When the first of these timers rings, say
   timer $X_i$ we move to the vertex $(v_1,\ldots,v_{i}+1,\ldots,v_d)$
   if that brings us closer to $v$, otherwise we remain at $v$ and reset
   timer $X_i$.  
   Allow the preceding process to run until $ckd$ timer rings have
   occurred.  

   This algorithm may fail in one of two ways:
   \begin{enumerate}
      \item The algorithm may take too long waiting for $ckd$ timer
       rings.  The times between consecutive rings are independent
       $\exponential(d)$ random variables and the weight of the path
       the algorithm traverses is upper-bounded the sum of these random
       variables, which has expectation $ck$ and, by \eqref{tail-bound},
       the probability that it exceeds $2ck$ is at most $\exp(-ckd)$.

      \item The algorithm may fail to reach $v$ at the end of $ckd$ timer
      rings.  This can only happen if, there is some $i\in\{1,\ldots,d\}$,
      such that the timer for coordinate $i$ rang fewer than $k$ times.
      The number of times the timer for coordinate $i$ rings is a
      $\binomial(n,1/d)$ random variable that has expectation $ck$.
      The probability that this number of rings is less than $k$ is
      most $\exp(-(1-1/c)^2ck)$.  Therefore, the probability that the 
      algorithm fails in this way is at most $d\exp(-(1-1/c)^2ck)$
   \end{enumerate} 

   Applying the union bound over each of the $(k+1)^{d}$ choices of $v$
   then proves what we want, provided that
   \[
         \exp(-\Omega(c)k) k^d \to 0 \enspace ,
   \]
   which is true, for some sufficiently large $c$, provided that $d\in O(k/\log k)$.
\end{proof}

\subsection{Hypercube Percolation}

The greedy algorithm described in the previous section fails when the
dimension $d$ is much larger than the side-length $k$.  An extreme
example of this is the hypercube, i.e., the $(d,1)$-grid.  In this case,
it is easy to verify that the greedy algorithm produces a path from $s$
to $v$ whose expected length is
\[
    \sum_{i=1}^{\|sv\|_H} 1/i = \ln \|sv\|_H + O(1) \enspace . 
\]
Here we show that a modification of the greedy algorithm does work.
This result is not new, though the proof is.

\begin{thm}\thmlabel{hypercube-percolation}
  Let $n=k^d$, let $G$ be the $(d,1)$-grid and let $T$ be the tree obtained
  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
  with probability at least $1-o_n(1)$, the heaviest root-to-leaf path
  in $T$ has weight $O(1)$.
\end{thm}

\begin{proof}
  We begin by describing an algorithm for finding a light path from
  $s=(0,\ldots,0)$ to $t=(1,\ldots,1)$.  

  If the algorithm has already found a path from $s$
  to $v$, then it does one of two things depending on the distance
  $\ell=\|vt\|_H$.
  \begin{enumerate}
     \item If $\ell \ge d/2$, then the algorithm selects the lightest
     edge incident to $v$ that brings it closer to $t$. The weight of
     this edge is an $\exponential(\ell)$ random variable, $X_\ell$,
     whose expected value is $1/\ell\le 2/d$.

   \item Otherwise, let $L_i = \{ v\in V(G) : \|vt\|_1=i\}$ denote the
    set of vertices of $G$ whose distance to $t$ is $i$.  The algorithm
    considers the $r=(d-\ell)\ell^2$ paths $vxyz$ that go from $v$ to a
    vertex in $x\in L_{\ell+1}$, $y\in L_{\ell}\setminus v$, and then to
    $z\in L_{\ell-1}$.  Each such path has a weight, $Y_i$, that is the
    sum of three $\exponential(1)$ random variables and is therefore a
    $\erlang(3,1)$ random variable.  No two such paths share an edge,
    so these gamma random variables are independent and their minimum
    has expected value $C/r^{-1/3}$.\footnote{Put Luc's thing here.}
  \end{enumerate}
  Notice that after each step of the algorithm, the distance to $t$ is
  reduced by 1, so the algorithm performs exactly $d$ steps.  The weight
  of the resulting path, $P$, is
  \begin{equation}
     W(P)  = \sum_{\ell=1}^{\lfloor d/2\rfloor} Y_\ell +
              \sum_{\ell=\lfloor d/2\rfloor+1}^d X_\ell
     \eqlabel{foxtrot-weight}
  \end{equation}
  
  Therefore, the expected weight of $P$ is 
  \begin{align*}
      \E[W(P)] & = \sum_{\ell=1}^{\lfloor d/2\rfloor} \E[Y_\ell] +
              \sum_{\ell=\lfloor d/2\rfloor+1}^d \E[X_\ell] \\
    & = \sum_{\ell=1}^{\lfloor d/2\rfloor} C(d-\ell)^{-1/3}\ell^{-2/3} +
     \sum_{\ell=\lfloor d/2\rfloor+1}^d 1/\ell \\
     & \le
     C(d/2)^{-1/3}\sum_{\ell=1}^{\lfloor d/2\rfloor} \ell^{-2/3} + 1 \\
     & = O(1) \enspace .
  \end{align*}

  We have shown how to find a path, $P$, from $s=(0,\ldots,0)$ to
  $t=(1,\ldots,1)$ so that has $\E[W(P)]=O(1)$.  Going from there,
  namely \eqref{foxtrot-weight}, to an upper bound that holds, with high
  probability for all choices of $s$ and $t$ is fairly straightforward.
  The random variables $X_{\lfloor d/2\rfloor+1},\ldots,X_d$ are
  independent, but $Y_1,\ldots,Y_{\lfloor d/2\rfloor}$ are not. However,
  the set $\{Y_\ell : \mbox{$\ell$ is even} \}$ is independent and so is
  the set $\{Y_\ell : \mbox{$\ell$ is odd} \}$.  Therefore, we can split
  \eqref{foxtrot-weight} into three sums, each of independent random
  variables, and apply concentration inequalities to each of them to
  obtain the desired result.  We leave the details to a sufficiently
  interested reader.
\end{proof}

\subsection{A General Theorem}
\applabel{dk-grid-foxtrot}

Next, we show that the ideas used in \thmref{hypercube-percolation}
can be used to provide a general result that holds for all grids of
any dimension and any side-length.  This includes the hypercube and
2-dimensional grid as special cases.

\begin{thm}\thmlabel{dk-grid-foxtrot}
   Let $n=k^d$, let $G$ be the $(d,k)$-grid
   and let $T$ be the tree obtained by running Process~FP starting at
   any vertex $s\in V(G)$.  Then, with probability at least $1-o_n(1)$,
   the heaviest root-to-leaf path in $T$ has weight $O(k)$.
\end{thm}

\begin{proof}
Let $s=(0,\ldots,0)$ and $t=(k,\ldots,k)$. We will describe an algorithm
for finding a path from $s$ to $t$ and analyze its expected running time.
If the algorithm has already constructed a path from $s$ to some vertex $v$,
then it does one of the following, based on $\|vt\|_H$:
\begin{enumerate}

  \item If $\|vt\|_H \ge d/2$, then the algorithm chooses the lightest 
    edge that brings it to a vertex closer to $t$.  The weight of this
    edge is an $\exponential(\|vt\|_H)$ random variable and therefore has
    expected weight at most $1/\|vt\|_H \le 2/d$.

  \item Otherwise, let $L_i = \{v\in V(G): \|vt\|_1=i\}$ and let
    $\ell=\|vt\|_1$ (note the use of $\ell_1$ distance, and not Hamming
    distance here).  The algorithm chooses the lightest path $vxyz$ among
    all paths with $x\in L_{\ell+1}$,  $y\in L_{\ell}\setminus\{v\}$,
    and $z\in L_{\ell-1}$.

    The number of choices of paths is exactly
    \begin{align*}
        r(v) & = (d-\|vt\|_H)\|vt\|_H^2 
               + (\|vs\|_H-d+\|vt\|_H)(\|vt\|_H-1)^2 \\
             & \ge \|vs\|_H(\|vt\|_H-1)^2
    \end{align*}
    The weight of each of these paths is a
    $\erlang(3,1)$ random variable, so the expected weight of the path
    chosen in this step is at most $Cr(v)^{-1/3}$
    %\|vs\|_H^{-1/3}\|vt\|_H^{-2/3}$.
\end{enumerate}
Let $P$ be the path that results from this algorithm.  Let $S$ be the
set of path vertices at which the algorithm used the first option above
and let $T$ be the set of path vertices at which the algorithm used the
second option above.  Then
\begin{align*}
    \E[W(P)] & \le |S|/d + C\sum_{v\in T}r(v)^{-1/3} \\
             & = |S|/d + C\sum_{i=1}^{dk}\sum_{v\in T\cap L_i}r(v)^{-1/3} \\
             & = |S|/d + C/d + C\sum_{i=2}^{dk}\sum_{v\in T\cap L_i}r(v)^{-1/3} \\
             & \le |S|/d + C/d + C\sum_{i=2}^{dk}\sum_{v\in T\cap L_i}\|vs\|_H^{-1/3}(\|vt\|_H-1)^{-2/3} \\
             & \le |S|/d + C/d + C\sum_{i=2}^{dk}\sum_{v\in T\cap L_i}(\|vs\|_1/k)^{-1/3}(\|vt\|_1/k-1)^{-2/3} \\
             & \le |S|/d + C/d + C\sum_{i=2}^{dk}\sum_{v\in T\cap L_i}(\|vs\|_1/k)^{-1/3}(\|vt\|_1/k-1)^{-2/3} \\
\end{align*}


Before we can analyze
$W(P)$, we need a few preliminary observations relating Hamming distance and $\ell_1$ distance.  First, we note that
\begin{equation}
   d-\|vs\|_H \ge \|vs\|_1/k \enspace .
\end{equation}
Next we note that, when using the second option for a vertex $v$, it is because $\|vt\|_H < d/2$, which implies that $\|vs\|_1 \ge dk/2$.
\end{proof}




\end{document}
