\documentclass{patmorin}
\usepackage{pat}
\usepackage{graphicx}
\usepackage{datetime}
%\usepackage{url}

\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor=blue,citecolor=blue,urlcolor=blue}

\usepackage{marvosym}
\makeatletter
\renewcommand*{\@fnsymbol}[1]{\ensuremath{\ifcase#1 %
   \or \text{\Sun}
   \or \text{\Mercury}
   \or \text{\Venus}
   \or \text{\Earth}
   \or \text{\Mars}
   \or \text{\Jupiter}
   \or \text{\Saturn}
   \or \text{\Uranus}
   \or \text{\Neptune}
   \or \text{\Pluto}
  \else\@ctrerr\fi}}
\makeatother

\usepackage[mathlines]{lineno}
\setlength{\linenumbersep}{2.5cm}
%\rightlinenumbers
\linenumbers
\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
  \renewenvironment{#1}%
     {\linenomath\csname old#1\endcsname}%
     {\csname oldend#1\endcsname\endlinenomath}}% 
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
  \patchAmsMathEnvironmentForLineno{#1}%
  \patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
\patchBothAmsMathEnvironmentsForLineno{equation}%
\patchBothAmsMathEnvironmentsForLineno{align}%
\patchBothAmsMathEnvironmentsForLineno{flalign}%
\patchBothAmsMathEnvironmentsForLineno{alignat}%
\patchBothAmsMathEnvironmentsForLineno{gather}%
\patchBothAmsMathEnvironmentsForLineno{multline}%
}


\date{\today, \currenttime}

\DeclareMathOperator{\exponential}{exponential}
\DeclareMathOperator{\binomial}{binomial}
\DeclareMathOperator{\erlang}{Erlang}

\newcommand{\abas}[1]{\textcolor{orange}{\big[Abbas: #1\big]}}
\newcommand{\tcal}{\mathcal{T}}

\title{\MakeUppercase{Notes on Growing a Tree in a Graph}\thanks{%
This research was partly supported by NSERC and by NSF GRANT DMS1661063.
Some of this work was carried out while Vida Dujmovi\'c, Pat Morin, and
Bruce Reed were visiting IMPA in Rio de Janeiro. They thank the Institute
for its hospitality. }}
\author{
%   Louigi Addario-Berry
   Luc~Devroye,\thanks{School of Computer Science, McGill University, Montr\'eal, Canada}\,\,
   Vida~Dujmovi\'c,\thanks{Department of Computer Science and Electrical Engineering, University of Ottawa, Ottawa, Canada}\,\,
   Alan~Frieze,\thanks{Department of Mathematical Sciences, Carnegie Mellon University, Pittsburgh, USA}\,\,
%   G\'abor~Lugosi,
   Abbas~Mehrabian,\thanks{Department of Computer Science, University of British Columbia, Vancouver, Canada. 
   This author was
       supported by an NSERC Postdoctoral Fellowship and a Simons-Berkeley
       Research Fellowship. Part of this work was done while he was
       visiting the Simons Institute for the Theory of Computing at UC
       Berkeley.}\,\,
       %Email: AbbasMehrabian@gmail.com.},
%   Colin McDiarmid
   Pat~Morin,\thanks{School of Computer Science, Carleton University, Ottawa, Canada}\,\, and
   Bruce~Reed\thanks{CNRS, Projet COATI, I3S (CNRS and UNS) UMR7271 and INRIA, Sophia Antipolis, France. Instituto Nacional de Matem\'atica Pura e Aplicada (IMPA), Brasil. Visiting
Research Professor, ERATO Kawarabayashi Large Graph Project, Japan.}
%   and Anastasios~Sidiropoulos 
}

\pagenumbering{roman}

\begin{document}
\maketitle

\begin{abstract}
We study the height of a spanning tree $T$ of a graph $G$ obtained by
starting with a single vertex of $G$ and repeatedly selecting, uniformly
at random, an edge of $G$ with exactly one endpoint in $T$ and adding
this edge to $T$.
\end{abstract}

\newpage 
\tableofcontents
\newpage

\pagenumbering{arabic}
\section{Introduction}
Let $s$ be a vertex of a simple connected graph $G$ on $n$ vertices.
We build a sequence $T_1,T_2,\dots,T_n$ of random subtrees of $G$ as follows.
The tree $T_1$ has a single vertex, $s$.
For each $1<i\leq n$, tree $T_i$ is obtained by choosing
a uniformly random edge of $G$ with exactly one endpoint in $T_{i-1}$,
and adding the edge to $T_{i-1}$.
Note that $T_n$ is a (not necessarily uniform) random spanning tree of $G$ rooted at $s$, which we denote by $\tcal(G,s)$.
In this paper we study the height (maximum length of a root-to-leaf path) of $\tcal(G,s)$ and give several bounds for it in terms of parameters of $G$.

In the special case when $G$ is the complete graph, 
each tree $T_i$ is obtained from $T_{i-1}$ by choosing a uniformly random node of $T_{i-1}$ and joining a new leaf to that node.
This is the well studied \emph{random recursive tree} process,
and 
Devroye \cite{devroye:branching} and Pittel \cite{pittel:note} have
shown that the height of $T_n=\tcal(K_n,s)$ is
$(e+o(1))\ln n$ with probability $1-o(1)$.

%This is exactly the \emph{random recursive tree} model of random trees.
%Devroye \cite{devroye:branching} and Pittel \cite{pittel:note} have
%shown that the expected height of an $n$-node random recursive tree is
%$(e+o_n(1))\ln n$.  More precisely, they show that $\lim_{n\to\infty}
%h(T)/\ln n = e$ with probability 1. Our results on graphs with high
%edge-expansion can be viewed as a generalization of this result.

\subparagraph{Our results.}
Let $D=D(G)$ and $\Delta=\Delta(G)$ denote the diameter and maximum degree of $G$, respectively, and let us denote 
the height of a tree $T$ by $h(T)$.
An obvious lower bound for $h(\tcal(G,s))$ is $D/2$.
We prove the following bounds hold with probability $1-o_n(1)$ for any $n$-vertex graph $G$ and any $s\in V(G)$.
(The notation $o_k(1)$ denotes the set of functions $f:\R\to\R$ such
that $f(k)\to 0$ as $k\to\infty$.)

%In this paper we show that the height of $T$ depends (obviously) on
%the diameter, $D$, of $G$ and (less obviously) on the maximum degree,
%$\Delta$, of $G$.  We prove the following results (all of which hold
%with probability $1-o_n(1)$:

\begin{enumerate}
  \item In Theorem~\ref{thm:alantree-upper-bound} we show $h(\tcal(G,s))\in O(\Delta(D+\log n))$.
  For $D\in \Omega(\log \Delta)$ this is tight: in~\thmref{genericlowerbound} we show that for every $\Delta\ge  2$ and every $D \ge e^6\ln\Delta$, there exist $G$ and $s$ with 
   $h(\tcal(G,s))\in \Omega(\Delta(D+\log n))$.

  \item If $G$ is $d$-degenerate (that is, every subgraph of $G$ has a vertex of degree at most $d$),
  then in Theorem~\ref{thm:alantree-upper-bound-degenerate} we show  $h(\tcal(G,s))\in
    O(\sqrt{d\Delta}(D+\log n))$.  The class of $O(1)$-degenerate
    graphs is quite rich and includes every minor-closed graph family. 
  This upper bound is tight, even for planar graphs ($d=5$), graphs
  of thickness $t$ ($d=5t$), and graphs of treewidth $k$ ($d=k$).
  (The concepts of Euler genus, thickness, and treewidth
    are defined in \secref{degeneracy-discussion}).

For $D\in \Omega(\log \Delta)$ and planar graphs (which are 5-degenerate) this is tight:
  in~\thmref{planartight} we show 
  for any $\Delta>2$ and $D>10^6\ln \Delta$
  there exists a planar graph $G$ and vertex $s$ with
  $h(\tcal(G,s))\in
      \Omega(\sqrt{\Delta}(D+\log n))$.
  
Also, for $D\in \Omega(\log \Delta)$ and $d\leq\Delta$ this is tight:
in~\thmref{alantree-lower-bound-degenerate} we show 
for any $\Delta>1$, $D>10^6\ln \Delta$
and $d \leq \Delta$
there exist a $d$-degenerate graph $G$ and vertex $s$ with
$h(\tcal(G,s))\in
    \Omega(\sqrt{d\Delta}(D+\log n))$
    
  \item  If $G$ has Euler genus less than $C\sqrt{\Delta}D/\log\Delta$, then
  $h(\tcal(G,s))\in O(\sqrt{\Delta}(D+\log n))$ 
  (see \thmref{alantree-upper-bound-genus})  .
  For $D\in \Omega(\log \Delta)$ and zero Euler genus this is tight:
  in~\thmref{planartight} we show 
  for any $\Delta>2$ and $D>10^6\ln \Delta$
  there exist a planar graph $G$ and vertex $s$ with
  $h(\tcal(G,s))\in
      \Omega(\sqrt{\Delta}(D+\log n))$
  

  \item For any $d,k\geq1$, if $G$ is the $d$-dimensional grid of side-length $k$ (which has
  $n=(k+1)^d$ vertices), we have $h(\tcal(G,s))\in O(dk+d^{5/3}\ln(k+1))$.
  If $k=2$ or $k/\ln(k+1)=\Omega(d^{2/3})$, we have $h(\tcal(G,s))\in \Theta(D)=\Theta(dk)$
  (see \thmref{alantree-upper-bound-hypercube} and \corref{bestgrid}).

  \item If $G$ has edge-expansion factor\footnote{The
  edge expansion factor and related quantities are defined in
  \secref{edge-expanders}.} (i.e., Cheeger constant) $\Phi$, then
  $h(\tcal(G,s))\in O(\Phi^{-1}\Delta\log n)$ (see \thmref{alantree-upper-bound-cheeger}).  This implies, for example,
  that $h(\tcal(G,s))\in O(\log n)$ if $G$ is the complete graph or if $G$ is
  a random $\Delta$-regular graph (since a random $\Delta$-regular
  graph has $\Phi\in \Omega(\Delta)$, see~\cite{bollobas:isoperimetric}).
\end{enumerate}

Our main tool for proving upper bounds, \lemref{meta-theorem}, bounds
$h(\tcal(G,s))$ in terms of the first-passage percolation cover time and
the number of paths of  a given length starting at $s$.  To prove our
results using this tool, we prove several new bounds on first-passage
percolation cover times  as well as the number of simple paths in various
families of graphs, which are of independent interest.

\subparagraph{Our results on first-passage percolation cover time.}
Suppose independent exponential(1) random variables $\{\tau_e\}$ are assigned to edges of $G$.
Let $\Gamma(s,v)$ denote the set of all $(s,v)$-paths in the graph.
Then the \emph{first-passage percolation cover time} is defined as 
\[
	\tau(G,s) = \max_{v\in V(G)} \min_{\gamma\in\Gamma(s,v)} \sum_{e\in\gamma} \tau(e)
\]
In \lemref{percolation} we show a general upper bound of 
$O(\ln n + D)$ for $\tau(G,s)$. (This and the following results hold with probability $1-o_n(1)$.)

In the special case when $G$ is the $d$-dimensional grid with side length $k$ (and diameter $dk$), we prove the improved bound 
$\tau(G,s)=O(k+d^{2/3}\ln(k+1))$,
which is $O(k)$ when $k/\ln(k+1)=\Omega(d^{2/3})$
The special case of $k=1$, namely the $d$-cube graph, was studied by Fill and Pemantle~\cite{fill.pemantle:percolation}, who showed $1.414\leq \tau(G,s)\leq 14.041$.
The upper bound was subsequently improved to
$1.694$
by Bollob\'as and Kohayakawa~\cite{bollobas.kohayakawa:on} 
and recently to $1.575$ by Martinsson~\cite{martinsson:unoriented}.
We conjecture that for all $k$ and $d$ we have
$\tau(G,s)=O(k)$.

%$1-o_d(1)$, the first-passage percolation time on the $d$-cube is at
%most $14.05+o_d(1)$.  This was later improved to $1.693 +o_d(1)$ by
%Bollob\'as and Kohayakawa \cite{bollobas.kohayakawa:on} and recently to
%$1.574 +o_d(1)$ by Martinsson \cite{martinsson:unoriented}.  This should
%be compared with the best lower bound, also due to Fill and Pemantle
%\cite{fill.pemantle:percolation} of $1.414-o_d(1)$.



The remainder of the paper is organized as follows: 
\Secref{inequalities} presents some preliminaries
and useful facts about sums of independent  random variables,
In~\secref{sec:fpp_connection} we present the connection with first-passage percolation and prove a general upper bound.
\Secref{degeneracy}--\secref{grids} present our
upper bounds on $h(T)$.  
\Secref{lower-bounds} and
\secref{lowerdegenerate}
present families of
graphs with matching lower bounds.

We use the following notational conventions: $\log x$ denotes the binary
logarithm of $x$ and $\ln x$ denotes the natural logarithm of $x$.
Every graph, $G$, that we consider
is finite, simple, undirected and connected, and $n$ denotes its number of vertices.

\section{Preliminaries}
\label{sec:prelim}
%\subsection{Inequalities for Sums of Exponentials}
\seclabel{inequalities}

Recall that an $\exponential(\lambda)$ random variable, $X$, has a
distribution defined by
\[
   \Pr\{X>x\} = e^{-\lambda x}  \enspace , \enspace x\ge 0 \enspace ,
\]
and mean $\E[X] = \int_0^{\infty}
\Pr\{X>x\}\,\mathrm{d}x = 1/\lambda$.  We make extensive use of the fact
that exponential random variables are \emph{memoryless}:
\[
    \Pr\{X > t+x\mid X>t\} = \frac{\Pr\{X> t+x\}}{\Pr\{X > t\}}
           = \frac{e^{-\lambda(t+x)}}{e^{-\lambda t}} = e^{-\lambda x} = \Pr\{X > x\} \enspace .
\]
We will also often take the minimum of $\delta$ independent $\exponential(\lambda)$ random variables and use the fact that this is distributed like an
$\exponential(\lambda \delta)$ random variable:
\[
   \Pr\{\min\{X_1,\ldots,X_\delta\} > x\} 
      = (\Pr\{X_1 > x\})^{\delta}
      = e^{-\delta\lambda x} \sim \exponential(\lambda \delta) \enspace .
\]
We will make use of two concentration inequalities for sums of exponential random
variables, both of which can be obtained using Chernoff's bounding
method (see, e.g., \cite[Theorem~5.1]{janson}).  If $Z_1,\ldots,Z_k$ are independent $\exponential(\lambda)$
random variables (so that they each have mean $\mu=1/\lambda$), then
for all $d>1$,
\begin{equation}
    \Pr\left\{\sum_{i=1}^k Z_i \le \mu k/d\right\} \le \exp(-k(\ln d -1 + 1/d)) \le \left(\frac{e}{d}\right)^k  \eqlabel{head-bound}
\end{equation}
and for all $t>1$, 
\begin{equation}
    \Pr\left\{\sum_{i=1}^k Z_i \ge \mu k t\right\} \le \exp (k-kt/2) \enspace . \eqlabel{tail-bound}
\end{equation}
The sum of $k$ independent $\exponential(\lambda)$
random variables is called an $\erlang(k,\lambda)$ random variable.
%distribution.
%, i.e.,
%\[
%    \erlang(k,\lambda) \sim \sum_{i=1}^k X_k \enspace ,
%\]
%where $X_1,\ldots,X_k$ are independent $\exponential(\lambda)$ random variables.

%\abas{I am not sure if we need the following result any more, since it follows, up to the constant factors, from~\lemref{sqrtab} }
%If $Y_1,\ldots,Y_\delta$ are $\erlang(2,1)$ random variables, then
%\begin{equation}
%    \E[\min\{Y_1,\ldots,Y_\delta\}] = \left(\frac{2\pi+o_\delta(1)}{\delta}\right)^{1/2}  \enspace . \eqlabel{erlang-two}
%\end{equation}
%\begin{todo}
%Add short justification here. 
%\end{todo}

For positive integers $a$, $b$ and $c$, we define two random variables $Y_{a,b}$  and $Y_{a,b,c}$ as follows.
Consider a tree in which the root has $a$ children,
 each of the root's children have $b$ children,
and each of root's grandchildren have $c$ children.
This is a tree of height 3 with
$1 + a + ab + abc$ nodes. 
Put an independent exponential(1) weight on each edge.
Then $Y_{a,b}$ is defined as the minimum weight of a path from the root to a node at level 2,
and $Y_{a,b,c}$ is defined as the minimum weight of a root-to-leaf path.

The following auxiliary lemmas are proved in the appendix.

\begin{lem}
\lemlabel{sqrtab}
Let $X_1,\dots,X_m$ be i.i.d.\ distributed as $Y_{a,b}$ for some $a,b$.
Then we have
$\E X_1 =O(1/a+1/\sqrt{ab})$ and moreover,
\[
\Pr\left\{\sum_{i=1}^m X_i \geq 3 m (64/a + 1024/\sqrt{ab}) \right\}
\leq
\exp(-m/9)\:.
\]
\end{lem}

Let 
$\Gamma(t) \coloneqq \int_0^\infty x^{t-1} {\rm e}^{-x} \mathrm{d} x$.
If $t$ is a positive integer, then it is well known that $\Gamma(t)=(t-1)!$.

\begin{lem}
\lemlabel{yabcmoments}
For any positive integer $p$ we have
\[
\E Y_{a,b,c}^p \leq
 p (a/64)^{-p}\Gamma(p)
+ p(ab/1024)^{-p/2}\Gamma(p/2)/2
+ p(abc/16384)^{-p/3}\Gamma(p/3)/3
\]
and, in particular,
$\E Y_{a,b,c} \leq 64/a+1024/\sqrt{ab} + 16384/\sqrt[3]{abc}$.
\end{lem}

Finally, we will also use the following
version of Bernstein's inequality (see Theorem~2.10 and Corollary~2.11 in~\cite{boucheron2013concentration}).

%\abas{The fact that lemmas and theorems have separate counters makes it very difficult for the reader to find them!}

\begin{thm}[Bernstein's inequality]
\label{thm:bernstein}
Let $X_1,\dots,X_m$ be non-negative independent random variables for which there exist $v,c$ satisfying
\[\sum_{i=1}^m \E [X_i^p] \leq v p!  c^{p-2}/2\]
for all positive integers $p\geq2$.
Then for any $t>0$ we have
\[
\Pr \left\{ \sum_{i=1}^m (X_i - \E X_i) \geq ct + \sqrt{2vt}\right\}\leq e^{-t} \:,
\]
and
\[
\Pr \left\{ \sum_{i=1}^m (X_i - \E X_i) \geq t
\right\}\leq \exp\left(-\frac{t^2}{2v+2ct}\right) \:,
\]
\end{thm}


%If $Z_1,\ldots,Z_\delta$ are $\erlang(3,1)$ random variables, then
%\begin{equation}
%    \E[\min\{Z_1,\ldots,Z_\delta\}] = \left(\frac{C_\delta}{\delta}\right)^{1/3}  \eqlabel{erlang-three} \enspace ,
%\end{equation}
%where $C_\delta =  6^{1/3}\Gamma (1/3) / 3 + o_\delta(1)$.  The following is a brief justifcation of \eqref{erlang-three}: If $M$ is the minimum of $\delta$ independent $\erlang(3,1)$ random 
%variables, then $M\delta^{1/3}$ tends in distribution to a random variable 
%$Z$: $\Pr\{Z>z\} = \exp(-z^3/6)$, and $\E[Z]= \int_0^\infty \exp(-z^3/6)\,
%\mathrm{d}z = 6^{1/3}\Gamma (1/3) / 3$. 
%
%Finally, in one special case we will have random variables
%$Q_1,\ldots,Q_\delta$ where each $Q_i=X_i+Y_i$ with $X_i\sim\exponential(1)$
%and $Y_i\sim\exponential(d)$ with all $X_i$ and $Y_i$ independent.  We will need the following generalization of
%\eqref{erlang-two}, which holds for all $\delta \ge d \ge 3$:
%\begin{equation}
%   \E[\min\{Q_1,\ldots,Q_\delta\}] \le \frac{\sqrt{2\pi}+1}{\sqrt{\delta d}}
%     \enspace \enspace ,
%     \eqlabel{non-uniform-erlang}
%\end{equation}
%The proof of this is found in \appref{lucs-lemma}.
%

%We will also use the following concentration inequality in a few places (note that the constants have not been optimized, but they suffice for our purposes).
%\abas{this needs to be updated, depending on our needs!}
%
%
%\begin{lem}
%Let $X$ be a random variable with $\Pr\{X>0\}=1$,
%and suppose there exists  $K>1$ such that $\E{e^{tX}}\leq e^{tK}$ for all $0\leq t \leq 1/K$.
%If $S_n$ is a sum of $n$ independent copies of $X$, then
%\[\Pr\left\{S_n \geq \left(\frac{2K}{\E X}\right) \E \left[S_n\right] \right\} \leq e^{-n} \: .\] 
%\end{lem}
%\begin{proof}Let $t=1/K$ and $C=2K/\E X$. Then,
%\begin{align*}
%\Pr\left\{S_n \geq C \E \left[S_n\right] \right\} &
%= \Pr\left\{\exp(tS_n) \geq \exp(tC \E \left[S_n\right]) \right\} \\
%& \le \E[\exp(tS_n)] \exp(-tC \E \left[S_n\right]) \\
%& = \left(\E[\exp(tX)]\right)^n\exp(-tCn \E [X]) \\
%& \le \left(\exp(tK)\right)^n\exp(-tCn \E [X]) = e^{-n} \:.\qedhere
%\end{align*}
%\end{proof}

\section{Connection with first-passage percolation and a generic upper bound}
\seclabel{sec:fpp_connection}

%We consider the following process for growing a spanning tree, $T$, of an
%$n$-vertex undirected connected graph $G$ starting at some vertex $s\in
%V(G)$. Intially, $T=(s,\emptyset)$ is the single vertex tree containing
%only $s$. We then repeatedly select, uniformly at random, an edge from
%$E(G)$ that has one endpoint in $V(T)$ and one endpoint not in $V(T)$
%and we add this edge to $T$.  For an $n$-vertex connected graph $G$,
%the tree $T$ spans $G$ after $n-1$ iterations.  We call this Process~A.
%We are interested in the height of the (random) spanning tree generated
%by Process~A.
%
%It turns out that there are several equivalent views of Process~A.
%A slower version, called Process~B is obtained by repeatedly selecting
%a uniformly random edge of $G$ and adding it to $T$ if and only if
%exactly one endpoint of the edge is in $T$.  The number of iterations
%of Process~B required before $T$ spans $G$ is now variable, but the
%distribution of the resulting spanning tree is the same as Process~A.
%(We can think of Process~B as implementing the edge selection of Process~A
%using rejection sampling.)
%
%Consider the following, which we call Process~E (for exponential).
%On each edge of $G$ we attach an $\exponential(1)$ timer.  When the
%timer on an edge $vw$ rings the timer is immediately reset and, if
%exactly one of $v$ or $w$ is in $T$, then the edge $vw$ is added to $T$.
%We say that Process~E is \emph{complete} once $T$ spans $G$.  Note that,
%by the memorylessness of exponential random variables, at any point in
%time, each edge is equally likely to be the next edge whose timer rings.
%Thus, Process~E produces spanning trees with the same distribution as
%those produced by Process~B, and hence also Process~A.
%
%Also, by the memorylessness of exponential random variables, Process~E
%is equivalent to selecting an exponential(1) edge \emph{weight} for
%each edge of $G$ and then computing the shortest (or rather, lightest)
%path tree rooted at $s$.  We call this latter process \emph{Process~FP}
%(for first-passage percolation).  That this process is equivalent to
%Process~A can be seen by adding vertices to the shortest path tree rooted
%at $s$ in increasing order of the weight of their lightest path to $s$.
%At each step in this process, the memoryless property ensures that each
%edge adjacent to exactly one vertex of $T$ is equally likely to be the
%next edge added to $T$.
%
%Since these processes produce the same distribution of spanning trees,
%in the remainder, $T$ will refer to a spanning tree produced by Process~A,
%Process~B, Process~E, or Process~FP, whichever is convenient.  

In this section, we establish the connection with first-passage percolation, and prove an upper bound for $\tau(G,s)$ in general graphs, which results in an upper bound for $h(\tcal(G,s))$.
This connection will be used in subsequent sections to provide tighter bounds for $h(\tcal(G,s))$ in several graph classes.

%prove our upper bounds. All of them are based on
%the following meta-theorem:


Recall the generation process for $\tcal(G,s)$:
we start with a tree containing only vertex $s$ initially;
in each round, we choose an edge uniformly at random
among edges with exactly one endpoint in the existing tree,
and add it to the existing tree.


We may view this as an \emph{infection process}:
at round 0 only vertex $s$ is infected.
In each round, suppose the set of infected vertices is $S$.
We choose a uniformly random edge between $S$ and its compliment, and let the disease spread along that edge, hence increasing the number of infected vertices by one.

Now consider the following 
continuous time view of this infection process, which is  known as Richardson's model~\cite{richardson_survey} or first-passage percolation~\cite{fpp_survey}.
At time $0$ we infect vertex $s$.
For each edge $uv$, whenever one of $u$ and $v$ gets infected,
we put an exponential(1) timer on edge $uv$.
When the timer rings, the disease spreads along that edge and both $u$ and $v$ get infected (it might be the case that both $u$ and $v$ are already infected by that time).
Suppose at some moment in this process, the subset $S$ of vertices are infected. Then, by memorylessness of the exponential distribution, the disease is equally like to spread along any of the edges existing between $S$ and its complement.
Therefore, the tree along which the disease spreads has the same distribution as $\tcal(G,s)$.

This viewpoint induces weights on the edges:
to each edge $e$ we  assign weight $\tau(e)$, which is the ringing time for the timer on this edge.
Note that the weights are i.i.d.\ exponential (1) random variables.
The weight of a path $P$, denoted $\tau(P)$, is simply the sum of weights of its edges.  The \emph{first-passage percolation hitting time} (or simply, the \emph{hitting time}) for $v$ is the weight of the lightest path from $s$ to $v$:
\[
    \tau(G,s,v) = \min_{\gamma\in\Gamma(s,v)} \tau(\gamma) \enspace .
\]
The \emph{first-passage percolation cover time} (or simply, the \emph{cover time}) is the first time that all vertices are infected, which can be written as
\[
	\tau(G,s) = \max_{v\in V(G)} \tau(G,s,v)  \enspace .
\]
Note that this is also the maximum \emph{weight} of a root-to-leaf path in the infection tree $\tcal(G,s)$, 
which we will use to bound the {height} of $\tcal(G,s)$,
the maximum \emph{length} of a path in (the unweighted version of) $\tcal(G,s)$ (in general, the longest path and the heaviest path may be different).

%\abas{I rewrote this connection with fpp in terms of an infection process, deleted additional processes B, E, FP, etc. See if it is clear.}
%
%The weight a path $P$, $\tau(P)$, is simply the sum of weights of its edges, and the distance between vertices $u$ and $v$ is defined as
%\[
%	\tau(G,u,v) = \min_{\gamma\in\Gamma(u,v)} \sum_{e\in\gamma} \tau(e) \:,
%\]
%
%Since our
%Process~A refers to an unweighted graph and the infection process induces weights o refers to weighted graph, we will use the convention that the \emph{length} of a path $P$ is
%the number of edges in the path and the \emph{weight}, $W(P)$ 
%is the sum of the weights on the edges in $P$. 
%\section{Upper Bounds}
%\seclabel{upper-bounds}

For a positive integer $L$ and a vertex $s$ of graph $G$, let $\Pi(G,s,L)$ denote the number of simple paths of length $L$ in $G$ that start from $s$.
We now prove a lemma that upper bounds $h(\tcal(G,s))$ in terms of $\tau(G,s)$ and $\Pi(G,s,L)$.


\begin{lem}\lemlabel{meta-theorem}
   Let $s\in V(G)$, $0\le p<1\leq a$, $c>0$, and
   $L=\ceil{ceaK}$ be such that $\Pr \{\tau(G,s)>K\}\leq p$
   and $\Pi(G,s,L) \leq a^L$. 
   Then  
%   \begin{enumerate}
%      \item the probability that the first-passage percolation cover time is greater than $K$ is at most $p$; and
%      \item the number of simple paths in $G$ that begin at $s$ and have length $L$ is at most $a^L$;
%   \end{enumerate}
    $h(\tcal(G,s)) \le L$ with probability at least $1-p-c^{-L}$.
\end{lem}

\begin{proof}
   Let $T = \tcal(G,s)$.
   If $h(T)> L$, then at least one of the following two events occurred:
   \begin{enumerate}
     \item $T$ contains a root-to-leaf path of weight greater than $K$.
     \item $G$ contains a path starting at $s$ of length $L$ whose weight 
        is less than $K$.
   \end{enumerate}
   By assumption, the probability of the first event is at most $p$.  
   The weight of a single path of length $L$ is the sum of $L$ $\exponential(1)$
   random variables so, by \eqref{head-bound} and the union bound over
   all $a^L$ paths, the probability of the second event is at most
   \[
       a^L \left(\frac{eK}{L} \right)^L \le c^{-L}
       \enspace . \qedhere
   \]
\end{proof}

In light of \lemref{meta-theorem}, we can upper bound $h(\tcal(G,s))$ if we have upper bounds on the cover time and on the number of paths of length $L$ originating at $s$.
An obvious upper bound for the latter is $\Delta^L$.
The following lemma gives a general upper bound for the former,
which results in a general upper bound for $h(\tcal(G,s))$.
In the following sections we obtain better bounds 
for these two quantities in special graph classes,
resulting in sharper bounds on $h(\tcal(G,s))$.

%We begin with a universal upper bound on first-passage percolation time.

\begin{lem}\lemlabel{percolation}
For any $s\in V(G)$, we have
$\tau(G,s) \leq 4 \ln n + 2 D$ with probability at least
$1-1/n$.
\end{lem}
%  Let $G$ be an $n$-vertex graph of diameter $D$ and let $T$ be the
%  tree obtained by running Process~FP on $G$.  Then, with probability
%  at least $1-1/n$, the weight of the heaviest root-to-leaf path in $T$
%  is at most $((4\ln n)/D+2)D$.

\begin{proof}
For each vertex $v\in V(G)$, we show the probability that it is not infected by time $4 \ln n + 2 D$ is at most $n^{-2}$, and then apply the union bound over all vertices.
Let $P$ be a shortest $(s,v)$-path in $G$.
Let $k\leq D$ denote the length of $P$, so $\tau(P)\sim \erlang(k,1)$.
Note that for any $t$,  $\tau(P)\leq t$ implies $v$ is infected by time $t$.
Thus, using \eqref{tail-bound}, the probability that $v$ is not infected by time $4 \ln n + 2 D$ is bounded by
\[
\Pr\{\tau(P) > 4 \ln n + 2 D\}
=
\Pr\{\erlang(k,1) > 4 \ln n + 2 D\}
\leq
\exp(k - 2\ln n - D) \leq n^{-2}\:.\qedhere
\]
\end{proof}


%  Let $v$ be a vertex of $G$ such that there exists a path
%  $P=v_0,\ldots,v_k$ with $k$ edges in $G$ from $s=v_0$ to $v=v_k$.
%  Let $e_i=v_{i-1}v_i$ be the $i$th edge on this path.
%
%  In Process~FP, each edge $e_i$ is assigned an exponential weight $X_i$.
%  The path from $s$ to $v$ in $T$ does not have weight greater than
%  $W(P)=\sum_{i=1}^k X_i$.
%  \begin{align*}
%      \Pr\left\{W(P)\ge \left(\frac{4\ln n}{k}+2\right)k\right\} 
%        & \le \Pr\left\{Z_1+\cdots Z_k\ge \left(\frac{4\ln n}{k}+2\right)k\right\} \\ 
%        & \le \exp\left(k - \left(\frac{4\ln n}{k}+2\right)k/2\right) 
%            & \text{(using \eqref{tail-bound})} \\
%      & = 1/n^2 \enspace .
%  \end{align*}
%  For each $v\in V(G)$, let $W(v)$ denote the weight of the path, in
%  $T$, from $s$ to $v$, and define $W^*=\max\{W(v):v\in V(G)\}$  as the
%  weight of the heaviest root-to-leaf path in $T$.  For each vertex $v$,
%  $G$ contains a path from $s$ to $v$ of length at most $D$. Therefore,
%  by the discussion above and the union bond,
%  \[
%      \Pr\{W^*> ((4\ln n/D)+2)D\} 
%          \le \sum_{v\in V(G)}\Pr\{W(v) \ge ((4\ln n/D)+2)D\}     
%       \le 1/n \enspace . \qedhere
%  \]

We immediately get a general upper bound for $h(\tcal(G,s))$.
%\subsection{Graphs of Bounded Maximum Degree}

\begin{thm}\thmlabel{alantree-upper-bound}
  Let $G$ be an $n$-vertex graph with diameter $D$ and maximum degree $\Delta>1$, and let $s$ be an arbitrary vertex.
%  and let $T$ be the tree obtained by running Process~FP starting at
%  any vertex $s\in V(G)$.  
Then, with probability at least $1-O(1/n)$ we have
\[
\frac D 2 \leq h(\tcal(G,s)) \leq 2e\Delta (4\ln n+2 D) \leq 
(4 e \Delta + 8 e\Delta  \ln \Delta )D + 16 e\Delta  \:.
\]
\end{thm}

Note that this gives an asymptotically tight bound of $h(\tcal(G,s))=\Theta(D)$ for graphs with bounded maximum degree.

\begin{proof}
The first inequality is trivial.
The second inequality is an application of \lemref{meta-theorem} with $a=\Delta$, $p=1/n$,
  $K=4\ln n+2D$ and $c=2$, using the bound of \lemref{percolation} for the cover time.
The last inequality follows from the crude bound $\Delta^D \geq n/3$, which holds for any $n$-vertex graph with maximum degree $\Delta$ and diameter $D$.
%  \begin{enumerate}
%     \item By \lemref{percolation}, the weight of the heaviest
%       root-to-leaf path in $T$ is upper bounded by $K=D(4\ln n/D)+2)$ 
%       with probability
%       at least $1-1/n$.
%     \item Since $G$ has maximum degree $\Delta$, the number of paths
%       that begin at $s$ and have length $L$ is at most $\Delta^L=a^L$.
%  \end{enumerate}
%  \lemref{meta-theorem} states that $h(T)\le ceaK = 2e\Delta D(4\ln n/D)+2)$ with probability at least $1-1/n-c^{-ceaK}\ge 1-1/n-1/n^2$.
\end{proof}

%Note that $n$-vertex graphs of maximum degree $\Delta$ have diameter
%$D>\log_\Delta n$, so \thmref{alantree-upper-bound} is asymptotically
%tight for graphs of constant maximum degree:
%
%\begin{cor}
%  Let $G$ be an $n$-vertex graph with diameter $D$ and maximum degree
%  $\Delta\in O(1)$ and let $T$ be the tree obtained by running Process~FP
%  starting at any vertex $s\in V(G)$.  Then, with probability at least
%  $1-O(1/n)$, $h(T)\in O(D)$.
%\end{cor}

\section{An upper bound in terms of graph degeneracy}
\seclabel{degeneracy}
Recall that a graph is \emph{$d$-degenerate} if each of its subgraphs has a vertex of  degree at most $d$.  The following lemma shows that, for large $L$, $d$-degenerate graphs have considerably less than $\Delta^L$ walks of length $L$.

\begin{lem}\lemlabel{few-walks}
   Let $G$ be an $n$-vertex $d$-degenerate graph with maximum degree
   $\Delta$.  Then the number of walks in $G$ of length $L$ is bounded by    $2n2^{L}(d\Delta)^{L/2}$.  
%   In particular, if $L > D\log\Delta$, then the number of walks in $G$ of length $L$ is at most $(cd\Delta)^{L/2}$  for some constant $c$.
\end{lem}

\begin{proof}
   Enumerate the vertices of $G$ as $v_1,\ldots,v_n$ so that $v_i$ has at most
   $d$ edges in the subgraph induced by $v_i,\ldots,v_n$ (this ordering may be obtained by repeatedly removing a vertex of degree at most $d$).

   We give a way to encode the walks in a one-to-one way, and then bound the total number of possible generated codes.
   %This is an encoding argument, in which we upper bound the number of walks by showing how to encode them. 
   Let $W=v_{i_0},\ldots,v_{i_L}$
   be a walk of length $L$ in $G$ and let $k=k(W)$ denote the number
   of indices $\ell\in\{1,\ldots,L\}$ such that $i_{\ell-1} < i_{\ell}$.
   If $k\ge L/2$ then we say that $W$ is \emph{easy};
   note that at least one of $W$ and its reverse is easy, hence the total number of $L$-walks is at most twice the number of easy $L$-walks. We  encode an easy walk $W$ in the following way:
   \begin{enumerate}
     \item We first specify the starting vertex $v_{i_0}$.  There are $n$
       ways to do this.
     \item Next we specify whether $i_{\ell-1} < i_{\ell}$ for each
       $\ell\in\{1,\ldots,L\}$.  There are at most  $2^L$ ways to do this.
     \item Next, we specify each edge of $W$.  For each
       $\ell\in\{1,\ldots,L-1\}$, if $i_{\ell} < i_{\ell+1}$, then
       there are at most $d$ ways to do this, otherwise there are at
       most $\Delta$ ways to do this.
       Therefore, the total number of ways to specify all edges of the
       walk is at most
       \[   d^k\Delta^{L-k} \le (d\Delta)^{L/2}  \enspace ,\]
       since $d\le \Delta$ and $k\ge L/2$.
   \end{enumerate}
   Therefore, the number of easy $L$-walks is bounded by $n2^L(d\Delta)^{L/2}$, as required. \end{proof} 
   %For every walk, $W$, at least one of $W$or its reverse is easy, so the total number of walks of length $L$   is at most $2n2^L(d\Delta)^{L/2}$.

%   The second part of the theorem comes from the fact that $D\ge
%   \log_\Delta n$ so, when $L>D\log\Delta=\log n$,
%   \[ (32d\Delta)^{L/2} \ge 2n2^L(d\Delta)^{L/2} \enspace . \qedhere \]


\begin{thm}\thmlabel{alantree-upper-bound-degenerate}
  Let $G$ be an $n$-vertex $d$-degenerate graph with diameter $D$ and
  maximum degree $\Delta$, and let $s$ be an arbitrary vertex. 
  Then, with probability at least $1-O(1/n)$ we have
  $h(\tcal(G,s)) \leq 8e \sqrt{d\Delta}(2D+4\ln n)$.
\end{thm}

\begin{proof}
Let $c=2$, $K=4\ln n + 2D$, $p=1/n$, $a=4\sqrt{d\Delta}$, and $L=\lceil cea K\rceil > 8 \ln n$.
\lemref{percolation} guarantees
$\tau(G,s) \leq 4 \ln n + 2 D$ with probability at least
$1-1/n$,
and \lemref{few-walks} guarantees
$\Pi(G,s,L) \leq 2n2^{L}(d\Delta)^{L/2} \leq a^L$.
Applying \lemref{meta-theorem} completes the proof.
\end{proof}


%\subsection{Remarks on Degenerate Graphs}
\seclabel{degeneracy-discussion}

Note that \thmref{alantree-upper-bound-degenerate} actually implies
\thmref{alantree-upper-bound} up to constant factors, since all graphs of maximum degree $\Delta$
are $\Delta$-degenerate, so $\sqrt{d\Delta}\le \Delta$ in all cases.
However, \thmref{alantree-upper-bound-degenerate} provides sharper bounds for  many important graph classes:

\begin{itemize}
  \item Planar graphs are 5-degenerate. (This is a consequence of Euler's
    formula and the fact that planarity is preserved under taking subgraphs).
  
  \item The \emph{thickness} of a graph is the minimum number of planar
    graphs into which the edges of $G$ can be partitioned. Graphs of
    thickness $t$ are $5t$-degenerate.  (This follows from definitions
    and the $5$-degeneracy of each individual planar graph in the
    partition.)

  \item The \emph{Euler genus} of a graph is the minimum Euler genus of
    a surface on which the graph can be drawn without crossing edges.
    Graphs of Euler genus $g$ are $O(\sqrt{g})$-degenerate.\footnote{This
    follows from the facts in every $n$-vertex Euler-genus $g$ graph,
    $n\in \Omega(\sqrt{g})$ and there exists a vertex of degree at most
    $6+O(g/n)$. (See, e.g., \cite[Lemma~7 and Theorem~2]{wolle.koster.ea:note}.)}

  \item A \emph{tree decomposition} of a graph $G$ is a tree $T'$ whose
  vertex set $B$ is a collection of subsets of $V(G)$ called \emph{bags}
  with the following properties:
  \begin{enumerate}
    \item For each edge $vw$ of $G$, there is at least one bag $b\in B$
      with $\{v,w\}\subseteq B$.
    \item For each a vertex $v$ of $G$, the subgraph of $T'$ induced by
      the set of bags that contain $v$ is connected.
  \end{enumerate}
  The \emph{width} of a tree-decomposition is one less than the size
  of its largest bag.  The \emph{treewidth} of $G$ is the minimum
  width of any tree decomposition of $G$.
  Graphs of treewidth $k$ are $k$-degenerate. (This is a consequence
  of the fact that $k$-trees are edge-maximal graphs of treewidth $k$.)
\end{itemize} 

Therefore, \thmref{alantree-upper-bound-degenerate} implies that,
when the relevant parameter, $g$, $t$ or $k$, is bounded, $h(T)\in
O(\sqrt{\Delta}(D+\log n))$ with high probability.  

\section{An upper bound in terms of Euler genus}
Since graphs of Euler genus $g$ are $O(\sqrt{g})$-degenerate,
\thmref{alantree-upper-bound-degenerate} implies that if  $G$ has Euler genus
$g$, then $h(\tcal(G,s))\in O(g^{1/4}\Delta^{1/2}(D+\log n))$.  In this section we show that the
dependence on the genus $g$ can be eliminated when the diameter is large
compared to the genus.  We begin with a upper-bound on path counts that
is better (for graphs of small genus) than \lemref{few-walks}.

\begin{lem}\lemlabel{few-paths-genus}
   Let $G$ be a simple $n$-vertex graph of Euler genus $g$, diameter
   $D$, and maximum degree $\Delta\ge 6$. Then the number of simple paths
   in $G$ of length $L$ is at most $2n2^{L}6^{L/2-3g}\Delta^{L/2+3g}$.
%   In particular, if $L>D\log\Delta$, then the number of simple pathsin $G$ is at most $(c\Delta)^{L/2+3g}$ for some constant $c$.
\end{lem}

\begin{proof}
   The following proof makes use of some basic notions related to graphs
   on surfaces; see Mohar and Thomassen \cite{mohar.thomassen:graphs} for
   basic definitions and results.  Since $G$ has Euler genus $g$, it has
   a 2-cell embedding in a surface of Euler genus $g$.  Euler's formula
   then states that
   \begin{equation}
      m = n+f-2+g \enspace ,  \eqlabel{euler}
   \end{equation}
   where $n$ and $m$ are the numbers of vertices and edges of
   $G$ and $f$ is the number of faces in the embedding of $G$.  
   Every edge is on the boundary of at most 2 faces of the embedding
   and, since $G$ is simple, 
   every face is
   bounded by at least 3 edges.  Therefore, $f \le 2m/3$, so \eqref{euler}
   implies
   \[
       m\le 3n-6+3g \enspace .
   \]
   Therefore, the average degree of an $n$-vertex Euler genus $g$ graph
   is at most $6+(6g-12)/n$.  In particular, if $n \ge 6g$, then $g$
   has average degree less than 7, so $G$ contains a vertex of degree
   at most $6$.
  
   When we remove a vertex from $G$ we obtain a graph whose Euler genus is
   not more than that of $G$.  Therefore, by repeatedly removing a degree
   6 vertex, we can order the vertices of $G$ as $v_1,\ldots,v_n$ so that,
   for each $i\in\{1,\ldots,n-6g\}$, $v_i$ has at most 6 neighbours among
   $v_{i+1},\ldots,v_n$.  We call $v_{n-6g+1},\ldots,v_n$ \emph{annoying
   vertices} and edges between them are \emph{annoying edges}.

   Let $P=v_{i_0},\ldots,v_{i_L}$ be a path of length $L$ in $G$.
   For each $i\in\{1,\ldots,L\}$, the edge $v_{i_{\ell-1}}v_{i_{\ell}}$
   is called \emph{bad} if it is annoying or if $i_{\ell-1}>i_{\ell}$; otherwise it is called good. 
   Let $k$ denote the number of good edges in $P$.
   Say $P$ is good if $k \geq L/2-3g$.
   Note that the number of annoying edges of $P$ is bounded by $6g-1$, 
hence at least one of $P$ and its reverse is good.
We bound the number of good $L$-paths; the total number of $L$-paths is at most twice this bound.
We encode a good $L$-path $P$ as follows:
   \begin{enumerate}
     \item We first specify the starting vertex $v_{i_0}$.  There are $n$
       ways to do this.
     \item Next we specify whether each edge of $P$ is good or bad.
       There are $2^L$ ways to do this.
     \item Next, we specify each edge of $P$.  For each good edge,
       there are at most 6 ways to do this. For each bad edge there are 
       at most $\Delta$ ways to do this.
      Therefore, the total number of ways to specify the edges of $P$ is at most
      \[   6^k\Delta^{L-k} \le 6^{L/2-3g}\Delta^{L/2+3g}  \enspace ,\]
      since $k\ge L/2-3g$ and $\Delta\ge 6$.
   \end{enumerate}
   Therefore, the  number of good $L$-paths 
    is at most $n2^L6^{L/2-3g}\Delta^{L/2+3g}$, as required.
%    .  Any simple
%   path uses most $6g$ annoying edges.  Therefore, for any simple path
%   $P$ of length $L$, either $P$ or its reverse has $k\ge L/2-3g$.
%   Thus, the total number of simple paths of length $L$ is at most
%   $2n2^L6^{L/2-3g}\Delta^{L/2+3g}$ as required.  
%
%
%   For the second part of the theorem, it is sufficient to choose $c=96\alpha=\alpha\times 4\times4\times 6$, where $\alpha > 4^{1/\log n}$.  Since $L>D\log \Delta \ge \log n$, we get
%   \[
%       (96\alpha\Delta)^{L/2+3g} 
%        \ge \alpha^{L/2} 4^{L/2}4^{L/2} 6^{L/2} \Delta^{L/2+3g}
%        \ge 2 n 2^{L} 6^{L/2-3g} \Delta^{L/2+3g} \enspace . \qedhere
%   \]
\end{proof}


\begin{thm}\thmlabel{alantree-upper-bound-genus}
  Let $G$ be an $n$-vertex Euler-genus $g$ graph with diameter $D$,
  maximum degree $\Delta$ and let $s\in V(G)$ be an arbitrary vertex.
  If $g\ln\Delta \le 36\sqrt{\Delta}(D+\ln n)$ then,
  with probability at least $1-O(1/n)$,
  $h(\tcal(G,s))\le 107\sqrt{\Delta}(2D+4\ln n)$.
\end{thm}

\begin{proof}
The conclusion follows from \thmref{alantree-upper-bound} for $\Delta\leq6$, so we will assume $\Delta>6$.
Let $c=2$, $K=4\ln n + 2D$, $p=1/n$, $a=8\sqrt{6\Delta}$, and $L=\lceil cea K\rceil > 8 \ln n$. 
%Observe that
%\[
%\Delta^{3g} 
%\leq
%\exp\left( 108 \sqrt{\Delta}(D+\ln n)\right)
%<
%2^L
%\:.
%\]
\lemref{percolation} guarantees
$\tau(G,s) \leq 4 \ln n + 2 D$ with probability at least
$1-1/n$,
and \lemref{few-walks} guarantees
\[
\Pi(G,s,L) \leq 2n \times 2^{L} \times (6\Delta)^{L/2} \times \Delta^{3g} \leq 
(2 \times 2 \times \sqrt{6\Delta})^L
\exp\left( 108 \sqrt{\Delta}(D+\ln n)\right)
\leq
(2 \times 2 \times \sqrt{6\Delta}\times 2)^L=a^L
\:.\]
Applying \lemref{meta-theorem} completes the proof.
\end{proof}
%
%  The proof is an application of \lemref{meta-theorem}.  Notice that,
%  for $L\ge 3g\ln\Delta$, the number of simple paths in $G$ of length
%  $L$ is at most
%  \[
%     (c\Delta)^{L/2+3g} 
%        = \left((c\Delta)^{1/2+3g/L}\right)^L
%        \le \left((c\Delta)^{1/2+1/\ln\Delta}\right)^L
%        \le \left((e\Delta)^{1/2}\right)^L
%        = (ce\Delta)^{L/2} \enspace .
%  \]
%  Therefore, we apply \lemref{meta-theorem} with $a=(ce\Delta)^{1/2}$,
%  $p=1/n$, $K\in O(D+\log n)$, and $c=2$.  Then,
%  \[
%      L=\ceil{2eaK} \in \Omega(\Delta^{1/2}D) \enspace .
%  \]
%  Therefore, with a sufficiently large $C$, the condition $g\ln\Delta \le C\Delta^{1/2}D$ implies that $L\ge 3\ln\Delta$, which justifies the choice of $a$.
%\end{proof}



\section{An upper bound for edge expanders}
\seclabel{edge-expanders}

All of the preceding upper bounds on $h(T)$ have a (linear or rootish)
dependence on $\Delta$, the maximum degree of a vertex in $G$.
This seems somewhat counterintuitive, since high degree vertices in $G$
should produce high degree vertices in $T$ and therefore decrease $h(T)$.
In this section we show that indeed large edge expansion (also called isoperimetric number
or Cheeger constant) results in low-height trees.

For an $n$-vertex graph $G$ and a subset $A\subseteq V(G)$,
define $e(A)=|\{vw\in E(G): v\in A,\, w\not\in A\}|$, and for any
$k\in\{1,\ldots,n-1\}$, define
\[
    e_k(G) = \min\{e(A) : A\subseteq V(G),\, |A|=k \} \enspace .
\]
Observe that $e_k(G)$ is symmetric in the sense that
\(e_k(G) = e_{n-k}(G) \enspace \).
We define the \emph{edge expansion} of $G$ is
\[
    \Phi(G) = \min\left\{e_k(G)/k : k\in\{1,\ldots,\lfloor n/2\rfloor\}\right\}
\]
We will express the height of $T$ in terms of the \emph{total inverse
perimeter size} $\Psi$, which is closely related to the edge expansion:
\[
    \Psi(G) = \sum_{k=1}^{\lfloor n/2\rfloor} \frac{1}{e_k(G)} 
            \le \sum_{k=1}^{\lfloor n/2\rfloor} \frac{1}{k\Phi(G)}
            = \frac{\ln n +O(1)}{\Phi(G)} \enspace .
\]

%\begin{todo}
%Does $\Psi(G)$ have a name?  I just made up total
%inverse perimeter size, and it's not a very good name.
%\end{todo}

\begin{thm}\thmlabel{alantree-upper-bound-cheeger}
  \thmlabel{alantree-upper-bound-edge-expander}
  Let $G$ be an $n$-vertex graph with with maximum degree $\Delta$,
  edge-expansion $\Phi$, total inverse perimeter size $\Psi$,
  and let $s$ be an arbitrary vertex.
  Then, with probability at least $1-\exp(-\Omega(\Psi\Delta))$ we have
  $h(\tcal(G,s)) \in O(\Psi\Delta)\subseteq O(\Phi^{-1}\Delta\log n)$.
\end{thm}

Before proving \thmref{alantree-upper-bound-edge-expander}, we
consider the example of the complete graph $G=K_n$.  In this graph,
the minimum degree is $n-1$, so all preceding theorems (at best)
imply an upper bound of $O(n)$ on $h(\tcal(K_n,s))$.  However, $e_k(K_n) = k(n-k)$,
so $\Phi(K_n) = \lceil n/2\rceil$, and $\Psi(K_n) = O(\log n/n)$.
Then \thmref{alantree-upper-bound-edge-expander} implies that $h(\tcal(K_n,s))\in
O(\log n)$ with high probability. This upper bound
is of the right order of magnitude, since it matches the (tight) results
of Devroye and Pittel for the height of the random recursive tree
\cite{devroye:branching,pittel:note}.

%\begin{todo}
%Luc suggested there might already exist first-passage
%percolation results for graphs with large Cheeger constants.  If so,
%then we may be able to replace this proof with an application of
%\lemref{meta-theorem}.
%\end{todo}

\begin{proof}
   Fix some path $P=(s=v_0),v_1,\ldots,v_L$ in $G$ and suppose that $P$
   appears as a path in $T$.  Then there are times $1\leq k_1<\cdots<k_L<n$
   such that for each $i\in\{1,\ldots,L\}$, $v_i$ joins $T$ when
   $T$ has size $k_i$.  For a fixed $P$ and fixed $1\le k_1<\ldots<k_L<n$,
   the probability that this happens is at most
   \[
       \prod_{i=1}^{L} \frac{1}{e_{k_i}(G)} \:,
   \]  
   and the probability that $P$ appears in $T$ (without fixing
   $k_1,\ldots,k_L$) is at most
   \begin{align*}
       \sum_{1\le k_1<\cdots<k_L< n}
        \left(
         \prod_{i=1}^{L} \frac{1}{e_{k_i}(G)}
        \right) 
       < 
       \frac{1}{L!}\left(\sum_{(k_1,\ldots,k_L)\in\{1,\ldots,n-1\}^L}
        \left(
         \prod_{i=1}^{L} \frac{1}{e_{k_i}(G)}
        \right)\right)  
       = \frac{1}{L!}\left(\sum_{k=1}^{n-1}\frac{1}{e_k(G)}\right)^L 
       \le \frac{(2\Psi)^L}{L!} 
   \end{align*}
   Finally, since $G$ contains at most $\Delta^L$ paths of length $L$,
   
   \[
        \Pr\{h(\tcal(G,s)) \ge L\} \le \Delta^L \times \frac{(2\Psi)^L}{L!}  \leq \left(\frac{2e\Psi\Delta}{L}\right)^L
         \le \left(\frac{1}{2}\right)^L \enspace ,
   \]
   for $L\ge 4e\Psi\Delta$.
\end{proof}

Observe that the last step in the proof of
\thmref{alantree-upper-bound-cheeger} is to use the union bound over all
paths of length $L$.  If we have a better upper-bound than $\Delta^L$ on
the number of such paths, then we obtain a better upper bound on $h(T)$.
\lemref{few-walks} gives a better upper bound for $d$-degenerate graphs, using which we immediately obtain the following corollary.

\begin{cor}
  Let $G$ be an $n$-vertex $d$-degenerate graph with diameter $D$
  and maximum degree $\Delta$, total inverse perimeter size $\Psi$,
  and let $s$ be an arbitrary vertex.
  Then, with probability at least $1-O(1/n)$,
  $h(\tcal(G,s))\in O(\Psi\sqrt{d\Delta}+\log n)
  \in O(\log n (1+ \sqrt{d\Delta}/\Phi))$.
\end{cor}

\begin{proof}
As in the proof of \thmref{alantree-upper-bound-cheeger},
and using the upper bound 
$2n2^{L}(d\Delta)^{L/2}$ for the number of paths of length $L$, given by \lemref{few-walks}, we have
   \[
        \Pr\{h(\tcal(G,s)) \ge L\} \le  2n2^{L}(d\Delta)^{L/2}\times
        \frac{(2\Psi)^L}{L!} \leq
        2n\left( 4e\Psi\sqrt{d\Delta}/L \right)^L
        \leq
        \left( 8e\Psi\sqrt{d\Delta}n^{1/L}/L \right)^L\:,
    \]
    which is smaller than $1/n$ for $L\geq 8e^3 \Psi \sqrt{d\Delta}+\ln n$, as required.
\end{proof}

%\begin{todo}
%I removed any mention of bounded genus here, since genus
%$g$ graphs have edge-expansion at most $\sqrt{g\Delta n}/n$.
%\url{https://doi.org/10.1016/0304-3975(93)90031-N}
%\end{todo}

%\begin{cor}
%  Let $G$ be an $n$-vertex Euler-genus $g$ graph with diameter $D$,
%  maximum degree $\Delta$, total inverse perimeter size $\Psi$, and let
%  $T$ be the tree obtained by running Process~FP starting at any vertex
%  $s\in V(G)$.  There exists a constant $C$ such that, if $g\ln\Delta \le
%  C\sqrt{\Delta}D$ then, with probability at least $1-o_n(1)$, $h(T)\in
%  O(\Psi\sqrt{\Delta}(D+\log n))$.
%\end{cor}
%It is natural to ask if one can eliminate or reduce the dependence on
%$\Delta$ in the results of the previous section.  Intuitively, high degree
%should produce spanning trees of lower height.  However, the example
%of a sequence of $D/2$ $(\Delta-1)$-cliques joined in sequence (see
%\figref{clique-path}) shows that Process~A may produce spanning trees
%of diameter $\Omega(D\ln\Delta)$.  Therefore the dependence on $\Delta$
%can not be eliminated entirely; there is at least a logarithmic dependence
%on $\Delta$.
%
%\begin{figure}
%  \begin{center}
%    \includegraphics{figs/clique-path}
%  \end{center}
%  \caption{A sequence of $D/2$ $(\Delta-1)$-cliques gives a graph $G$
%   with diameter $D$ and maximum degree $\Delta$ for which Process~A
%   produces a spannning tree of height $\Omega(D\log\Delta)$.}
%  \figlabel{clique-path}
%\end{figure}
%
%Next we show that, in fact, a linear dependence on $\Delta$ is necessary
%for general graphs: For any $\Delta$ and any $D\in\Omega(\log\Delta)$,
%we can construct a graph $G=G_{D,\Delta}$ of diameter $D$ and
%maximum degree $\Delta$ for which Process~A produces a spanning
%tree of diameter $\Omega(\Delta D)$.  Thus, the upper-bound of
%\thmref{alantree-upper-bound} is asymptotically tight.
%We construct
%We also construct examples of graphs of thickness
%$\Theta(d)$ and graphs of treewidth $\Theta(d)$ for which the tree
%$T$ has height $\Omega(\sqrt{\Delta d}D)$, thereby showing that the
%upper bound in \thmref{alantree-upper-bound-degenerate} for $d$-degenerate
%graphs is tight for these families of graphs.

\section{Upper bounds for high dimensional grids and hypercubes}
\seclabel{grids}
The \emph{$d$-cube} is the graph having vertex set $\{0,1\}^d$ in
which two vertices are adjacent if and only if they differ in exactly
one coordinate.  Every vertex in the $d$-cube has degree $d$ and the
$d$-cube has diameter $d$.  The $d$-cube is an interesting example
in which the path count is high, but this is counteracted by a low
first-passage percolation time.

\begin{thm}\thmlabel{alantree-upper-bound-hypercube}
  Let $n=2^d$, let $G$ be the $d$-cube and let $s\in V(G)$ be arbitrary. Then,
  with probability at least $1-o_n(1)$, $h(\tcal(G,s))\in \Theta(d)$.
\end{thm}

\begin{proof}
  Fill and Pemantle \cite{fill.pemantle:percolation} showed that the
  first-passage percolation cover time for the $d$-cube is at most 14.05
  with probability $1-o_n(1)$.  Every vertex of the hypercube has degree
  $d$, so the number of paths of length $L$ starting at $s$ is less
  than $d^L$.  The result then follows by applying \lemref{meta-theorem}
  with $p=o_n(1)$, $c=2$, $K=14.05$, and $a=d$.
\end{proof}

A natural generalization of the $d$-cube graph is the \emph{$(d,k)$-grid},
which has vertex set $\{0,\ldots,k\}^d$ and has an edge between two
vertices if and only if the (Euclidean or $\ell_1$) distance between
them is 1.  Note that the case $k=2$ is the $d$-cube.

We prove a result about the first-passage-percolation cover time of grids,
which gives a bound on the height of $\tcal(G,s)$.

\begin{thm}\thmlabel{bestgrid-universal}
Let $G$ be the $(d,k)$-grid and $n=(k+1)^d$.  Then, for any vertex $s\in
V(G)$, we have that $\tau(G,s)= O(k)$ with probability $1-o_n(1)$.
\end{thm}

Since the maximum degree of the $(d,k)$-grid is $2d$ and its diameter is $dk$, applying \lemref{meta-theorem} gives the following corollary.

\begin{cor}\corlabel{bestgrid}
Let $G$ be the $(d,k)$-grid and $n=(k+1)^d$.  For any vertex $s\in V(G)$
we have that with probability $1-o_n(1)$, $ h(\tcal(G,s)) = \Theta(dk)$
\end{cor}

The proof of \thmref{bestgrid-universal} is broken into two parts. The first is a lemma that handles a limited range of $d$ and $k$.

\begin{lem}\lemlabel{bestgrid}
Let $G$ be the $(d,k)$-grid.  There exists a constant $C$ such that for
any vertex $s\in V(G)$ we have
\[
\Pr \{ \tau(G,s) \geq (4+C)k + Cd^{2/3}\ln(k+1) \} 
\leq
3 \exp (-d\ln(k+1)) =3/n \:;
\]
in particular, if $k/\ln(k+1) \geq d^{2/3}$,
then with probability $1-O(1/n)$ we have
$\tau(G,s)=O(k)$.
\end{lem}

%\abas{Note that this theorem has been updated. We no longer claims that $\tau(G,s)=O(k)$ for all $k$ and $d$. I think the previous proof had a gap, in going from expectation to with-high-probability.}

%\begin{todo}
%Look a bit more carefully at the gap here.
%\end{todo}
%
%We conjecture that, for all values of $k$ and $d$ we have $\tau(G,s)=O(k)$
%with probability $1-o_n(1)$, which implies that for all $d$ and $k$,
%with probability $1-o_n(1)$ we have $h(\tcal(G,s))=\Theta(dk)$.
%

%\thmref{dk-grid-foxtrot}, in \appref{dk-grid-foxtrot}, shows that
%the first-passage percolation time in the $(d,k)$-grid is $O(k)$ with
%probability $1-o_n(1)$.  Applying \lemref{meta-theorem} with 
%the first-passage percolation bound in \thmref{dk-grid-foxtrot} yields
%the following:
%
%\begin{cor}\corlabel{alantree-upper-bound-dk-grid}
%  Let $n=(k+1)^d$, let $G$ be the $(d,k)$-grid and let $T$ be the tree obtained
%  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
%  with probability at least $1-o_n(1)$, $h(T)\in O(dk)$.
%\end{cor}

%\section{First-Passage Percolation-Time Bounds}

%Next, 
%
%
%In this appendix, we prove (in some cases reprove) some results on
%first-passage percolation time on the $(d,k)$-grid that hold for
%all values of $d$ and $k$.  Specifically, we show that the first-passage
%percolation time is $O(k)$ with high probability.

%
%\begin{todo}
%Abbas says: I'm not sure about the following two paragraphs... they remain from an older version, but perhaps can be updated/removed!?
%
%\noindent
%Pat says: I included this in the old version because it seems like an obvious approach that probably also works. The kind of thing a referee would ask about. It's also the reason I originally put these results in an appendix.
%\end{todo}
%
%Before doing this, though, we note that this result can already be
%obtained from the $O(1)$ bound on first-passage percolation time on the
%$d$-cube \cite{fill.pemantle:percolation, martinsson:unoriented}.  To see
%why, observe that the crux of the problem involves studying the weight
%of the lightest path from $s=(0,\ldots,0)$ to $t=(k,\ldots,k)$. One can
%find a path from $s$ to $t$ that passes through each $v_i=(i,\ldots,i)$
%for $i\in\{0,\ldots,k\}$, in order.  The first-passage percolation
%result for the $d$-cube shows that one can get from $v_i$ to $v_{i+1}$
%with a path whose expected weight is $O(1)$ and that never leaves the
%$d$-cube induced by $\{i,i+1\}^d$.  Thus there is a path from $s$ to $t$
%whose weight is the sum of $k$ i.i.d.\ random variables $Q_1,\ldots,Q_k$
%each having expectation $O(1)$. The only detail that remains is to
%show that the distribution of $Q_i$ is well-behaved enough to obtain a
%sufficiently strong concentration result on this sum.
%
%Nevertheless, we provide an alternate proof here.  One reason for
%this is to make our results self-contained.  Another, however, is
%that our arguments differ significantly from previous results on
%thd $d$-cube \cite{fill.pemantle:percolation, martinsson:unoriented,
%bollobas.kohayakawa:on} and may be of independent algorithmic interest.
%In particular, our proofs use greedy algorithms to find light paths.
%Our proof for the hypercube, for example, shows that one can find a path
%of expected weight $O(1)$ between any pair of vertices in $O(d^4)$ time.
%Exact shortest path algorithms, like Dijkstra's algorithm, require at
%least $\Omega(2^d)$ time.  Similarly, on the $(d,k)$-grid, our proof
%gives an algorithm that finds a short path in $O(kd^4)$ time, while a
%shortest path agorithm would require $\Omega(d(k+1)^d)$ time.

For the rest of this section, $G$ is a fixed $(d,k)$-grid.
\lemref{bestgrid} follows from the following lemma by choosing $\Delta =
4k+ Cd^{2/3}\ln(k+1)$.

\begin{lem}
  \lemlabel{hypercube}
  There exists an absolute positive constant $C$ such that for any two
  vertices $s$  and $v$ and any $\Delta\geq 4k$ we have
  \begin{equation}
  \Pr \{ \tau(G,s,v) > Ck + \Delta\} 
        \leq 3 \exp\left(-{\Delta d^{1/3}}/C\right)
  \label{hypercube:formula}
  \end{equation}
\end{lem}

%Applying~\thmref{thm:hypercube} with  gives the following corollary.
%\begin{cor}\corlabel{bestgrid}
%There exists a constant $C$ such that for any vertex $s$ we have
%\[
%\Pr \{ \tau(G,s) \geq (3+C)k + 2Cd^{2/3}\ln(k+1) \} 
%\leq
%3 \exp (-d\ln(k+1)) =3/n \:;
%\]
%in particular, if $k/\ln(k+1) \geq d^{2/3}$,
%then with probability $1-O(1/n)$ we have
%$\tau(G,s)=O(k)$.
%\end{cor}
%In the rest of this section we prove~\thmref{thm:hypercube}.

\begin{proof}
We identify the vertices of the graph with points in $\mathbb{Z}^d$, and without loss of generality, we may assume that $s$ is the origin.
For a grid vertex $u=(u_1,\ldots,u_d)$,
its $\ell_1$ norm $\|u\|_1$, or $\ell_1$ distance to the origin, is defined as $\sum_{i=1}^d u_i$,
and its Hamming norm $\|u\|_H$, or Hamming distance from the origin, is its number of non-zero entries.

We give an algorithm to find a path from $v$ to the origin.
This is an iterative algorithm, starting from $v$,
in each step gets closer (in $\ell_1$ distance) to the origin.
%and at the end we analyze the weight of the generate path.
Suppose the algorithm has find a path from $v$ to $u$ so far, and then wants to find the next part of the path.
Suppose $h=\|u\|_H$ and $\ell = \|u\|_{1}$.
The algorithm does one of the following, depending on the value of $h$:
\begin{enumerate}
  \item If $h > d/2$, then the algorithm chooses the lightest 
    edge that brings it to a vertex closer to the origin. 
    Let $X_{\ell}$ denotes the weight of this edge. Note that $X_{\ell}$ is an $\exponential(h)$ random variable and is stochastically dominated by an $\exponential(d/2)$ random variable.

  \item Otherwise, we have $h\leq d/2$.
  Define $L_i \coloneqq \{x\in V(G): \|x\|_1=i\}$.
%  Define $L_i \coloneqq \{x\in V(G): \|x\|_1=i\}$. and let
%    $\ell=\|su\|_1$ (note the use of $\ell_1$ distance, and not Hamming
%    distance here).  
    The algorithm chooses the lightest path $uxyz$ among
    all paths with $x\in L_{\ell+1}$,  $y\in L_{\ell}\setminus\{u\}$,
    and $z\in L_{\ell-1}$.
    Note that $z$ is one step closer to the origin (in $\ell_1$ distance).
    Let $Z_{\ell}$ denote the weight of the chosen path $uxyz$.
    Then observe that $Z_{\ell}$ is a $Y_{a,b,c}$ random variable for some $a\geq d-h\geq d/2$, $b\geq \max\{h-1,1\}$ and $c\geq \max\{h-1,1\}$.
    Also note that we have $h \geq \ell/k$,
    so $Z_{\ell}$ is stochastically dominated by
    a $Y_{d/2,\max\{\ell/2k,1\},\max\{\ell/2k,1\}}$ random variable.
 \end{enumerate}
The weight of the path generated by $L$ steps of the preceding algorithm 
is stochastically dominated by
\[
\mathcal S \coloneqq 
\sum_{\ell=1}^{L} X_{\ell} +
\sum_{\ell=1}^{L} Z_{\ell} \:,
\]
where $X_{\ell}$ is an exponential($d/2$) random variable,
and $Z_{\ell}$ is a $Y_{d/2,\max\{\ell/2k,1\},\max\{\ell/2k,1\}}$
random variable.
Moreover, since $Z_{\ell}$ only depends on edges 
between $L_{\ell-1}$, $L_{\ell}$ and $L_{\ell+1}$,
each of the families
$\{X_{\ell}\}$,
$\{Z_{2i-1}\}$,
and 
$\{Z_{2i}\}$
is mutually independent.

We first bound the expected value of $\mathcal S$, and then use Bernstein's inequality to prove with high probability it does not exceed its expected value by much.
By~\lemref{yabcmoments}, for some absolute constant $C$  we have
\begin{align*}
\E \mathcal S
& \leq 2L/d + C \sum_{\ell=1}^{L} 
\left(1/d + 
\sqrt{k/d\ell}
+ \sqrt[3]{k^2/d\ell^2}\right) \\
& \leq
(C+2)L/d
+
C\sqrt{k/d}\int_{0}^{L}x^{-1/2}dx
+
C\sqrt[3]{k^2/d}\int_0^{L}x^{-2/3}dx\\
&=
(C+2)L/d
+
2C\sqrt{kL/d}
+3C\sqrt[3]{Lk^2/d}
\leq
(6C+2)k\:,
\end{align*}
where in the last line we used $L\leq kd$.

For any integer $p>1$, we have $p\Gamma(p/2)/2\leq p!$ and $p\Gamma(p/3)/3\leq p!$, so
\lemref{yabcmoments} gives that for some absolute constant $C$  we have
\begin{align*}
\E Z_{\ell}^p & \leq
 p (d/C)^{-p}\Gamma(p)
+ p(d\max\{\ell/k,1\}/C)^{-p/2}\Gamma(p/2)/2
+ p(d\max\{\ell/k,1\}^2/C)^{-p/3}\Gamma(p/3)/3\\
&\leq
 p! (C/d)^{p}
+ p!(C/d\max\{\ell/k,1\})^{p/2}
+ p!(C/d\max\{\ell/k,1\}^2)^{p/3}
\end{align*}
Hence, we have
\begin{align*}
\sum_{\ell=1}^{L} \E Z_{\ell}^p / p!
& \leq
L (C/d)^{p}
+
\sum_{\ell=1}^{k}
\left( (C/d)^{p/2}
+ (C/d)^{p/3} \right)
+
\sum_{\ell=k+1}^{L}
\left( (kC/d\ell)^{p/2}
+ (k^2C/d\ell^2)^{p/3} \right)\\
&
\leq L (C/d)^{p}
+
k (C/d)^{p/2}
+ k(C/d)^{p/3} 
+
(kC/d)^{p/2}
\sum_{\ell=k+1}^{L}
\ell^{-p/2}
+
 (k^2C/d)^{p/3}
\sum_{\ell=k+1}^{L}
\ell^{-2p/3}
%&\left(
%p (C/d)^p \Gamma(p)
%+
%p (kC/d\ell)^{p/2} \Gamma(p/2)\right)
%+
%\sum_{\ell=k+1}^{L}
%p(k^2C/d\ell^2)^{p/3}\Gamma(p/3)
%+
%\sum_{\ell=1}^{k} p(C/d)^{p/3}\Gamma(p/3)
%\\
%& =
%L p! (C/d)^p
%+
%p (kC/d)^{p/2} \Gamma(p/2)
%\sum_{\ell=1}^{L}\ell^{-p/2}
%+ p(k^2C/d)^{p/3}\Gamma(p/3)
%\sum_{\ell=k+1}^{L}\ell^{-2p/3} 
%+
%k p(C/d)^{p/3}\Gamma(p/3)
%\\
%&\leq
%L p! (C/d)^p
%+
%2(\ln L) p! (kC/d)^{p/2} 
%+ 2 k p!(C/d)^{p/3} + 2 p! k (C/d)^{p/3} \leq  v p!  c^{p-2}/2
\end{align*}
Note that 
\[k^{p/2}\sum_{\ell=k+1}^{L}\ell^{-p/2} \leq 
k^{p/2}\int_{\ell=k}^{L}\ell^{-p/2} 
\leq \begin{cases}
 k \ln (L/k) \leq 2 k \ln d & \mathrm{if\ } p=2 \\
 2k \leq 2 k \ln d &  \mathrm{if\ }  p>2
\end{cases}
\]
 and 
$\sum_{\ell=k+1}^{L}\ell^{-2p/3} \leq 
\int_{k}^{\infty} x^{-2p/3} dx \leq
k^{1-2p/3}$, so
\begin{align*}
\sum_{\ell=1}^{L} \E Z_{\ell}^p / p!
&
\leq L (C/d)^{p}
+
k (C/d)^{p/2}
+ k(C/d)^{p/3} 
+
2k(C/d)^{p/2} \ln d
+
 k(C/d)^{p/3} \leq v c^{p-2}/2\:,
\end{align*}
for $v = C' k d^{-2/3}/2$ and
$c = C' d^{-1/3}/2$,
for a suitably large constant $C'$.
Since $\{Z_{2i-1}\}$ are independent, using Bernstein's inequality we have, for any $t>1$,
\begin{align*}
\Pr \left\{ \sum_{i=1}^{\ell/2} (Z_{2i-1} - \E Z_{2i-1}) 
\geq tk
\right\}&
\leq \exp\left(-\frac{t^2k^2}{C'kd^{-2/3} + C'tkd^{-1/3}}\right)
\leq
\exp\left(-\frac{t^2k^2}{2C'tkd^{-1/3}}\right)
\end{align*}
similarly,
\[
\Pr \left\{ \sum_{i=1}^{\ell/2} (Z_{2i} - \E Z_{2i}) 
\geq t k
\right\}\leq \exp\left(-\frac{t^2k^2}{ 2C'tkd^{-1/3}}\right)
\:.
\]

For the variables $X_{\ell}$, using~\eqref{tail-bound} we have
%\[
%\E X_1^p = \int_{0}^{\infty}\exp(-dy^{1/p}/2)\mathrm{d}y
%=p\Gamma(p)(2/d)^p\leq vp!c^{p-2}/2
%\]
%for $v=2L(2/d)^2\leq 8 k/d$ and $c=2/d$,
%so by Bernstein's inequality\abas{replace with better known bounds for exponentials?},
\[
\Pr \left\{ \sum_{i=1}^{\ell} (X_{i} - \E X_{i}) 
\geq tk
\right\}\leq
\exp(L/2-dtk/2)\leq
\exp(kd(1-t)/2)\:.
\]
Finally, we have
\begin{align*}
&\Pr\{\mathcal S > (6C+2)k+3tk \}
 \leq
\Pr\{\mathcal S > \E S + 3tk\} \\
& \leq
\Pr \left\{ \sum_{i=1}^{\ell/2} (Z_{2i-1} - \E Z_{2i-1}) 
\geq tk
\right\}
+
\Pr \left\{ \sum_{i=1}^{\ell/2} (Z_{2i} - \E Z_{2i}) 
\geq tk
\right\}
+
\Pr \left\{ \sum_{i=1}^{\ell} (X_{i} - \E X_{i}) 
\geq tk
\right\}\\
& \leq
2 \exp\left(-\frac{t^2k^2}{2C'tkd^{-1/3}}\right)+
\exp(kd(1-t)/2)
=
2 \exp\left(-\frac{tkd^{1/3}}{2C'}\right)+
\exp(kd(1-t)/2)
\:,
\end{align*}
and choosing $t = \Delta/3k$ gives (\ref{hypercube:formula}).
\end{proof}

We can now finish the proof of \thmref{bestgrid-universal}.

\begin{proof}[Proof of \thmref{bestgrid-universal}]
By (the second part of) \lemref{bestgrid}, we need only consider the
case where $k/\ln(k+1) < d^{2/3}$.

Consider some vertex $u=(u_1,\ldots,u_d)$ with $u_i\in\{0,\ldots,k-1\}$
for each $i\in\{1,\ldots,d\}$.  Associate with this vertex the subgraph
$Q_u=G[V_u]$ of $G$ induced by the vertex set
\[
    V_u = \{(u_1+x_1,\ldots,u_d+x_d) :\text{$x\in\{0,1\}$ for each $i\in\{1,\ldots,d\}$}\} \enspace .
\]
Now, $Q_u$ is a $(1,d)$-grid, i.e, a hypercube.  An unpublished
result of Bollob\'as \etal \cite{X} shows that with probability
at least $1-e^{-cd^2}$, $Q_u$ has weighted diameter $O(1)$, i.e.,
$\tau(Q_u,a,b)=O(1)$ for every pair of vertices $a,b\in V(Q_u)$.  By the
union bound over all $k^d$ choices of $u$ \emph{every} $Q_u$ has weighted
diameter $O(1)$ with probability at least $1-(ke^{-cd})^d=1-o_n(1)$
for $k=o(e^{cd})$, which is certainly true for sufficiently large $n$
and $k/\ln(k+1) < d^{2/3}$.

Now, for any vertex $v\in G$, there is a sequence $v_1,v_2,\ldots,v_r$
of vertices in $G$ with $r\le k$ such that $s\in Q_{v_1}$, $v\in Q_{v_r}$
and, for each $i\in\{1,\ldots,r-1\}$, $Q_{v_{i}}$ and $Q_{v_{i+1}}$ have
at least one vertex in common.  Therefore, with probability $1-o_n(1)$,
 there is a path from $s$ to every vertex $v\in V(G)$ of weight at most
 $O(r)\subseteq O(k)$.
\end{proof}

%We now solve the grid graph problem.
%We claim that, 
%with probability $1-e^{d/C}$,
%uniformly each vertex at distance $\geq d/2$ of the origin
%has a path of weight $\leq k$ to $s$.
%For this we apply the union bound.
%Note that the number of vertices at $\ell_1$ distance exactly $\ell$ is bounded by
%the 
%number of non-negative solutions to
%$x_1+x_2+\dots+x_d=\ell$, which is 
%$\binom{\ell+d-1}{\ell}
%\leq (3e)^{\ell}$,
%so we can apply the union bound over these vertices,
%for all $d/2 \leq \ell \leq kd$.
%We do the same thing for the all-1 vector.
%So each vertex has cover time $O(k)$
%with probability $1-\exp(-d)$, as required.


\section{Lower Bounds for General Graphs}
\seclabel{lower-bounds}

Next, we describe a series of lower bound
constructions that match the upper bounds obtained in
Theorems~\ref{thm:alantree-upper-bound}--\ref{thm:alantree-upper-bound-genus}.
In particular, these constructions show that the dependence on $\Delta$
in the upper bounds in the previous sections can not be asymptotically
reduced.

In this section we prove the following theorem.

\begin{thm}
\thmlabel{genericlowerbound}
There exists a positive constant $c$ such that 
for any given positive integers $1<\Delta, D$ satisfying
$D\geq 16e^3 \ln \Delta$,
there exists an $n$-vertex graph $G$ with 
maximum degree $\leq \Delta$,
diameter $\leq D$, and
a vertex $s$ satisfying
$\Pr\{h(\tcal(G,s)) \geq c(\Delta \ln n + \Delta D)\}\geq 1-o_n(1)$.
\end{thm}


The graph $G$ is obtained by gluing together two graphs $H$ and $I$.
The graph $H$ has large diameter and high connectivity.  The graph $I$
has low connectivity and small diameter.  By gluing them we obtain a graph
of low diameter (because of $I$) but for which the infection is more likely to spread via $H$ (because of its high connectivity), and hence will have a large height.  We begin by
defining and studying $H$ and $I$ individually.


\subsection{The Ladder Graph $H$}

Let $L,\delta,a$ be positive integers.
The graph $H$ is shown in~\figref{h}.  The vertices of $H$ are partitioned into $L$ groups
$V_1,\ldots,V_L$, each of size $\delta$. The edge set of $H$ is
\[
   E(H) = \bigcup_{i=1}^{L-1} \{vw : v\in V_{i},\, w\in V_{i+1}\} \enspace .
\]
\begin{figure}
  \begin{center}
    \includegraphics{figs/h} 
  \end{center}
  \caption{The graph $H$.}
  \figlabel{h}
\end{figure}

First we show that the infection spreads rather quickly in $H$, namely we prove upper bounds for $\tau(H,v,w)$.

%\begin{lem}\lemlabel{lightning}
%   For any vertex $v\in V_i$ and any vertex $w\in V_j$, $j>i$,
%   \[
%       \Pr\{d_H(v,w) > t(j-i-1)/\delta + r) \} \le
%       \begin{cases}
%           \exp(-r) & \text{if $j-i=1$} \\
%           \exp((1-t/2)(j-i-1)) + \exp(-r) & \text{otherwise.}
%       \end{cases}
%   \]
%\end{lem}
%
%\begin{proof}
%   Consider the following greedy algorithm for finding a path from $v$
%   to $w$: The path starts at $v$ (which is in $V_i$).  When the path
%   has reached some vertex $x\in V_{k}$, for $k<j-1$, the algorithm
%   extends the path by taking the minimum-weight edge joining $x$ to some
%   vertex in $V_{k+1}$.  When the algorithm reaches some $x\in V_{j-1}$,
%   it takes the edge $xw$.
%
%   Let $m=j-i$.  Each of the first $m-1$ edges in the resulting path
%   has a weight that is the minimum of $\delta$ $\exponential(1)$
%   random variables.  Thus, the weight of these edges is the sum of
%   $m-1$ $\exponential(\delta)$ random variables $X_1,\ldots,X_{m-1}$.
%   By \eqref{tail-bound},
%   \begin{equation}
%     \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta \right\} \le 
%        \exp((1-t/2)(m-1)) \enspace .  \eqlabel{part-i}
%   \end{equation}
%   The last edge in this path has a weight $X_m$ that is an
%   $\exponential(1)$ random variable.  From the definition
%   of the exponential distribution,
%   \begin{equation}
%      \Pr\{X_m > r\} = \exp(-r) \enspace . \eqlabel{part-ii}
%   \end{equation}
%   We complete the proof with the union bound:
%   \begin{align*}
%      \Pr\{d_H(v,w) > t(m-1)/\delta + r\} &
%        = \Pr\left\{\sum_{\ell=1}^m X_m > t(m-1)/\delta + r\right\} \\
%        & \le \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta\right\}
%          + \Pr\{X_m>r\} \\
%        & \le \exp((1-t/2)(m-1)) + \exp(-r) \enspace . \qedhere
%   \end{align*}
%\end{proof}
%
%Note that the proof of \lemref{lightning} actually studies the length of
%the greedy path from $v$ to $w$; call this $d_H^{\mathrm{greedy}}(v,w)$.
%For a fixed $k$, $\Pr\{d_H^{\mathrm{greedy}}(v,w) > k\}$ is clearly
%maximized for $v\in V_1$ and $w\in V_L$. Therefore, by taking
%$r=aL/(e^2\delta)$ and $t=a/e^2$ (so that $tL/\delta+r = 2aL/(e^2\delta)$)
%we obtain the following special case of \lemref{lightning}:

\begin{lem}\lemlabel{lightning}
Let $a>e^2$. Then for any $1 \leq i < j \leq n$ and any $v\in V_i$, $w\in V_j$ we have
  \[
    \Pr\{\tau(H,v,w) > 2aL/(e^2\delta)\} 
        \le \exp(L-aL/(2e^2)) + \exp(-aL/(e^2\delta)) \enspace . 
  \]
\end{lem}

\begin{proof}
   Consider the following greedy algorithm for finding a path from $v$
   to $w$: The path starts at $v$ (which is in $V_i$).  When the path
   has reached some vertex $x\in V_{k}$, for $k<j-1$, the algorithm
   extends the path by taking the minimum-weight edge joining $x$ to some
   vertex in $V_{k+1}$.  When the algorithm reaches some $x\in V_{j-1}$,
   it takes the edge $xw$.

   Let $m=j-i$.  Each of the first $m-1$ edges in the resulting path
   has a weight that is the minimum of $\delta$ $\exponential(1)$
   random variables.  Thus, the sum of weights of these edges is the sum of
   $m-1$ $\exponential(\delta)$ random variables, i.e.\ an $\erlang(m-1,\delta)$ random variable.
   The weight of the final edge is an $\exponential(1)$ random variable.
   Thus we find
\begin{align*}
\Pr\left\{\tau(H,v,w)> 2aL/(e^2\delta) \right\} & \leq 
\Pr\left\{\erlang(m-1,\delta)+\exponential(1) > 2aL/(e^2\delta) \right\}\\
& \leq 
\Pr\left\{\erlang(m-1,\delta) > aL/(e^2\delta) \right\}
+
\Pr\left\{\exponential(1) > aL/(e^2\delta) \right\} \\
& \leq 
\Pr\left\{\erlang(L,\delta) > aL/(e^2\delta) \right\}
+
\exp(-aL/(e^2\delta)) \\
& \le \exp(L-aL/(2e^2)) + \exp(-aL/(e^2\delta)) \:.
\end{align*}   
The first inequality follows from the discussion above.
The second inequality follows from the union bound.
The third inequality is because an $\erlang(L,\delta)$ random variable stochastically dominates an $\erlang(m-1,\delta)$ random variable,
and the definition of the exponential distribution.
The final equality follows from the tail bound \eqref{tail-bound}.
\end{proof}

%   \begin{equation}
%     \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta \right\} \le 
%        \exp((1-t/2)(m-1)) \enspace .  \eqlabel{part-i}
%   \end{equation}
%   The last edge in this path has a weight $X_m$ that is an
%   $\exponential(1)$ random variable.  From the definition
%   of the exponential distribution,
%   \begin{equation}
%      \Pr\{X_m > r\} = \exp(-r) \enspace . \eqlabel{part-ii}
%   \end{equation}
%   We complete the proof with the union bound:
%   \begin{align*}
%      \Pr\{d_H(v,w) > t(m-1)/\delta + r\} &
%        = \Pr\left\{\sum_{\ell=1}^m X_m > t(m-1)/\delta + r\right\} \\
%        & \le \Pr\left\{\sum_{\ell=1}^{m-1} X_\ell > t(m-1)/\delta\right\}
%          + \Pr\{X_m>r\} \\
%        & \le \exp((1-t/2)(m-1)) + \exp(-r) \enspace . \qedhere
%   \end{align*}

\subsection{The Subdivided Tree $I$}

Next, we consider a tree $I$ that is obtained by starting with a perfect
binary tree\footnote{A perfect binary tree, sometimes called a complete binary tree, is a binary tree in which all vertices have 0 or 2 children, and all leaves have the same depth: \url{https://xlinux.nist.gov/dads/HTML/perfectBinaryTree.html}} having $L$ leaves and then subdividing each edge incident
to a leaf $\lceil aL/\delta\rceil-1$ times so that each leaf-incident
edge becomes a path of length $\lceil aL/\delta\rceil$.  Note that $I$
has height $\lceil aL/\delta\rceil+\log_2 L-1$ (we assume $L$ is a power of 2).

%Assign independent $\exponential(1)$ edge weights to each edge of $I$
%and, for two leaves $v$ and $w$, let $d_I(v,w)$ denote the weight of
%the unique path from $v$ to $w$.

We next show that the infection spreads rather slowly in $I$, namely we prove lower bounds for $\tau(I,v,w)$.


\begin{lem}\lemlabel{slow-train}
For any distinct leaves $v$ and $w$ we have
   $\Pr\{\tau(I,v,w) \le 2aL/(e^2\delta)\} \le \exp(-2aL/\delta)$.
\end{lem}

\begin{proof}
  The path from $v$ to $w$ in $I$ contains at least $2\lceil
  aL/\delta\rceil$ edges.  Therefore, the weight of this path is
  lower-bounded by the sum of $2\lceil aL/\delta\rceil$ independent
  $\exponential(1)$ random variables.  The lemma then follows by applying
  \eqref{head-bound} to this sum.
\end{proof}


\subsection{Putting it Together}

The lower-bound graph $G$ is now constructed by taking a tree $I$ with
$L$ leaves and a graph $H$ with $L$ groups $V_1,\ldots,V_L$ each of size
$\delta=\lfloor(\Delta-1)/2\rfloor$.  Next, we consider the leaves of
$I$ in the order they are encountered in a depth first-traversal of $I$
and, for each $i\in\{1,\ldots,L\}$ we identify the $i$th leaf of $I$
with some vertex in $V_i$.  See \figref{g}.

\begin{figure}
  \begin{center}
    \includegraphics{figs/g}
  \end{center}
  \caption{The lower bound graph $G$. Dotted segments denote subdivided edges (paths of length $\lceil aL/\delta\rceil$).}
  \figlabel{g}
\end{figure}

\begin{lem}\lemlabel{lowerboundlemma}
For any vertex $s\in V_1$ in the graph $G$ described above, we have
\[
\Pr\{h(\tcal(G,s)) < L-1\}
\le L^2\left(\exp((1-a/2e^2)L) 
                + \exp(-aL/(e^2\delta)) 
                + \exp(-2aL/\delta)
              \right)
\]
\end{lem}

\begin{proof}
Recall that $\tcal(G,s)$ is the shortest-path tree rooted at $s$ for the first-passage percolation in $G$.
If this tree contains no edge of $I$,
its height is at least $L-1$.
If it does use some edge of $I$, then there must be two leaves $v$ and $w$ of $I$ such that $\tau(I,v,w)\le \tau(H,v,w)$. Since there are $\binom{L}{2}<L^2$ choices for the pair $\{v,w\}$,
using \lemref{lightning} and \lemref{slow-train}, we can bound the probability of this event by
  \begin{align*}
       & L^2\left(\Pr\{d_H(v,w) > 2aL/\delta\} + \Pr\{d_I(v,w) < 2aL/\delta\}\right)  \\
       & \le L^2\left(\exp((1-a/2e^2)L) 
                + \exp(-aL/(e^2\delta)) 
                + \exp(-2aL/\delta)
              \right)\:,
  \end{align*}
which proves the lemma.
\end{proof}

We  now have all the ingredients to prove the main theorem of this section,
\thmref{genericlowerbound}.

\begin{proof}[Proof of~\thmref{genericlowerbound}]
Let $a=4e^2$, $\delta = (\Delta-1)/2$, and let $L$ be the largest power of 2 that is not larger than $D \Delta / 8a$.
Let $G$ be the graph described above.
The maximum degree of $G$ is $2\delta+1 = \Delta$, and the diameter of $G$ is bounded by
\[
2 (aL/\delta + \log_2 L) \leq 
2 (a \times (D \Delta / 8a) / (\Delta/2) + 
\log_2(D \Delta / 8a))\leq
D \:,
\]
and its number of vertices is 
\[
n = L\delta + (2L-1) + L(aL/\delta-1)<L(\delta+1+aL/\delta)\:.
\]
We have
\[
L \geq D \Delta /4a
= \Omega( D\Delta + \Delta \ln L + \Delta \ln (\delta+1+aL/\delta)) = \Omega(\Delta \ln n + \Delta D)\:.
\]
By~\lemref{lowerboundlemma}, there exists a vertex $s$ such that
\begin{align*}
&\Pr\{h(\tcal(G,s)\geq\Omega(\Delta \ln n + \Delta D))\}
 \geq
\Pr\{h(\tcal(G,s)\geq L-1)\} \\
&\geq 1 - L^2\left(\exp((1-a/2e^2)L) 
                - \exp(-aL/(e^2\delta)) 
                - \exp(-2aL/\delta)
              \right)\\
&= 1 -\left(\exp(-L+2\ln L) 
                - \exp(-8L/\Delta+2\ln L) 
                - \exp(-16e^2L/\Delta+2\ln L)
              \right)=1-o_L(1)=1-o_n(1)\:,
\end{align*}
completing the proof.
\end{proof}

%  In the Process~FP view, we assign each edge of $G$ an $\exponential(1)$
%  edge weight and compute a shortest path tree $T$ rooted at $s$ in
%  the resulting weighted graph.  Consider the path $P$ in $T$ from $s$
%  to an arbitrary vertex $t$ in $V_L$.  If $P$ uses no edges of $I$,
%  then it has at least $L-1$ edges.  If $P$ use at least one edge of $I$,
%  then this implies that there are two leaves $v$ and $w$ of $I$ such
%  that $d_H(v,w) \ge d_I(v,w)$.
%
%  Using \lemref{lightning} and \lemref{slow-train}, we have
%  \begin{align*}
%     \Pr\{d_H(v,w) \ge d_I(v,w)\}
%       & \le \binom{L}{2}\left(\Pr\{d_H(v,w) > 2aL/\delta\} + \Pr\{d_I(v,w) < 2aL/\delta\}\right)  \\
%       & \le \binom{L}{2}\left(\exp((1-a/2e^2)L) 
%                + \exp(-aL/(e^2\delta)) 
%                + \exp(-2aL/\delta)
%              \right)
%  \end{align*}
%  For large $L$, this probability tends to zero when $a\ge \max\{4e^2, 3e^2\delta\ln L/L\}$.  Such a constant $a$ exists for any $L\in\Omega(\Delta\log\Delta)$.
%
%\begin{thm}\thmlabel{alantree-lower-bound}
%  For every $\Delta\ge 3$ and every $L\in\Omega(\Delta\ln\Delta)$, there
%  exists a constant $a$ such that If we run Process~A on $G=G(a,L,\delta)$
%  starting at some vertex $s\in V_1$, then with probability at least
%  $1-o_L(1)$, the resulting spanning tree contains a path of length at
%  least $L-1$.
%\end{thm}
%
%\begin{proof}
%  In the Process~FP view, we assign each edge of $G$ an $\exponential(1)$
%  edge weight and compute a shortest path tree $T$ rooted at $s$ in
%  the resulting weighted graph.  Consider the path $P$ in $T$ from $s$
%  to an arbitrary vertex $t$ in $V_L$.  If $P$ uses no edges of $I$,
%  then it has at least $L-1$ edges.  If $P$ use at least one edge of $I$,
%  then this implies that there are two leaves $v$ and $w$ of $I$ such
%  that $d_H(v,w) \ge d_I(v,w)$.
%
%  Using \lemref{lightning} and \lemref{slow-train}, we have
%  \begin{align*}
%     \Pr\{d_H(v,w) \ge d_I(v,w)\}
%       & \le \binom{L}{2}\left(\Pr\{d_H(v,w) > 2aL/\delta\} + \Pr\{d_I(v,w) < 2aL/\delta\}\right)  \\
%       & \le \binom{L}{2}\left(\exp((1-a/2e^2)L) 
%                + \exp(-aL/(e^2\delta)) 
%                + \exp(-2aL/\delta)
%              \right)
%  \end{align*}
%  For large $L$, this probability tends to zero when $a\ge \max\{4e^2, 3e^2\delta\ln L/L\}$.  Such a constant $a$ exists for any $L\in\Omega(\Delta\log\Delta)$.
%\end{proof}
%
%
%Note that the graph $G$ has maximum degree $\Delta\le 2\delta+1$.
%Furthermore, every vertex of $G$ is either in $I$, or adjacent to a
%vertex in $I$.  Therefore, $G$ has diameter
%\[
%    D = 2+2(\ln L + aL/\delta) = O(L/\Delta) \enspace ,
%\]
%for $L\in\Omega(\Delta\ln\Delta)$.
%
%Note that the graph $G$ has three parameters $a$, $L$, and $\Delta$,
%so we will call this graph $G(a,L,\Delta)$.
%%\[
%%   D\in O((\ln\delta + \ln\ln L)\ln L + L/\delta) = O(L/\Delta)
%%\]
%%for $L\in\Omega(\Delta\ln\Delta\ln\ln\Delta)$.  That is, for any
%%$\Delta$ and any $D\in\Omega(\ln\Delta\ln\ln\Delta)$ we can construct
%%a graph $G$ with diameter $D$ and maximum degree $\Delta$.
%%
%
%
%The graph $G(a,L,\Delta)$ has $n\in O(L\Delta+L^2/\Delta)$ vertices
%and diameter $D\in O(L/\Delta)$.  \thmref{alantree-upper-bound}
%therefore states that running Process~A on $G(a,L,\Delta)$ will produce
%a spanning tree of height $O(\Delta(D+\log n)) \subset O(\Delta D)$ for
%$L\in\Omega(\Delta\log\Delta)$.  \thmref{alantree-lower-bound} shows 
%that the height of $T$ is $L-1\in\Omega(\Delta D)$ and therefore
%shows that \thmref{alantree-upper-bound} is tight for this graph.
%
%\abas{It's a bit vague. In what sense it is tight and for which parameters. Write an explicit theorem about tightness. Why do we need $L\in\Omega(\Delta\log\Delta)$ for the previous theorem? Why we parameterize $G$ with $\Delta$ rather than $\delta$? Why the probability bound is $o_L(1)$? What about the dependence of the upper bound on $\log n$?}

\section{Lower Bounds for Degenerate Graphs}
\seclabel{lowerdegenerate}

\thmref{genericlowerbound} shows that \thmref{alantree-upper-bound}
cannot be strengthened without knowing more about $G$ than its number of vertices, maximum
degree, and diameter.  \thmref{alantree-upper-bound-degenerate} provides a stronger
upper bound under the assumption that $G$ is $d$-degenerate.  
In this section we
show that \thmref{alantree-upper-bound-degenerate} is also tight, even
when restricted to  very special subclasses of $d$-degenerate graphs.

First we show that the bound given by
\thmref{alantree-upper-bound-degenerate} for $O(1)$-degenerate graphs
is tight, even when we restrict our attention to planar graphs, which
are 5-degenerate.  Since planar graphs have genus 0, this lower bound
also shows that \thmref{alantree-upper-bound-genus}, which applies to
bounded genus graphs, is  tight.

\begin{thm}\thmlabel{planartight}
There exists an absolute constant $c>0$ such that
for any $\Delta>1$ and $D\geq 10^6 \ln \Delta$ there exists a planar graph 
with diameter $\leq D$, maximum degree $\leq \Delta$,
and a vertex $s$ such that
with probability $1-o_n(1)$ we have $h(\tcal(G,s))>c\sqrt{\Delta}(D+\ln n)$.
\end{thm}

\begin{proof}

Let $C =10^5$, $a=e^2C$, 
$\delta=\Delta/2$, and 
$L=D\sqrt{\delta}/3a$, and 
Let $H$ be the graph shown in \figref{planar-h},
where each $V_i$ has  $\delta$ vertices.
Let $I$ be the perfect binary tree with $L$ leaves,
with each leaf-incident edge subdivided $aL/\sqrt \delta-1$ times.
Let $G$ be the graph obtained from identifying 
the $i$th leaf of $I$ with an arbitrary vertex from $V_i$.
Note that $G$ is a planar graph
with maximum degree $2\delta=\Delta$,
diameter $2 (aL/\sqrt{\delta}+1+\log_2 L)\leq D$,
and $n=\delta L + L - 1 + (2L-1) + L (aL/\delta-1)=O(\delta L + L^2/\delta)$
 vertices.
Let $s$ be an arbitrary vertex in $V_1$.
Since 
$L=\Omega(\sqrt{\Delta}(D+\ln n))$,
to complete the proof, we need only show that
with probability $1-o_n(1)$ we have 
 $h(\tcal(G,s)) \geq 2L-2$.




Choose an arbitrary vertex $t\in V_L$.
Let $\mathcal A$ denote the event
$\tau(H,s,t) \leq C L / \sqrt \delta$,
and let $\mathcal B$ denote the event
``for all pairs  $v$ and $w$ of leaves of $I$ we have
$\tau(I,v,w) > CL / \sqrt \delta$.
Note that if both $\mathcal A$ and $\mathcal B$ happen,
then the path in $\tcal(G,s)$ from $s$ to $t$ uses edges from $H$ only, which implies the height of this tree is at least $2L-2$.
To complete the proof via the union bound, we need only show that each of $\mathcal A$ and $\mathcal B$ happen with probability $1-o_L(1)=1-o_n(1)$.

We start with  $\mathcal A$.
  In $H$, one can go from the vertex in-between $V_i$ and $V_{i+1}$ to the vertex in-between
  $V_{i+1}$ and $V_{i+2}$ by taking a path whose weight is 
  distributed as a $Y_{\delta,1}$ random variable (recall the definition of a $Y_{a,b}$ random variable  from Section~\ref{sec:prelim}).
Therefore, we have 
\[
\tau(H,s,t) = X_1+X_2 + \sum_{i=1}^{L-2}Z_i \:,
\]
where $X_1,X_2$ are independent $\exponential(1)$
random variables (weights of the first and last edges),
and $Z_i$'s are independent $Y_{\delta,1}$ random variables.
Since $C/3\geq 3\times (64+1024)$,
Using \lemref{sqrtab} (concentration for the sum of $Y_{a,b}$ random variables) we have
\[
1-\Pr\{\mathcal A\}
\leq
2 \Pr\left\{X_1 >  CL / 3\sqrt \delta\right\}
+
\Pr\left\{ \sum_{i=1}^{L-1}Z_i >  CL / 3\sqrt \delta\right\}
\leq
2\exp\left(-CL / 3\sqrt \delta\right) +
\exp(-(L-2)/9)
=o_L(1)
\]


We now prove $\mathcal B$ happens with high probability.
The path connecting
any pair of leaves of $I$ contains at least $2aL/\sqrt \delta$ edges,
each of them having an independent exponential(1) weight.
Therefore, using union bound over all pairs and using~\eqref{head-bound} we get
\[
1-\Pr\{\mathcal B\}
\leq
\binom{L}{2} \times \Pr\{\erlang(2aL/\sqrt \delta,1)\leq CL/\sqrt \delta\}\leq
L^2 \times (eC/2a)^{2aL/\sqrt{\delta}} = o_L(1)\:,
\]
completing the proof.
\end{proof}


%\begin{thm}\thmlabel{alantree-lower-bound-planar}
%  For every $\Delta\ge 3$ and every $L\in\Omega(\sqrt{\Delta}\ln\Delta)$,
%  there exists a planar graph $G$ with maximum degree $\Delta$, diameter
%  $O(L/\sqrt{\Delta})$ and having a vertex $s$ such that, if we run
%  Process~A on $G$ starting at $s$, then with probability at least
%  $1-o_L(1)$, the resulting spanning tree contains a path of length at
%  least $2L-1$.
%\end{thm}
%
%\begin{proof}
%  The graph $G$ is very similar to $G(a, L,\delta)$ except that the ladder
%  graph $H$ is replaced with the planar graph shown in \figref{planar-h}.
%  The tree, $I$ attached to $H$ is the same as before, but it's bottom
%  edges are only subdivided $aL/\sqrt{\delta}$ times.  The resulting
%  graph is planar, has diameter $D\in\Theta(L/\sqrt{\delta})$ and maximum
%  degree $\Delta\in O(\delta)$.

  \begin{figure}
    \begin{center}
      \includegraphics{figs/planar-h}
    \end{center}
    \caption{The graph $H$ in the proof of \thmref{planartight}.}
    \figlabel{planar-h}
  \end{figure}
 
%  In this graph, one can go from any vertex in $V_i$ to some vertex in
%  $V_{i+1}$ by taking a path whose weight is the minimum of $\delta$
%  $\erlang(2,1)$ random variables.   Therefore, we one can find a path
%  from any vertex in $V_1$ to some vertex in $V_L$ whose weight is the
%  sum of independent random variables $X_1,\ldots,X_{L-1}$, where each
%  $X_i$ is distributed like the minimum of $\delta$ $\erlang(2,1)$
%  random variables.  By \eqref{erlang-two}, the expected weight of
%  this path is $\ell \in O(L/\sqrt{\delta})$.  Any standard trick for
%  concentrating sums of independent random variables then shows that the
%  probability that the weight of this path exceeds $2\ell$ is $o_L(1)$.
%  \abas{This is not so clear to me! Use \lemref{sqrtab}}
%
%  As in the proof of \thmref{alantree-lower-bound}, this implies
%  that the only way in which a path of length at least $2L-1$ does not
%  appear in $T$ is if $I$ contains a path from one leaf to another whose
%  weight is less than $2\ell$.  As in the proof of \lemref{slow-train},
%  \eqref{tail-bound} shows that, when $a$ is chosen sufficiently large,
%  the probability this is occurs is $o_L(1)$.
%\end{proof}

Next we describe a lower-bound construction that is $d$-degenerate,
has thickness $d$ and treewidth $O(d)$.  This construction shows that
\thmref{alantree-upper-bound-degenerate} is asymptotically tight for
all values $d\leq\Delta$ (with certain restrictions etc.).

\begin{thm}\thmlabel{alantree-lower-bound-degenerate}
There exists an absolute constant $c>0$ such that
for any $\Delta>1$ with
$D\geq 10^6 \ln \Delta$
and $d < \Delta$, 
 there exists a  graph  $G$
with diameter $\leq D$, maximum degree $\leq \Delta$, and the following properties:

(i) $G$ is $d$-degenerate, has thickness $\leq d$ and treewidth $\leq 2d+1$.

(ii) $G$ has a vertex $s$ such that
with probability $1-o_n(1)$ we have $h(\tcal(G,s))>c\sqrt{d\Delta}(D+\ln n)$.

\end{thm}

\begin{proof}
Let $C =10^5$, $a=e^2C$, 
$\delta=\Delta/2$, and 
$L=D\sqrt{d\Delta}/8a$, and 
Let $H$ be the graph shown in \figref{degenerate-h},
where each $V_i$ has $\delta$ vertices
  and each $V_i'$ has $d$ vertices,
  and each of the pairs
  $(V_1,V'_1)$, $(V'_1,V_2)$, $(V_2,V'_2)$, etc.\ form a complete bipartite graph.
Let $I$ be the perfect binary tree with $L$ leaves,
with each leaf-incident edge subdivided $aL/\sqrt{d\delta}-1$ times.
Consider the leaves of
$I$ in the order they are encountered in a depth first-traversal, for each $i\in\{1,\ldots,L\}$ identify the $i$th leaf of $I$
with some vertex in $V_i$. 
Let $G$ be the resulting graph.
Note that $G$ has maximum degree $2\delta=\Delta$,
diameter $\leq 2(1+aL/\sqrt{d\delta}+\log_2 L)\leq D$,
and $n=(\delta+D)L+2L-1+L(aL/d\delta-1)=O(\Delta L + L^2/d\Delta)$ vertices.
 
  \begin{figure}
    \begin{center}
       \includegraphics{figs/degenerate-h}
    \end{center}
    \caption{The $d$-degenerate graph $H$ used in the proof of
       \thmref{alantree-lower-bound-degenerate}. In this example, $\delta=7$
        and $d=3$.}
    \figlabel{degenerate-h}
  \end{figure}
  
(i)
  Graph $G$ is $d$-degenerate because the vertices of degree greater
  than $d$ form an independent set. Therefore, every induced subgraph
  of $G$ is either an independent set (so has a vertex of degree 0)
  or contains a vertex of degree at most $d$.

  To see that $G$ has thickness $d$, 
  for each $i=1,\dots,L$, assign to each vertex of 
  $V_{i}'$ a distinct colour from one of $d$ colour classes.   Now partition the edges incident to
  these vertices among $d$ subgraphs depending on the color of the
  vertex they are incident to.  Edges not incident to these vertices
  can be assigned to any subgraph.  With this partition of edges, each
  subgraph becomes a subgraph of the planar graph used in the proof of
  \thmref{planartight}.

  To see that $G$ has treewidth $2d+1$, we build a tree decomposition
  of $G$ with bags of maximum size $2d+2$.  For convenience, we 
  define $V_0=V_{L+1}=\emptyset$.

  We begin with a tree $T'$ of empty bags that has the same shape as $I$. For each vertex $v$ of $I$, let $B_v$ denote the bag of $v$.
  \begin{enumerate}
    \item Assign each vertex of $v$ of $I$ to $B_v$ and to the (up to 2)
      children of $B_v$ in $T'$.

    \item Let $v_1,\ldots,v_L$ be the
     leaves of $I$ ordered so that each $v_i\in V_i$. In the leaf bag
     $B_{v_i}$ of $T'$ we add all vertices in
     $V_{i-1}'$ and $V'_{i}$.

     Now each vertex in $V_{i}'$ appears in $B_{v_i}$ and $B_{v_{i+1}}$;
     so we add all vertices of $V_i'$ to each of the bags on the path in $T'$ from $B_{v_i}$ 
     to $B_{v_{i+1}}$.

    \item  Finally, to each $B_{v_i}$ we attach $\delta-1$ bags as leaves
     of $T'$; in each bag we put all the vertices in $V_i' \cup V_{i+1}'$, and a distinct vertex of $V_i\setminus\{v_i\}$. We
     call each such bag $B_v$, where $v$ is the unique vertex of
     $V_i\setminus\{v_i\}$ contained in the bag.
  \end{enumerate}

  No bag contains more than $2d+2$ vertices: 
  for a leaf $v_i$,
  $B_{v_i}$ contains $v_i$ and its parent, as well as vertices in $V_{i-1}'\cup V_i'$.
  For a non-leaf vertex $v$ of $I$, observe that (in any binary tree)
  there are at most two distinct indices $i,j$ such that $v$ lies on the $(v_i,v_{i+1})$-path in $I$ and on
  the $(v_j,v_{j+1})$-path, hence $B_v$ contains $v$ and its parent, as well as possibly $V_i'$ and $V_j'$. For each $v\in V_i\setminus\{v_i\}$,
  $B_v$ contains at most $2d+1$ vertices; $v$ and the vertices in
  $V_{i-1}'\cup V_{i}'$.

  For each edge $vw$ of $G$, there is some bag that contains both $v$
  and $w$: If $vw$ is an edge of $T$ with $v$ a child of $w$ then $B_v$
  contains both $v$ and $w$. Otherwise, $v\in V_i$ and $w\in V_{i-1}'$
  or $w\in V_{i}'$, in which case $v$ and $w$ appear in $B_v$.

  Finally, for each vertex $v$ of $G$, the subgraph of $T'$ induced by
  bags containing $v$ is connected: For a vertex $v\in I$ this subgraph
  is either an edge or a single vertex.  For a vertex $v\in V_i$ this
  subgraph is a single vertex.  For a vertex $v\in V'_{i}$ this subgraph
  is a path joining two vertices of $T'$.

  Therefore, $T'$ is a tree-decomposition of $G$ whose largest bag
  has size $2d+2$, and thus treewidth of $G$ is at most $2d+1$.

(ii)
Let $s$ be an arbitrary vertex in $V_1$.
Since 
$L=\Omega(\sqrt{d\Delta}(D+\ln n))$,
to prove part (ii) we need only show that
with probability $1-o_n(1)$ we have 
 $h(\tcal(G,s)) \geq 2L-2$.

Choose an arbitrary vertex $t\in V_L$.
Let $\mathcal A$ denote the event
$\tau(H,s,t) \leq C L / \sqrt {d\delta}$,
and let $\mathcal B$ denote the event
``for all pairs  $v$ and $w$ of leaves of $I$ we have
$\tau(I,v,w) > CL / \sqrt {d\delta}$.
Note that if both $\mathcal A$ and $\mathcal B$ happen,
then the path in $\tcal(G,s)$ from $s$ to $t$ uses edges from $H$ only, which implies the height of this tree is at least $2L-2$.
To complete the proof via the union bound, we need only show that each of $\mathcal A$ and $\mathcal B$ happen with probability $1-o_L(1)=1-o_n(1)$.

We start with  $\mathcal A$.
  In $H$, one can go from a given vertex in $V'_i$ to some vertex in $V'_{i+1}$  by taking a path whose weight is 
  distributed as a $Y_{\delta,d}$ random variable.
Therefore, $\tau(H,s,t)$  is stochastically dominated by
\[
X_1+X_2 + \sum_{i=1}^{L-2}Z_i \:,
\]
where $X_1,X_2$ are independent $\exponential(1)$
random variables (weights of the first and last edges), and
$Z_i$'s are independent $Y_{\delta,d}$ random variables.
Since $C/3\geq 3\times(64+1024)$,
Using \lemref{sqrtab} (concentration for the sum of $Y_{a,b}$ random variables) we have
\[
1-\Pr\{\mathcal A\}
\leq
2 \Pr \{X_1 >  CL / 3\sqrt {d\delta}\}
+
\Pr\{ \sum_{i=1}^{L-2}Z_i >  CL / 3\sqrt {d\delta}\}
\leq
2\exp(-CL / 3\sqrt {d\delta}) +
\exp(-(L-2)/9)
=o_L(1)
\]

We now prove $\mathcal B$ happens with high probability.
The path connecting
any pair of leaves of $I$ contains at least $2aL/\sqrt{d \delta}$ edges,
each of them having an independent exponential(1) weight.
Therefore, using union bound over all pairs and using~\eqref{head-bound} we get
\[
1-\Pr\{\mathcal B\}
\leq
\binom{L}{2} \times \Pr\{\erlang(2aL/\sqrt{d \delta},1)\leq CL/\sqrt {d\delta}\}\leq
L^2 \times (eC/2a)^{2aL/\sqrt{d\delta}} = o_L(1)\:,
\]
completing the proof.
\end{proof}


%
%\begin{thm}
%  For every $\Delta\ge 3$, $d\le \Delta$ and every
%  $L\in\Omega(\sqrt{d\Delta}\ln\Delta)$, there exists a $d$-degenerate
%  graph $G$ with maximum degree $\Delta$, diameter $O(L/\sqrt{d\Delta})$
%  and having a vertex $s$ such that, if we run Process~A on $G$ starting
%  at $s$, then with probability at least $1-o_L(1)$, the resulting
%  spanning tree contains a path of length at least $2L-1$. Furthermore,
%  the graph $G$ has thickness at most $d$ and treewidth at most $3d+1$.
%\end{thm}
%
%\begin{proof}
%
%
%
%  As before, all that remains is to show that with probability $1-o_L(1)$,
%  there is a path in $H$ from $s\in V_1$ to some vertex $v\in V_{L}$ whose
%  weight is at most $cL/\sqrt{d\delta}$.  
%  Again, we find this path with a
%  greedy algorithm.  To move from some vertex $v\in V_i'$ to $V_{i+1}'$,
%  we consider the $\delta$ paths $vxy$ where $x\in V_{i+1}$ and
%  $xy$ is the lightest edge joining $x$ to some vertex $y\in V_{i+1}'$.
%  The weight of the second edge of each such path is the minimum of
%  $d$ independent $\exponential(1)$ random variables, so it is an
%  $\exponential(d)$ random variable.  The first edge of each such path
%  is an $\exponential(1)$ random variable.  Thus, the weight of the path
%  we choose is distributed like $\min\{Z_i:i\in\{1,\ldots,\delta\}\}$,
%  where each $Z_i=X_i+Y_i$ with $X_i\sim \exponential(1)$ and
%  $Y_i\sim\exponential(d)$ and all variables independent.
%
%  An upper bound on the expectation of this random variable is given
%  by \lemref{luc} in \appref{lucs-lemma}:
%  \[ 
%      \E[\min\{Z_i:i\in\{1,\ldots,\delta\}\}] = O(1/\sqrt{d\delta}) \enspace .
%  \]
%  Therefore, the expected weight of the path found by the greedy
%  algorithm is at most $\ell \in O(L/\sqrt{d\delta})$.  The weight of
%  this path is the sum of $L-1$ independent random variables so, again,
%  any number of techniques can be used to show that the probability that
%  it exceeds $c'L/\sqrt{d\delta}$ for some sufficiently large constant
%  $c'$ is $o_L(1)$.  \abas{This is not so clear to me! Use \lemref{sqrtab}}  
%
%  As in the previous two proofs, applying \eqref{head-bound} and the
%  union bound to lower bound the weight of any path that uses edges
%  of $I$ then shows that, with probability $1-o_L(1)$, $T$ contains a
%  root-to-leaf path of length at least $2L-1$.
%\end{proof}
%
 
\section*{Acknowledgements}

Some of this research took place at the Workshop on Random Geometric
Graphs and Their Applications to Complex Networks, at the Banff
International Research Station, November 6--11, 2016.  More of this
research took place at the Rio Workshop on Geometry and Graphs, at IMPA,
February 12--18, 2017.  In both cases, we are grateful to the workshop
organizers and other participants for providing stimulating working
environments.  We are especially grateful to G\'abor~Lugosi for helpful
discussions on many aspects of this work and to Tasos~Sidiropoulos
for asking us about planar graphs.
\bibliographystyle{plain}
\bibliography{alantree}

\appendix

\section{Proof of~\lemref{sqrtab}}

We will use the following inequality, which holds for any positive integer $k$ and any real number $\lambda$
(see \cite[Theorem~5.1(ii)]{janson}):
\begin{equation}
\eqlabel{simpleerlang}
\Pr\{\erlang(k,1) \geq \lambda k\}
\leq\exp(1-\lambda) \:.
\end{equation}

We will also use the following inequality, which holds for any binomial random variable $X$, and any $M\leq\E X$ (see \cite[Theorem~2.3(c)]{McDiarmid1998}):
\begin{equation}
\eqlabel{binomialhalf}
\Pr\{X < M/2\} \leq \exp(-M/8)\:.
\end{equation}


\begin{lem}
\label{lem:yabconc}
For any $t$ we have
\[
\Pr\{Y_{a,b}>t\} \leq \exp(-at/64)+\exp(-abt^2/1024)\:.
\]
\end{lem}
\begin{proof}
First, consider the case $t>4$.
Note that there exist $a$ independent root-to-leaf paths, the weight of each is $\erlang(2,1)$.
Hence, using~\eqref{simpleerlang} and since $t\geq4$,
\[
\Pr\{Y_{a,b}>t\}
\leq
\Pr\{\erlang(2,1)>t\}^a
\leq
(\exp(1-t/2))^a
\leq
(\exp(-t/4))^a
=\exp(-at/4)
\leq\exp(-at/64)\:.
\]

The case $t\leq 0$ is trivial, so we consider the case $0\leq t\leq 4$.
Note that for such $t$ we have $1-\exp(-t/2)\geq t/8$.
We say a node in the tree \emph{survives} if each of the edges on its path to the root
have weight at most $t/2$.
Note that $Y_{a,b}>t$ implies no node at level 2 survives.
The probability that a node at level 1 (children of the root) survives is $1-\exp(-t/2)$,
so the number of surviving nodes at level 1, $S_1$, is a binomial random variable with mean $a(1-\exp(-t/2))\geq at/8$.
From~\eqref{binomialhalf} we have
\[
\Pr\{S_1 < at/16\}
\leq
\Pr\{S_1 < \E S_1 / 2\}
\leq
\exp(-\E S_1/8)
\leq 
\exp(-at/64)\:.
\]
Conditioned on $S_1\geq at/16$, the number of surviving nodes at level 2, $S_2$, is a binomial random variable with mean
$S_1b(1-\exp(-t/2))\geq abt^2/128$, so using\eqref{binomialhalf} again we have
\begin{align*}
\Pr\{Y_{a,b}>t | S_1\geq at/16\}
& \leq
\Pr\{S_2=0 | S_1\geq at/16\}
\leq
\Pr\{S_2<abt^2/256 | S_1\geq at/16\} \\
& \leq
\exp(-abt^2/1024)\:,
\end{align*}
completing the proof.
\end{proof}

We are now ready to prove
\lemref{sqrtab}.
Let $X_1,\dots,X_m$ be i.i.d.\ distributed as $Y_{a,b}$ for some $a,b$.
Then we want to prove
$\E X_1 =O(1/a+1/\sqrt{ab})$ and moreover,
\[
\Pr\left\{\sum_{i=1}^m X_i \geq 3 m (64/a + 1024/\sqrt{ab}) \right\}
\leq
\exp(-m/9)\:.
\]

Let $d_1 = a/64$ and $d_2=ab/1024$.
For any positive integer $p$, by Lemma~\ref{lem:yabconc} we have
\[
\E X_1^p = \int_0^{\infty} \Pr \{X_1>t^{1/p}\}dt
\leq
\int_0^{\infty} \exp(-d_1 t^{1/p}) + \int_0^{\infty} \exp(-d_2 t^{2/p})
\]
For any positive numbers $c,\alpha$, we have
\begin{align}
\int_0^{\infty} \exp(-c t^{\alpha}) dt
& = 
\int_0^{\infty} \exp(-x) \frac {x^{1/\alpha-1}}{\alpha c^{1/\alpha}}dx
=
\frac{c^{-1/\alpha}}{\alpha}\int_0^{\infty}
e^{-x}x^{1/\alpha-1}
= \frac{c^{-1/\alpha}\Gamma(1/\alpha)}{\alpha},
\eqlabel{expintegral}
\end{align}
whence,
\[
\E X_1^p \leq pd_1^{-p}\Gamma(p)
+ pd_2^{-p/2}\Gamma(p/2)/2
\]
In particular, setting $p=1$ gives $\E X_1 \leq 64/a+1024/\sqrt{ab}\eqqcolon c$.
Let $v=4c^2m$.
For $p\geq 2$, we have
\begin{align*}
\sum_{i=1}^m \E [X_i^p] 
\leq
mpd_1^{-p}\Gamma(p)
+ mpd_2^{-p/2}\Gamma(p/2)/2
\leq
m p! d_1^{-p}
+ m p! d_2^{-p/2}/2
\leq v p! c^{p-2}/2\:.
\end{align*}
Bernstein's inequality (Theorem~\ref{thm:bernstein}) gives that for all $t$,
\[
\Pr\left\{\sum_{i=1}^m X_i \geq 
m \left(64/a+1024/\sqrt{ab}\right)
+ ct + 3c\sqrt {mt} \right\} \leq e^{-t}\:,
\]
and choosing $t=m/9$ completes the proof of the lemma.


\section{Proof of~\lemref{yabcmoments}}
In this section, we prove that for any positive integer $p$ we have
\[
\E Y_{a,b,c}^p \leq
 p (a/64)^{-p}\Gamma(p)
+ p(ab/1024)^{-p/2}\Gamma(p/2)/2
+ p(abc/16384)^{-p/3}\Gamma(p/3)/3
\]
and, in particular,
$\E Y_{a,b,c} \leq 64/a+1024/\sqrt{ab} + 16384/\sqrt[3]{abc}$.


We will first show, using an argument similar to the proof of Lemma~\ref{lem:yabconc}, that
for any $t$ we have
\begin{equation}
\eqlabel{tailyabc}
\Pr\{Y_{a,b,c}>t\} \leq \exp(-at/64)+\exp(-abt^2/1024)+\exp(-abct^3/16384) \:.
\end{equation}
First, consider the case $t\geq6$.
Note that there exist $a$ independent root-to-leaf paths, the weight of each is $\erlang(3,1)$.
Hence, using~\eqref{simpleerlang} and since $t\geq6$,
\[
\Pr\{Y_{a,b,c}>t\}
\leq
\Pr\{\erlang(3,1)>t\}^a
\leq
(\exp(1-t/3))^a
\leq
(\exp(-t/6))^a
=\exp(-at/6) \leq\exp(-at/64)
\]

The case $t\leq 0$ is trivial, so we consider the case $0< t< 6$.
Note that for such $t$ we have $1-\exp(-t/3)\geq t/8$.
We say a node in the tree \emph{survives} if each of the edges on its path to the root
have weight at most $t/3$.
Note that $Y_{a,b,c}>t$ implies no node at level 3 survives.
The probability that a node at level 1 (children of the root) survives is $1-\exp(-t/3)$,
so the number of surviving nodes at level 1, $S_1$, is a binomial random variable with mean $a(1-\exp(-t/3))\geq at/8$.
From~\eqref{binomialhalf} we have
\[
\Pr\{S_1 < at/16\}
\leq \exp(-at/64)\:.
\]
Conditioned on $S_1\geq at/16$, 
the number of surviving nodes at level 2, $S_2$, is a binomial random variable with mean
$S_1b(1-\exp(-t/3))\geq abt^2/128$, so using\eqref{binomialhalf} again we have
\begin{align*}
\Pr\{S_2<abt^2/256 | S_1\geq at/16\} \leq
\exp(-abt^2/1024)\:.
\end{align*}
Finally, conditioned on $S_2\geq abt^2/256$,
the number of surviving nodes at level 3, $S_3$, is a binomial random variable with mean
$S_2c(1-\exp(-t/3))\geq abct^3/2048$, so using\eqref{binomialhalf} again we have
\begin{align*}
\Pr\{Y_{a,b,c}>t | S_2\geq abt^2/256\}
& \leq
\Pr\{S_3=0 | S_2\geq abt^2/256\}
\leq
\Pr\{S_3<abct^3/4096 | S_2\geq abt^2/256\} \\
& \leq
\exp(-abct^3/16384)\:,
\end{align*}
completing the proof of~\eqref{tailyabc}.

Now let $d_1 = a/64$, $d_2=ab/1024$, and $d_3=abc/16384$.
For any positive integer $p$ we have,
using~\eqref{tailyabc} and~\eqref{expintegral},
\begin{align*}
\E Y_{a,b,c}^p & = \int_0^{\infty} \Pr \{Y_{a,b,c}>t^{1/p}\}dt
\leq
\int_0^{\infty} \exp(-d_1 t^{1/p}) + \int_0^{\infty} \exp(-d_2 t^{2/p})
+ \int_0^{\infty} \exp(-d_3 t^{3/p}) \\
& 
= pd_1^{-p}\Gamma(p)
+ pd_2^{-p/2}\Gamma(p/2)/2
+ pd_3^{-p/3}\Gamma(p/3)/3
\end{align*}
In particular, setting $p=1$ gives $\E Y_{a,b,c} \leq 64/a+1024/\sqrt{ab} + 16384/\sqrt[3]{abc}$, completing the proof of the lemma.

%\begin{lem}
%\[
%\E Y_{a,b} \leq C \max \{1/a,1/\sqrt{ab}\}
%\]
%and
%\[
%\E Y_{a,b,c} \leq C \max \{1/a,1/\sqrt{ab},1/\sqrt[3]{abc}\}
%\]
%\end{lem}
%
%
%
%\begin{lem}\lemlabel{sumsum}
%Let $Z=Z_1+Z_2+Z_3$ such that
%$Z_1$ is a sum of $p$ independent exponential random variables,
%$Z_2$ is a sum of $q$ random variables of type $Y_{a,b,c}$ (not necessarily with the same parameters),
%$Z_3$ is also sum of $p$ random variables of type $Y_{a,b,c}$ (not necessarily with the same parameters),
%and suppose $m = p+2q$.
%Then there exists an absolute constant $C$ such that for any $\lambda>C$ we have
%\[
%\Pr\{Z \geq \lambda \E Z \}
%\leq
%C \exp(-m\lambda/C)
%\]
%\end{lem}

\pagebreak
\newpage

%\section{A Lemma on the Sum of Two Exponentials}
%\applabel{lucs-lemma}
%
%\abas{I am not sure if we need this appendix any more, since it follows, up to the constant factor, from~\lemref{sqrtab}}
%
%Consider the random variables $Q_1,\ldots,Q_\delta$ where each
%$Q_i=X_i+Y_i$ with $X_i\sim\exponential(1)$ and $Y_i\sim\exponential(d)$
%with all $X_i$ and $Y_i$ independent.  Let $M=\min\{Q_1,\ldots,Q_\delta\}$.
%
%\begin{lem}\lemlabel{luc}
%   For $\delta\ge d \ge 3$, 
%   \[  \E[M] \le \frac{\sqrt{2\pi} + 1}{\sqrt{d\delta}} \enspace . \]
%\end{lem}
%
%\begin{proof}
%   We note first that $Q_1$ has density
%   \[
%        \frac{d}{d-1}\left(e^x - e^{-xd}\right) \enspace , \enspace x\ge 0
%   \]
%   Next,
%   \[
%        \Pr\{M \ge x\} = \left(\Pr\{Q_1\ge x\}\right)^{\delta} \enspace ,
%   \]
%   where 
%   \[
%        \Pr\{Q_1\ge x\} = \frac{d}{d-1}\left(e^{-x}-\frac{e^{-xd}}{d}\right) \enspace ,\enspace x\ge 0 \enspace .
%   \]
%   Then
%   \begin{align}
%       \E[M] 
%        & = \int_0^\infty \left(\frac{d}{d-1}\left(e^{-x}-\frac{e^{-xd}}{d}\right)\right)^\delta \,\mathrm{d}x \notag \\ 
%        & \le
%          \int_0^a \left(\frac{d}{d-1}\left(e^{-x}-\frac{e^{-xd}}{d}\right)\right)^\delta \,\mathrm{d}x  \eqlabel{integral-a} \\
%          & \quad + \int_b^\infty \left(\frac{d}{d-1}\left(e^{-x}-\frac{e^{-xd}}{d}\right)\right)^\delta \,\mathrm{d}x \enspace , \eqlabel{integral-b}
%   \end{align}
%   if $b\le a$.  We will select such $a$ and $b$ and show that 
%   \[  \eqref{integral-a} \le \sqrt{\frac{2\pi}{d\delta}} \enspace , \enspace
%       \eqref{integral-b} \le \frac{1}{\delta} \le \frac{1}{\sqrt{d\delta}} \enspace .
%   \]
%   For this, we choose 
%   \[
%        a = \frac{9}{4}\cdot\frac{d-1}{d^2} \enspace, \enspace b=\ln\left(\frac{d}{d-1}\right)
%   \]
%   We first prove the bound on \eqref{integral-a}:  By Taylor's series, 
%   \[   e^{-x} \le 1 - x + \frac{x^2}{2} \enspace , \enspace x\ge 0 \enspace , \]
%   and
%   \[   e^{-xd} \ge 1 - xd + \frac{(xd)^2}{2} - \frac{(xd)^3}{6}\enspace , \enspace x\ge 0 \enspace . \]
%   So,
%   \begin{align}
%       \left(\frac{d}{d-1}\right)\left(e^{-x}-\frac{e^{-xd}}{d}\right)
%       & \le 
%       \left(
%         1-\frac{1}{d}+\frac{x^2}{2}-\frac{x^2d}{2}+\frac{x^3d^3}{6}
%       \right) \left(\frac{d}{d-1}\right) \notag \\
%       & = 1-\frac{dx^2}{2}+\frac{x^3d^3}{6(d-1)}  \eqlabel{sweet}
%   \end{align}
%   Note that
%   \[
%         \frac{x^3d^3}{6(d-1)} \le a\cdot \frac{d^3}{6(d-1)}\cdot x^2
%      = \frac{3}{8}dx^2 
%      \enspace ,
%   \] 
%   %since $d/(d-1) \le 5/4$. 
%   And so,
%   \[
%      \eqref{sweet} \le 1-\frac{1}{8}\cdot dx^2 \enspace , \enspace x \le a \enspace .
%   \]
%   Hence,
%   \begin{align*}
%      \eqref{integral-a} 
%        & \le \int_0^a\left(1-\frac{1}{8}dx^2\right)^\delta \, \mathrm{d}x \\
%        & \le \int_0^a e^{-\frac{d\delta}{8}x^2} \mathrm{d}x \\
%        & \le \frac{1}{2}\sqrt{2\pi}\times\sqrt{\frac{4}{d\delta}} \\
%        & = \sqrt{\frac{2\pi}{d\delta}} \enspace .
%   \end{align*}
%   Next we prove the bound on \eqref{integral-b}.  We use the trivial bound:
%   \[
%       \frac{d}{d-1}\left(e^{-x}-\frac{e^{-xd}}{d}\right) 
%         \le \frac{d}{d-1}e^{-x}
%       \enspace .
%   \]
%   Then,
%   \[
%      \eqref{integral-b} \le \left(\frac{d}{d-1}\right)^\delta
%       \int_b^\infty e^{-x\delta} \,\mathrm{d}x 
%       = \frac{1}{\delta}\left(\frac{d}{d-1}\right)^\delta e^{-b\delta}
%       = \frac{1}{\delta} \enspace .
%   \]
%   Finally, we prove that $b<a$.  Note that 
%   \[  b=\log\left(1+\frac{1}{d-1}\right)  \le \frac{1}{d-1} \enspace , \]
%   so it suffices to verify that $a(d-1)\ge 1$.  This is equivalent to verifying
%   that
%   \[ 9(d-1)^2 \ge 4d^2 \enspace , \]
%   or
%   \[ 9d^2 - 18d + 9 \ge 4d^2 \enspace , \]
%   or
%   \[ 5d^2 - 18d + 9 \ge 0 \enspace . \]
%   The left hand side of this last equation is non-negative for all $d\ge 3$.
%\end{proof}
%
%\section{A Lemma on Trees of Height Three}
%\applabel{easy-tree}
%
%\abas{I am not sure if we need this appendix any more, since it follows, up to the constant factors, from~\lemref{yabcmoments} }
%
%
%\lemref{luc}, in \appref{lucs-lemma}, shows that if one has a tree
%$T_{\delta,d}$ of height two whose root has $\delta$ children each of
%which has $d$ children and this tree has exponential edge weights, then
%the lightest root-to-leaf path in $T_{\delta,d}$ has expected weight
%$O((\delta d)^{-1/2})$.  In this appendix, we extend this result to
%trees of height three.  But first, we recall the following simple Chernoff Bound on the head of a $\binomial(n,p)$ random variable, $B$,
%\begin{equation}
%    \Pr\{B \le np/2\} \le e^{-np/8} \enspace . \eqlabel{chernoff-binomial}
%\end{equation}
%
%Let $\alpha \ge \beta \ge \gamma > 0$ be integers and consider the
%tree $T_{\alpha,\beta,\gamma}$ of height three whose root has $\alpha$
%children, each of which has $\beta$ children, each of which has $\gamma$
%children.  Assign independent $\exponential(1)$ weights to the edges
%of $T_{\alpha,\beta,\gamma}$.
%
%\begin{lem}\lemlabel{easy-tree}
%   Let $X$ be the weight of the lightest path from the root of
%   $T_{\alpha,\beta,\gamma}$ to some leaf.  Then, 
%   for any $0<c<(\alpha\beta\gamma)^{1/3}$,  $\Pr\{X
%   \ge (c+2)(\alpha\beta\gamma)^{-1/3} \} \le 3e^{-c/(4e^2)}$.
%\end{lem}
%
%\begin{proof}
%   Let $q=(\alpha\beta\gamma)^{-1/3}$
%   For each $i\in\{1,2,3\}$, we say that a node $v$ at depth $i$
%   \emph{survives} if there is a path from the root to $v$ whose
%   first edge has weight at most $cq$
%   and whose (at most two) subsequent edges each have weight at
%   most $q$.  We let $X_i$ be the number of
%   surviving nodes at level $i$.  It suffices to show that $\Pr\{X_3 =
%   0\} \le e^{-\Omega(c)}$, since $X_3>0$ implies the existence of at
%   least one root-to-leaf path of length $(c+2)q$.
%
%   First, note that $X_1$ is a $\binomial(\alpha, 1-e^{-cq})$ random variable.
%   The expected value of $X_1$ is at most
%   \[
%       \E[X_1] = \alpha(1-e^{-cq}) \ge 2\alpha cq/e \enspace ,
%   \]
%   where the second inequality, with the constant $2/e$, is valid because
%   $cq\le 1$.
%   By Chernoff's Bounds,
%   \begin{align*}
%     \Pr\{X_1 < \alpha cq/e\} 
%       & \le \Pr\{X_1 < \alpha(1-e^{-cq})/2\} \\
%       & \le \exp\left(-\alpha(1-e^{-cq})/8\right) & \text{(by \eqref{chernoff-binomial})}\\
%       & \le \exp\left(-\alpha cq/(4e)\right) & \text{}\\
%       & = \exp\left(-\alpha^{2/3}c/\left(4e(\beta\gamma)^{1/3}\right)\right) \\
%       & \le \exp\left(-c/(4e)\right) & \text{(Because $\alpha \ge \beta,\gamma$)}
%   \end{align*}
%
%   Now note that, conditioned on $X_1$, $X_2$ is a
%   $\binomial(\beta X_1,1-e^{-q})$ random variable.  So
%   \begin{align*}
%     \Pr\{X_2 < \alpha\beta cq/(2e) \mid X_1 \ge \alpha cq/e\}
%       & \le \exp\left(\alpha\beta (1-e^{-q}) cq/(8e)\right) \\
%       & \le \exp\left(\alpha\beta cq^2/(4e^2)\right) \\
%       & = \exp\left((\alpha\beta)^{1/3} c/(4e^2\gamma^{2/3})\right) \\
%       & \le \exp\left(c/(4e^2)\right)
%   \end{align*}
%
%   Finally, conditioned on $X_2$, $X_3$ is a 
%   $\binomial(\gamma X_2,1-e^{-q})$ random variable.  So,
%   \begin{align*}
%     \Pr\{X_3 = 0 \mid X_2 \ge \alpha\beta cq/(2e)\}
%     & \le (e^{-q})^{\alpha\beta\gamma cq/(2e)} \\
%     & = e^{-(\alpha\beta\gamma)^{1/3} c/(2e)} \\
%     & \le e^{-c/(2e)} \enspace .
%   \end{align*}
%   Now we are done, since
%   \begin{align*}
%      \Pr\{X_3=0\} & \le \Pr\{X_3=0\mid X_2 \ge \alpha\beta cq/(2e)\} \\
%         & \quad {} + \Pr\{X_2 < \alpha\beta cq/(2e) \mid X_1 \ge \alpha cq/e\} \\
%         & \quad {} + \Pr\{X_1 < \alpha cq/e \mid X_1 \ge \alpha\beta cq/(2e)\} \\
%         & \le e^{-c/(4e)} + e^{-c/(4e^2)} + e^{-c/(2e)} \\
%         & \le 3e^{-c/(4e^2)} \enspace . \qedhere
%   \end{align*}
%\end{proof}
%
%From \lemref{easy-tree}, we can obtain an upper bound of
%$O((\alpha\beta\gamma)^{-1/3})$ on the expected weight, $X$, of the
%lightest root-to-leaf path of in $T_{\alpha,\beta,\gamma}$.  Setting
%$x=(c+2)q$, \lemref{easy-tree} states that, for $0<x<1+2/q$,
%\[
%   \Pr\{X > x\} \le 3e^{-\left(\frac{x}{q}-2\right)/(4e^2)} \enspace .
%\]
%Therefore,
%\begin{align*}
%   \E[X] & = \int_0^{\infty} \Pr\{X > x\} \\
%         & = \int_0^{1} \Pr\{X > x\}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & \le \int_0^{1} 3e^{-\left(\frac{x}{q}-2\right)/(4e^2)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x  & \text{(by \lemref{easy-tree})}\\
%         & = 3e^{2/(4e^2)}\int_0^{1} e^{-x/(4e^2q)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & < 3e^{2/(4e^2)}\int_0^{\infty} e^{-x/(4e^2q)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & = 12e^{2/(4e^2)+2}q + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & = 12e^{2/(4e^2)+2}(\alpha\beta\gamma)^{-1/3} + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x
%\end{align*}
%
%To bound the second integral, we note that $T_{\alpha,\beta,\gamma}$
%contains $\alpha$ edge-disjoint root-to-leaf paths.  Thus, the random
%variable $X$ is not more than the minimum of $\alpha$ independent
%$\erlang(3,1)$ random variables.  The minimum of $\alpha$ independent
%$\erlang(3,1)$ random variables tends in distribution to a random variable
%$M$: $\Pr\{M>x\} = \exp(-x^3\alpha/6)$.  Thus, the second integral above is handled by:
%\begin{align*}
%   \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x 
%         & \le \int_1^{\infty} \Pr\{M > x\}\,\mathrm{d}x \\
%         & =  \int_1^{\infty} \exp(-x^3\alpha/6)\,\mathrm{d}x \\
%         & = \frac{6^{1/3}\Gamma(1/3,\alpha/6)}{3\alpha^{1/3}} \\
%         & = \frac{6^{1/3}\int_{\alpha/6}^\infty t^{-2/3}e^{-t}\,\mathrm{d}t}{3\alpha^{1/3}} \\
%         & < \frac{6^{1/3}\int_{\alpha/6}^\infty (\alpha/6)^{-2/3}e^{-t}\,\mathrm{d}t}{3\alpha^{1/3}} & \text{(for $\alpha \ge 6$)} \\
%         & = \frac{6\int_{\alpha/6}^\infty e^{-t}\,\mathrm{d}t}{3\alpha} \\
%         & = \frac{2}{\alpha} 
%         \le \frac{2}{(\alpha\beta\gamma)^{1/3}} &\text{(since $\alpha \ge \beta,\gamma$}) & \enspace .
%\end{align*}
%Therefore, $\E[X] \le (12e^{2/(4e^2)+2}+2)(\alpha\beta\gamma)^{-1/3}$ for $\alpha \ge 6$.
%
%%From \lemref{easy-key}, we can easily obtain an upper bound on the expected
%%value of the weight, $X$, of the lightest root-to-leaf path in $T$:
%%\begin{align*}
%%  \E[X] & = \int_0^{\infty} \Pr\{X > x\}\, \mathrm{d}{x} \\
%%        & = \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%%           + \int_{\sqrt{\delta d}}^{\infty} \Pr\{X > x\}\, \mathrm{d}{x} \\ 
%%        & \le \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%%           + \int_{\sqrt{\delta d}}^{\infty} 2e^{-x/2} \, \mathrm{d}{x} \\
%%        & = \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%%           + O(e^{-\sqrt{\delta d}}) \\
%%        & \le \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%%           + O(e^{-\sqrt{\delta d}}) \\
%%        & \le \int_0^{\sqrt{\delta d}} (c+1)/\sqrt{\delta d}\Pr\{X > x\}\, \mathrm{d}{x} 
%%           + O(e^{-\sqrt{\delta d}}) \\
%%
%%\end{align*}
%
%
%
%
%\section{Tight bounds for Grids and Hypercubes}
%
%\abas{This section is left from an older draft ...
%\thmref{hypercube-percolation} and
%\thmref{dk-grid-foxtrot} are not very well justified, because the concentration is not obvious.
%The best result I could get for high dimensional grids using this method is~\corref{bestgrid}.
%}
%
%
%The \emph{$d$-cube} is the graph having vertex set $\{0,1\}^d$ in
%which two vertices are adjacent if and only if they differ in exactly
%one coordinate.  Every vertex in the $d$-cube has degree $d$ and the
%$d$-cube has diameter $D=d$.  The $d$-cube is an interesting example
%in which the path count is high, but this is counteracted by a low
%first-passage percolation time.
%
%\begin{thm}\thmlabel{alantree-upper-bound-hypercube}
%  Let $n=2^d$, let $G$ be the $d$-cube and let $T$ be the tree obtained
%  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
%  with probability at least $1-o_n(1)$, $h(T)\in O(d)$.
%\end{thm}
%
%\begin{proof}
%  Fill and Pemantle \cite{fill.pemantle:percolation} show that the weight of
%  the heaviest root-to-leaf path in $T$ (the first-passage percolation
%  time) for the hypercube is at most 14.05 with probability $1-o_n(1)$.
%  Every vertex of the hypercube has degree $d$, so the number of paths
%  of length $L$ starting at $s$ is less than $d^L$.  The result then follows
%  by applying \lemref{meta-theorem} with $p=o_n(1)$, $c=2$, $K=14.05$,
%  and $a=d$.
%\end{proof}
%
%The \emph{$(d,k)$-grid} is the graph with vertex set $\{0,\ldots,k\}^d$
%and an edge between two vertices if and only if the (Euclidean or
%$\ell_1$) distance between them is 1.  The $(d,k)$-grid has $n=(k+1)^d$
%vertices, diameter $D=kd$, and maximum degree at most $\Delta=2d$. Note
%that the $d$-cube is a special case; it is the $(d,1)$-grid.
%
%\thmref{dk-grid-foxtrot}, in \appref{dk-grid-foxtrot}, shows that
%the first-passage percolation time in the $(d,k)$-grid is $O(k)$ with
%probability $1-o_n(1)$.  Applying \lemref{meta-theorem} with 
%the first-passage percolation bound in \thmref{dk-grid-foxtrot} yields
%the following:
%
%\begin{cor}\corlabel{alantree-upper-bound-dk-grid}
%  Let $n=(k+1)^d$, let $G$ be the $(d,k)$-grid and let $T$ be the tree obtained
%  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
%  with probability at least $1-o_n(1)$, $h(T)\in O(dk)$.
%\end{cor}
%
%%\section{First-Passage Percolation-Time Bounds}
%
%Next, 
%
%
%In this appendix, we prove (in some cases reprove) some results on
%first-passage percolation time on the $(d,k)$-grid that hold for
%all values of $d$ and $k$.  Specifically, we show that the first-passage
%percolation time is $O(k)$ with high probability.
%
%Before doing this, though, we note that this result can already be
%obtained from the $O(1)$ bound on first-passage percolation time on the
%$d$-cube \cite{fill.pemantle:percolation, martinsson:unoriented}.  To see
%why, observe that the crux of the problem involves studying the weight
%of the lightest path from $s=(0,\ldots,0)$ to $t=(k,\ldots,k)$. One can
%find a path from $s$ to $t$ that passes through each $v_i=(i,\ldots,i)$
%for $i\in\{0,\ldots,k\}$, in order.  The first-passage percolation
%result for the $d$-cube shows that one can get from $v_i$ to $v_{i+1}$
%with a path whose expected weight is $O(1)$ and that never leaves the
%$d$-cube induced by $\{i,i+1\}^d$.  Thus there is a path from $s$ to $t$
%whose weight is the sum of $k$ i.i.d.\ random variables $Q_1,\ldots,Q_k$
%each having expectation $O(1)$. The only detail that remains is to
%show that the distribution of $Q_i$ is well-behaved enough to obtain a
%sufficiently strong concentration result on this sum.
%
%Nevertheless, we provide an alternate proof here.  One reason for
%this is to make our results self-contained.  Another, however,
%is that our arguments differ significantly from those of Fill
%and Pemantle \cite{fill.pemantle:percolation} and Martinsson
%\cite{martinsson:unoriented} and may be of independent algorithmic
%interest.  In particular, our proofs use greedy algorithms to find
%light paths.  Our proof for the hypercube, for example, shows that one
%can find a path of expected weight $O(1)$ between any pair of vertices in
%$O(d^4)$ time.  Exact shortest path algorithms, like Dijkstra's algorithm,
%require at least $\Omega(2^d)$ time.  Similarly, on the $(d,k)$-grid,
%our proof gives an algorithm that finds a short path in $O(kd^4)$ time,
%while a shortest path agorithm would require $\Omega(d(k+1)^d)$ time.
%
%These results are all for grid graphs.  The \emph{$(d,k)$-grid} is a graph
%with
%vertex set $\{0,\ldots,k\}^d$ and an edge between two vertices if
%and only if the (Euclidean or $\ell_1$) distance between them is 1.
%For two grid vertices $u=(u_1,\ldots,u_d)$ and $w=(w_1,\ldots,w_d)$
%we define the \emph{$\ell_1$-distance} between them as
%\[
%   \|uw\|_1 = \sum_{i=1}^d |u_i-w_i|
%\]
%and we define the \emph{Hamming distance} between them as
%\[
%   \|uw\|_H = \sum_{i=1}^d [u_i\neq w_i] \enspace ,
%\]
%where $[\cdot]$ denotes the \emph{indicator function} whose value is 0
%or 1 depending on whether its argument is false or true, respectively.
%
%\subsection{The Grid with Moderate Dimensions}
%
%First we use a greedy approach to show that, when the dimension $d$
%is small compared to $k$, a greedy strategy works to find short paths.
%
%\begin{thm}\thmlabel{dk-grid-moderate}
%   Let $n=k^d$, for some $d\in O(k/\log(k+1))$, let $G$ be the $(d,k)$-grid
%   and let $T$ be the tree obtained by running Process~FP starting at
%   any vertex $s\in V(G)$.  Then, with probability at least $1-o_k(1)$,
%   the heaviest root-to-leaf path in $T$ has weight $O(k)$.
%\end{thm}
%
%\begin{proof}
%   Consider the following \emph{greedy algorithm} to find a light path
%   from $s$ to some vertex $v$:  Starting at $s$, repeatedly
%   move across the lightest edge that reduces the distance to $v$.
%
%   We analyze this greedy algorithm using the Process~E view. Without
%   loss of generality, assume that every coordinate of $v$ is greater
%   than or equal every coordinate of $s$.  When the algorithm is at some
%   vertex $v$, imagine that there are $d$ independent $\exponential(1)$
%   timers $X_1,\ldots,X_d$. When the first of these timers rings, say
%   timer $X_i$ we move to the vertex $(v_1,\ldots,v_{i}+1,\ldots,v_d)$
%   if that brings us closer to $v$, otherwise we remain at $v$ and reset
%   timer $X_i$.  
%   Allow the preceding process to run until $ckd$ timer rings have
%   occurred.  
%
%   This algorithm may fail in one of two ways:
%   \begin{enumerate}
%      \item The algorithm may take too long waiting for $ckd$ timer
%       rings.  The times between consecutive rings are independent
%       $\exponential(d)$ random variables and the weight of the path
%       the algorithm traverses is upper bounded the sum of these random
%       variables, which has expectation $ck$ and, by \eqref{tail-bound},
%       the probability that it exceeds $2ck$ is at most $\exp(-ckd)$.
%
%      \item The algorithm may fail to reach $v$ at the end of $ckd$ timer
%      rings.  This can only happen if, there is some $i\in\{1,\ldots,d\}$,
%      such that the timer for coordinate $i$ rang fewer than $k$ times.
%      The number of times the timer for coordinate $i$ rings is a
%      $\binomial(ckd,1/d)$ random variable that has expectation $ck$.
%      The probability that this number of rings is less than $k$ is
%      most $\exp(-(1-1/c)^2ck)$.  Therefore, the probability that the 
%      algorithm fails in this way is at most $d\exp(-(1-1/c)^2ck)$
%   \end{enumerate} 
%
%   Applying the union bound over each of the $(k+1)^{d}$ choices of $v$
%   then proves what we want, provided that
%   \[
%         \exp(-\Omega(c)k) (k+1)^d \to 0 \enspace ,
%   \]
%   which is true, for some sufficiently large $c$, provided that $d\in O(k/\log (k+1))$.
%\end{proof}
%
%\subsection{The Hypercube}
%
%The greedy algorithm described in the previous section fails when the
%dimension $d$ is much larger than the side-length $k$.  An extreme
%example of this is the hypercube, i.e., the $(d,1)$-grid.  In this case,
%it is easy to verify that the greedy algorithm produces a path from $s$
%to $v$ whose expected length is
%\[
%    \sum_{i=1}^{\|sv\|_H} 1/i = \ln \|sv\|_H + O(1) \enspace . 
%\]
%Here we show that a modification of the greedy algorithm does work.
%This result is not new, though the proof is.
%
%\begin{thm}\thmlabel{hypercube-percolation}
%  Let $n=k^d$, let $G$ be the $(d,1)$-grid and let $T$ be the tree obtained
%  by running Process~FP starting at any vertex $s\in V(G)$.  Then,
%  with probability at least $1-o_n(1)$, the heaviest root-to-leaf path
%  in $T$ has weight $O(1)$.
%\end{thm}
%
%\begin{proof}
%  We begin by describing an algorithm for finding a light path from
%  $s=(0,\ldots,0)$ to $t=(1,\ldots,1)$.  
%
%  If the algorithm has already found a path from $s$
%  to $v$, then it does one of two things depending on the distance
%  $\ell=\|vt\|_H$.
%  \begin{enumerate}
%     \item If $\ell \ge d/2$, then the algorithm selects the lightest
%     edge incident to $v$ that brings it closer to $t$. The weight of
%     this edge is an $\exponential(\ell)$ random variable, $X_\ell$,
%     whose expected value is $1/\ell\le 2/d$.
%
%   \item Otherwise, let $L_i = \{ v\in V(G) : \|vt\|_1=i\}$ denote the
%    set of vertices of $G$ whose distance to $t$ is $i$.  The algorithm
%    considers the $r=(d-\ell)\ell^2$ paths $vxyz$ that go from $v$ to
%    a vertex in $x\in L_{\ell+1}$, $y\in L_{\ell}\setminus v$, and then
%    to $z\in L_{\ell-1}$.  
%
%    The weight of the length 3 path found in such a step is the subject
%    of \appref{easy-tree}, where we show that the expected weight of this
%    path is at most $Cr^{-1/3}$ for some constant $C$. (In the notation
%    of \appref{easy-tree}, the weight of this path is modelled by the
%    lightest root-to-leaf path in the tree $T_{d-\ell,\ell,\ell}$.)
%  \end{enumerate}
%  Notice that after each step of the algorithm, the distance to $t$ is
%  reduced by 1, so the algorithm performs exactly $d$ steps.  The weight
%  of the resulting path, $P$, is
%  \begin{equation}
%     W(P)  = \sum_{\ell=1}^{\lfloor d/2\rfloor} Y_\ell +
%              \sum_{\ell=\lfloor d/2\rfloor+1}^d X_\ell
%     \eqlabel{foxtrot-weight}
%  \end{equation}
%  
%  Therefore, the expected weight of $P$ is 
%  \begin{align*}
%      \E[W(P)] & = \sum_{\ell=1}^{\lfloor d/2\rfloor} \E[Y_\ell] +
%              \sum_{\ell=\lfloor d/2\rfloor+1}^d \E[X_\ell] \\
%    & = \sum_{\ell=1}^{\lfloor d/2\rfloor} C(d-\ell)^{-1/3}\ell^{-2/3} +
%     \sum_{\ell=\lfloor d/2\rfloor+1}^d 1/\ell \\
%     & \le
%     C(d/2)^{-1/3}\sum_{\ell=1}^{\lfloor d/2\rfloor} \ell^{-2/3} + 1 \\
%     & = O(1) \enspace .
%  \end{align*}
%
%  We have shown how to find a path, $P$, from $s=(0,\ldots,0)$ to
%  $t=(1,\ldots,1)$ so that has $\E[W(P)]=O(1)$.  Going from there,
%  namely \eqref{foxtrot-weight}, to an upper bound that holds, with high
%  probability for all choices of $s$ and $t$ is fairly straightforward.
%  The random variables $X_{\lfloor d/2\rfloor+1},\ldots,X_d$ are
%  independent, but $Y_1,\ldots,Y_{\lfloor d/2\rfloor}$ are not. However,
%  the set $\{Y_\ell : \mbox{$\ell$ is even} \}$ is independent and so is
%  the set $\{Y_\ell : \mbox{$\ell$ is odd} \}$.  Therefore, we can split
%  \eqref{foxtrot-weight} into three sums, each of independent random
%  variables, and apply concentration inequalities to each of them to
%  obtain the desired result. The details are left to a sufficiently
%  interested reader.
%\end{proof}
%
%\subsection{The Grid in any Dimension}
%\applabel{dk-grid-foxtrot}
%
%Next, we show that the ideas used in \thmref{hypercube-percolation}
%can be used to provide a general result that holds for all grids of
%any dimension and any side-length.  This includes the hypercube and
%2-dimensional grid as special cases.
%
%\begin{thm}\thmlabel{dk-grid-foxtrot}
%   Let $n=k^d$, let $G$ be the $(d,k)$-grid
%   and let $T$ be the tree obtained by running Process~FP starting at
%   any vertex $s\in V(G)$.  Then, with probability at least $1-o_n(1)$,
%   the heaviest root-to-leaf path in $T$ has weight $O(k)$.
%\end{thm}
%
%\begin{proof}
%Let $s=(0,\ldots,0)$ and $t=(k,\ldots,k)$.  As is the case with the
%$d$-cube, the crux of the problem is to find a path from $s$ to $t$
%whose weight has expectation $O(k)$ and that can be expressed as a few
%sums of independent random variables.    We will only describe the path and
%analyze its expected weight.
%
%If the path-finding algorithm has already constructed a path from $s$ to
%some vertex $v$, then it does one of the following, based on $\|vt\|_H$:
%\begin{enumerate}
%
%  \item If $\|vt\|_H \ge d/2$, then the algorithm chooses the lightest 
%    edge that brings it to a vertex closer to $t$.  The weight of this
%    edge is an $\exponential(\|vt\|_H)$ random variable and therefore has
%    expected weight at most $1/\|vt\|_H \le 2/d$.
%
%  \item Otherwise, let $L_i = \{v\in V(G): \|vt\|_1=i\}$ and let
%    $\ell=\|vt\|_1$ (note the use of $\ell_1$ distance, and not Hamming
%    distance here).  The algorithm chooses the lightest path $vxyz$ among
%    all paths with $x\in L_{\ell+1}$,  $y\in L_{\ell}\setminus\{v\}$,
%    and $z\in L_{\ell-1}$.
%
%    The number of choices of paths is exactly
%    \begin{align*}
%        r(v) & = (d-\|vt\|_H)\|vt\|_H^2 
%               + (\|vs\|_H-d+\|vt\|_H)(\|vt\|_H-1)^2 \\
%             & \ge \|vs\|_H(\|vt\|_H-1)^2 \enspace .
%    \end{align*}
%    Again, the result in \appref{easy-tree} shows that the expected
%    weight of the path chosen in this step is at most $Cr(v)^{-1/3}$
%    for some constant $C$.
%\end{enumerate}
%Let $P$ be the path that results from this algorithm and note that the
%length of $P$ is at least $dk$ and at most $3dk$.  Let $Q$ be the set of
%path vertices at which the algorithm used the first option above and let
%$R$ be the set of path vertices at which the algorithm used the second
%option above.  Then
%\begin{align*}
%    \E[W(P)] & \le 2|Q|/d + C\sum_{v\in R}r(v)^{-1/3} \\
%             & = O(k) + C\sum_{i=1}^{dk}\sum_{v\in T\cap L_i}r(v)^{-1/3} \\
%             & = O(k) + C\sum_{i=2}^{dk}\sum_{v\in R\cap L_i}r(v)^{-1/3} \\
%             & \le O(k) + C\sum_{i=2}^{dk}\sum_{v\in R\cap L_i}(\|vs\|_H)^{-1/3}(\|vt\|_H-1)^{-2/3} \\
%             & \le O(k) + C(d/2)^{-1/3}\sum_{i=2}^{dk}\sum_{v\in R\cap L_i}(\|vt\|_H-1)^{-2/3} \\
%             & \le O(k) +  C(d/2)^{-1/3}\sum_{i=2}^{dk}(i/k-1)^{-2/3} \\
%             & \le O(k) +  C(d/2)^{-1/3}\sum_{i=1}^{dk}(i/k)^{-2/3} \\
%             & \le O(k) +  C(d/2)^{-1/3}k^{2/3}\sum_{i=1}^{dk}i^{-2/3} \\
%             & \le O(k) \enspace . \qedhere
%\end{align*}
%\end{proof}


%\section{A Lemma on Trees of Height Three}
%\applabel{easy-tree}
%
%\lemref{luc}, in \appref{lucs-lemma}, shows that if one has a tree
%$T_{\delta,d}$ of height two whose root has $\delta$ children each of
%which has $d$ children and this tree has exponential edge weights, then
%the lightest root-to-leaf path in $T_{\delta,d}$ has expected weight
%$O((\delta d)^{-1/2})$.  In this appendix, we extend this result to
%trees of height three.  But first, we recall the following simple Chernoff Bound on the head of a $\binomial(n,p)$ random variable, $B$,
%\begin{equation}
%    \Pr\{B \le np/2\} \le e^{-np/8} \enspace . \eqlabel{chernoff-binomial}
%\end{equation}
%
%Let $\alpha \ge \beta \ge \gamma > 0$ be integers and consider the
%tree $T_{\alpha,\beta,\gamma}$ of height three whose root has $\alpha$
%children, each of which has $\beta$ children, each of which has $\gamma$
%children.  Assign independent $\exponential(1)$ weights to the edges
%of $T_{\alpha,\beta,\gamma}$.
%
%\begin{lem}\lemlabel{easy-tree}
%   Let $X$ be the weight of the lightest path from the root of
%   $T_{\alpha,\beta,\gamma}$ to some leaf.  Then, 
%   for any $0<c<(\alpha\beta\gamma)^{1/3}$,  $\Pr\{X
%   \ge (c+2)(\alpha\beta\gamma)^{-1/3} \} \le 3e^{-c/(4e^2)}$.
%\end{lem}
%
%\begin{proof}
%   Let $q=(\alpha\beta\gamma)^{-1/3}$
%   For each $i\in\{1,2,3\}$, we say that a node $v$ at depth $i$
%   \emph{survives} if there is a path from the root to $v$ whose
%   first edge has weight at most $cq$
%   and whose (at most two) subsequent edges each have weight at
%   most $q$.  We let $X_i$ be the number of
%   surviving nodes at level $i$.  It suffices to show that $\Pr\{X_3 =
%   0\} \le e^{-\Omega(c)}$, since $X_3>0$ implies the existence of at
%   least one root-to-leaf path of length $(c+2)q$.
%
%   First, note that $X_1$ is a $\binomial(\alpha, 1-e^{-cq})$ random variable.
%   The expected value of $X_1$ is at most
%   \[
%       \E[X_1] = \alpha(1-e^{-cq}) \ge 2\alpha cq/e \enspace ,
%   \]
%   where the second inequality, with the constant $2/e$, is valid because
%   $cq\le 1$.
%   By Chernoff's Bounds,
%   \begin{align*}
%     \Pr\{X_1 < \alpha cq/e\} 
%       & \le \Pr\{X_1 < \alpha(1-e^{-cq})/2\} \\
%       & \le \exp\left(-\alpha(1-e^{-cq})/8\right) & \text{(by \eqref{chernoff-binomial})}\\
%       & \le \exp\left(-\alpha cq/(4e)\right) & \text{}\\
%       & = \exp\left(-\alpha^{2/3}c/\left(4e(\beta\gamma)^{1/3}\right)\right) \\
%       & \le \exp\left(-c/(4e)\right) & \text{(Because $\alpha \ge \beta,\gamma$)}
%   \end{align*}
%
%   Now note that, conditioned on $X_1$, $X_2$ is a
%   $\binomial(\beta X_1,1-e^{-q})$ random variable.  So
%   \begin{align*}
%     \Pr\{X_2 < \alpha\beta cq/(2e) \mid X_1 \ge \alpha cq/e\}
%       & \le \exp\left(\alpha\beta (1-e^{-q}) cq/(8e)\right) \\
%       & \le \exp\left(\alpha\beta cq^2/(4e^2)\right) \\
%       & = \exp\left((\alpha\beta)^{1/3} c/(4e^2\gamma^{2/3})\right) \\
%       & \le \exp\left(c/(4e^2)\right)
%   \end{align*}
%
%   Finally, conditioned on $X_2$, $X_3$ is a 
%   $\binomial(\gamma X_2,1-e^{-q})$ random variable.  So,
%   \begin{align*}
%     \Pr\{X_3 = 0 \mid X_2 \ge \alpha\beta cq/(2e)\}
%     & \le (e^{-q})^{\alpha\beta\gamma cq/(2e)} \\
%     & = e^{-(\alpha\beta\gamma)^{1/3} c/(2e)} \\
%     & \le e^{-c/(2e)} \enspace .
%   \end{align*}
%   Now we are done, since
%   \begin{align*}
%      \Pr\{X_3=0\} & \le \Pr\{X_3=0\mid X_2 \ge \alpha\beta cq/(2e)\} \\
%         & \quad {} + \Pr\{X_2 < \alpha\beta cq/(2e) \mid X_1 \ge \alpha cq/e\} \\
%         & \quad {} + \Pr\{X_1 < \alpha cq/e \mid X_1 \ge \alpha\beta cq/(2e)\} \\
%         & \le e^{-c/(4e)} + e^{-c/(4e^2)} + e^{-c/(2e)} \\
%         & \le 3e^{-c/(4e^2)} \enspace . \qedhere
%   \end{align*}
%\end{proof}
%
%From \lemref{easy-tree}, we can obtain an upper bound of
%$O((\alpha\beta\gamma)^{-1/3})$ on the expected weight, $X$, of the
%lightest root-to-leaf path of in $T_{\alpha,\beta,\gamma}$.  Setting
%$x=(c+2)q$, \lemref{easy-tree} states that, for $0<x<1+2/q$,
%\[
%   \Pr\{X > x\} \le 3e^{-\left(\frac{x}{q}-2\right)/(4e^2)} \enspace .
%\]
%Therefore,
%\begin{align*}
%   \E[X] & = \int_0^{\infty} \Pr\{X > x\} \\
%         & = \int_0^{1} \Pr\{X > x\}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & \le \int_0^{1} 3e^{-\left(\frac{x}{q}-2\right)/(4e^2)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x  & \text{(by \lemref{easy-tree})}\\
%         & = 3e^{2/(4e^2)}\int_0^{1} e^{-x/(4e^2q)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & < 3e^{2/(4e^2)}\int_0^{\infty} e^{-x/(4e^2q)}\,\mathrm{d}x + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & = 12e^{2/(4e^2)+2}q + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x \\
%         & = 12e^{2/(4e^2)+2}(\alpha\beta\gamma)^{-1/3} + \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x
%\end{align*}
%
%To bound the second integral, we note that $T_{\alpha,\beta,\gamma}$
%contains $\alpha$ edge-disjoint root-to-leaf paths.  Thus, the random
%variable $X$ is not more than the minimum of $\alpha$ independent
%$\erlang(3,1)$ random variables.  The minimum of $\alpha$ independent
%$\erlang(3,1)$ random variables tends in distribution to a random variable
%$M$: $\Pr\{M>x\} = \exp(-x^3\alpha/6)$.  Thus, the second integral above is handled by:
%\begin{align*}
%   \int_1^{\infty} \Pr\{X > x\}\,\mathrm{d}x 
%         & \le \int_1^{\infty} \Pr\{M > x\}\,\mathrm{d}x \\
%         & =  \int_1^{\infty} \exp(-x^3\alpha/6)\,\mathrm{d}x \\
%         & = \frac{6^{1/3}\Gamma(1/3,\alpha/6)}{3\alpha^{1/3}} \\
%         & = \frac{6^{1/3}\int_{\alpha/6}^\infty t^{-2/3}e^{-t}\,\mathrm{d}t}{3\alpha^{1/3}} \\
%         & < \frac{6^{1/3}\int_{\alpha/6}^\infty (\alpha/6)^{-2/3}e^{-t}\,\mathrm{d}t}{3\alpha^{1/3}} & \text{(for $\alpha \ge 6$)} \\
%         & = \frac{6\int_{\alpha/6}^\infty e^{-t}\,\mathrm{d}t}{3\alpha} \\
%         & = \frac{2}{\alpha} 
%         \le \frac{2}{(\alpha\beta\gamma)^{1/3}} &\text{(since $\alpha \ge \beta,\gamma$}) & \enspace .
%\end{align*}
%Therefore, $\E[X] \le (12e^{2/(4e^2)+2}+2)(\alpha\beta\gamma)^{-1/3}$ for $\alpha \ge 6$.
%
%
%

%From \lemref{easy-key}, we can easily obtain an upper bound on the expected
%value of the weight, $X$, of the lightest root-to-leaf path in $T$:
%\begin{align*}
%  \E[X] & = \int_0^{\infty} \Pr\{X > x\}\, \mathrm{d}{x} \\
%        & = \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%           + \int_{\sqrt{\delta d}}^{\infty} \Pr\{X > x\}\, \mathrm{d}{x} \\ 
%        & \le \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%           + \int_{\sqrt{\delta d}}^{\infty} 2e^{-x/2} \, \mathrm{d}{x} \\
%        & = \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%           + O(e^{-\sqrt{\delta d}}) \\
%        & \le \int_0^{\sqrt{\delta d}} \Pr\{X > x\}\, \mathrm{d}{x} 
%           + O(e^{-\sqrt{\delta d}}) \\
%        & \le \int_0^{\sqrt{\delta d}} (c+1)/\sqrt{\delta d}\Pr\{X > x\}\, \mathrm{d}{x} 
%           + O(e^{-\sqrt{\delta d}}) \\
%
%\end{align*}






\end{document}
